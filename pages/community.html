<!DOCTYPE html>
<html lang="fr">

<head>
    <script src="js/app-guard.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>SwellSync ‚Äî Communaut√© Surf</title>
    <meta property="og:type" content="website">
    <meta property="og:title" content="SwellSync ‚Äî Communaut√© Surf">
    <meta property="og:description" content="Communaut√© de surfeurs : partage tes sessions.">
    <meta property="og:image" content="https://swellsync.fr/assets/images/swellsync_logo.png?v=3">
    <meta property="og:site_name" content="SwellSync">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="/assets/images/swellsync_logo.png?v=3">
    <meta name="description"
        content="SwellSync Communaut√© ‚Äî Partagez vos sessions, √©changez avec les surfeurs et suivez les conditions.">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class', theme: { extend: { fontFamily: { display: ['Inter', 'system-ui', 'sans-serif'] } } } }</script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <script src="js/api.js"></script>
    <style>
        * {
            font-family: 'Inter', system-ui, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: #000;
            color: #f1f5f9;
            overscroll-behavior: none;
        }

        .glass {
            background: rgba(15, 36, 56, .85);
            border: 1px solid rgba(0, 186, 214, .12);
        }

        .card {
            background: #111;
            border: 1px solid rgba(0, 186, 214, .12);
        }

        .chip {
            border: 1px solid rgba(0, 186, 214, .2);
            border-radius: 20px;
            padding: 5px 14px;
            font-size: 11px;
            font-weight: 700;
            color: #94a3b8;
            cursor: pointer;
            transition: all .2s;
            white-space: nowrap;
        }

        .chip.active {
            background: #00bad6;
            color: #000;
            border-color: #00bad6;
        }

        .badge-pro {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .badge-pays-basque {
            background: linear-gradient(135deg, #16a34a, #15803d);
            color: white;
        }

        .badge-landes {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
        }

        .badge-bretagne {
            background: linear-gradient(135deg, #111827, #374151);
            color: white;
            border: 1px solid #6b7280;
        }

        .badge-cote-azur {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: white;
        }

        .badge-champion {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
            color: white;
        }

        .badge-wsl {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
        }

        .post-enter {
            animation: fadeUp .3s ease both;
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(10px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        @keyframes postHighlight {
            0% {
                box-shadow: 0 0 0 0 rgba(0, 186, 214, 0);
                background: #111;
            }

            15% {
                box-shadow: 0 0 0 4px rgba(0, 186, 214, .55);
                background: rgba(0, 186, 214, .08);
            }

            70% {
                box-shadow: 0 0 0 3px rgba(0, 186, 214, .25);
                background: rgba(0, 186, 214, .04);
            }

            100% {
                box-shadow: none;
                background: #111;
            }
        }

        .post-highlight {
            animation: postHighlight 2.5s ease both;
        }

        .tab-bar {
            display: flex;
            gap: 2px;
            padding: 3px;
            background: rgba(0, 186, 214, .08);
            border-radius: 14px;
            border: 1px solid rgba(0, 186, 214, .15);
        }

        .tab-btn {
            flex: 1;
            padding: 7px 8px;
            border-radius: 11px;
            font-size: 11px;
            font-weight: 700;
            color: #64748b;
            transition: all .2s;
            text-align: center;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 3px;
        }

        .tab-btn.active {
            background: #00bad6;
            color: #000;
        }

        .reply-box {
            background: rgba(0, 186, 214, .06);
            border-left: 2px solid #00bad6;
            padding: 8px 10px;
            border-radius: 0 10px 10px 0;
            margin-top: 6px;
        }

        .like-btn.liked {
            color: #f43f5e !important;
        }

        .like-btn.liked .mat-icon {
            font-variation-settings: 'FILL' 1;
        }

        ::-webkit-scrollbar {
            width: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0, 186, 214, .25);
            border-radius: 2px;
        }

        .no-scroll::-webkit-scrollbar {
            display: none;
        }

        .ranking-1 {
            background: linear-gradient(135deg, rgba(251, 191, 36, .15), rgba(245, 158, 11, .08));
        }

        .ranking-2 {
            background: linear-gradient(135deg, rgba(148, 163, 184, .1), rgba(100, 116, 139, .05));
        }

        .ranking-3 {
            background: linear-gradient(135deg, rgba(251, 146, 60, .1), rgba(249, 115, 22, .05));
        }
    </style>
    <script src="js/theme.js"></script>

    <style>
        :root {
            --bg-primary: #000;
            --bg-card: #111;
            --bg-nav: rgba(8, 15, 26, 0.95);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: rgba(0, 186, 214, 0.2);
        }

        .light {
            --bg-primary: #f0f4f8;
            --bg-card: #ffffff;
            --bg-nav: rgba(255, 255, 255, 0.95);
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --border-color: rgba(0, 186, 214, 0.15);
        }

        .light body {
            background: var(--bg-primary) !important;
            color: var(--text-primary) !important;
        }

        .light .card,
        .light [class*="bg-[#111]"] {
            background: var(--bg-card) !important;
        }

        .light [class*="bg-[#000]"] {
            background: var(--bg-primary) !important;
        }

        .light [class*="bg-[#111]"] {
            background: #f8fafc !important;
        }

        .light [class*="text-white"] {
            color: #0f172a !important;
        }

        .light [class*="text-slate-400"],
        .light [class*="text-slate-500"] {
            color: #64748b !important;
        }

        .light [class*="border-[#00bad6]"] {
            border-color: rgba(0, 186, 214, 0.25) !important;
        }

        .light nav[style*="--nav-bg"] {
            --nav-bg: rgba(255, 255, 255, 0.95) !important;
            border-color: rgba(0, 186, 214, 0.15) !important;
        }

        .light .section-label {
            color: #334155 !important;
        }

        .light .setting-row:hover {
            background: #e2e8f0 !important;
        }
    </style>

    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#00bad6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="/assets/images/swellsync_logo.png?v=3">
</head>

<body class="min-h-screen pb-28">

    <!-- Header sticky -->
    <header
        class="sticky top-0 z-50 backdrop-blur-xl bg-[#000]/92 border-b border-[#00bad6]/15 px-4 py-2.5 flex items-center gap-3">
        <div class="flex items-center gap-2 flex-1 min-w-0">
            <div
                class="w-7 h-7 rounded-full bg-[#00bad6]/20 flex items-center justify-center border border-[#00bad6]/30 shrink-0 active:scale-95 transition-transform">
                <span class="material-symbols-outlined text-[#00bad6] text-sm">groups</span>
            </div>
            <span class="font-black text-base">Communaut√©</span>
            <span
                class="text-[9px] bg-emerald-500/20 text-emerald-400 px-2 py-0.5 rounded-full font-bold flex items-center gap-1 shrink-0">
                <span class="w-1 h-1 rounded-full bg-emerald-400 animate-pulse inline-block"></span> 247 en ligne
            </span>
        </div>
        <button
            class="w-8 h-8 rounded-full bg-[#00bad6]/10 flex items-center justify-center active:scale-95 transition-transform"
            onclick="showBadgeShop()">
            <span class="material-symbols-outlined text-[#00bad6] text-[18px]">military_tech</span>
        </button>
        <button
            class="w-8 h-8 rounded-full bg-[#00bad6]/10 flex items-center justify-center active:scale-95 transition-transform"
            onclick="showSearch()">
            <span class="material-symbols-outlined text-slate-400 text-[18px]">search</span>
        </button>
    </header>

    <!-- Tabs principaux -->
    <div class="px-3 py-3 sticky top-[49px] z-40 bg-[#000]/90 backdrop-blur-lg border-b border-white/5">
        <div class="tab-bar" id="mainTabs">
            <div class="tab-btn active" onclick="switchTab('feed', this)"><span
                    class="material-symbols-outlined text-[14px]">forum</span>Feed</div>
            <div class="tab-btn" onclick="switchTab('ranking', this)"><span
                    class="material-symbols-outlined text-[14px]">leaderboard</span>Classement</div>
            <div class="tab-btn" onclick="switchTab('sessions', this)"><span
                    class="material-symbols-outlined text-[14px]">surfing</span>Sessions</div>
            <div class="tab-btn" onclick="switchTab('spots', this)"><span
                    class="material-symbols-outlined text-[14px]">place</span>Spots</div>
        </div>
    </div>

    <main class="px-3 space-y-3 pt-3">

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB FEED ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section id="tab-feed" class="space-y-3">

            <!-- Widget Session du Jour -->
            <div class="relative overflow-hidden rounded-2xl p-4 flex items-center gap-3 border border-[#00bad6]/20"
                style="background:linear-gradient(135deg,rgba(0,186,214,.08),rgba(0,119,204,.04))">
                <div class="w-11 h-11 rounded-full flex items-center justify-center shrink-0 text-2xl"
                    style="background:linear-gradient(135deg,#00bad6,#0077cc)">üèÑ</div>
                <div class="flex-1 min-w-0">
                    <p class="font-bold text-sm text-[#00bad6]">Lance une session !</p>
                    <p class="text-[10px] text-slate-400 mt-0.5">Enregistre ta session pour d√©bloquer des badges
                        automatiquement</p>
                </div>
                <button onclick="window.location.href='session-live.html'"
                    class="shrink-0 font-black text-sm px-4 py-2 rounded-xl transition-all text-black active:scale-95"
                    style="background:linear-gradient(135deg,#00bad6,#0077cc)">D√©marrer</button>
            </div>

            <!-- Topic chips -->
            <div class="flex gap-2 overflow-x-auto pb-0.5 no-scroll">
                <button class="chip active" onclick="setFilter('all',this)">üåä Tous</button>
                <button class="chip" onclick="setFilter('session',this)">üèÑ Sessions</button>
                <button class="chip" onclick="setFilter('spot',this)">üìç Spots</button>
                <button class="chip" onclick="setFilter('houle',this)">üåä Houle</button>
                <button class="chip" onclick="setFilter('competition',this)">üèÜ Comp√©tition</button>
                <button class="chip" onclick="setFilter('question',this)">‚ùì Questions</button>
            </div>

            <!-- Composer -->
            <div class="card rounded-2xl p-3">
                <div class="flex gap-2.5">
                    <div id="compAvatar"
                        class="w-8 h-8 rounded-full bg-[#00bad6]/20 flex items-center justify-center font-bold text-[#00bad6] text-sm shrink-0 active:scale-95 transition-transform">
                        S</div>
                    <textarea id="postText" rows="2" placeholder="Partage ta session, une houle, un spot‚Ä¶"
                        class="flex-1 bg-[#000] rounded-xl px-3 py-2 text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-1 focus:ring-[#00bad6]/40 border border-[#00bad6]/10 resize-none"></textarea>
                </div>
                <!-- Photo preview (hidden until image selected) -->
                <div id="photoPreview" class="hidden mt-2 relative inline-block">
                    <img id="photoPreviewImg" src="" alt="preview"
                        class="max-h-32 rounded-xl object-cover border border-[#00bad6]/20" />
                    <button onclick="removePhoto()"
                        class="absolute top-1 right-1 w-5 h-5 rounded-full bg-black/70 flex items-center justify-center">
                        <span class="material-symbols-outlined text-white text-[11px]">close</span>
                    </button>
                </div>
                <div class="flex items-center gap-2 mt-2.5 flex-wrap">
                    <div class="flex gap-1.5 flex-wrap">
                        <button id="tag-session" onclick="toggleTag('session')"
                            class="post-tag text-[10px] px-2.5 py-1 rounded-full border border-white/10 text-slate-400 transition-all">üèÑ
                            Session</button>
                        <button id="tag-spot" onclick="toggleTag('spot')"
                            class="post-tag text-[10px] px-2.5 py-1 rounded-full border border-white/10 text-slate-400 transition-all">üìç
                            Spot</button>
                        <button id="tag-houle" onclick="toggleTag('houle')"
                            class="post-tag text-[10px] px-2.5 py-1 rounded-full border border-white/10 text-slate-400 transition-all">üåä
                            Houle</button>
                        <button id="tag-competition" onclick="toggleTag('competition')"
                            class="post-tag text-[10px] px-2.5 py-1 rounded-full border border-white/10 text-slate-400 transition-all">üèÜ
                            Comp√©tition</button>
                        <!-- Photo upload button -->
                        <label for="postPhotoInput"
                            class="post-tag text-[10px] px-2.5 py-1 rounded-full border border-white/10 text-slate-400 transition-all cursor-pointer hover:border-[#00bad6]/40 hover:text-[#00bad6] flex items-center gap-1">
                            <span class="material-symbols-outlined text-[12px]">add_photo_alternate</span> Photo
                        </label>
                        <input type="file" id="postPhotoInput" accept="image/*" class="hidden"
                            onchange="previewPhoto(event)" />
                    </div>
                    <button onclick="submitPost()"
                        class="ml-auto bg-[#00bad6] text-[#000] font-bold text-xs px-4 py-1.5 rounded-xl flex items-center gap-1 active:scale-95 transition-transform">
                        <span class="material-symbols-outlined text-sm">send</span>Publier
                    </button>
                </div>
            </div>

            <!-- Feed posts -->
            <!-- AdSense Slot -->
            <div class="sw-ad-slot" data-ad-slot="9633029852" data-ad-format="fluid" style="margin:0 16px 12px">
            </div>
            <div id="feed" class="space-y-2.5"></div>

        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB RANKING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section id="tab-ranking" class="hidden space-y-4">
            <div class="flex items-center gap-2 mb-1">
                <span class="material-symbols-outlined text-amber-400">emoji_events</span>
                <h2 class="font-black text-base">Classement R√©gional</h2>
                <span class="text-[9px] bg-amber-400/20 text-amber-400 px-2 py-0.5 rounded-full font-bold ml-auto">Ce
                    mois</span>
            </div>

            <!-- Podium top 3 -->
            <div class="flex items-end justify-center gap-3 py-4">
                <!-- 2nd -->
                <div class="flex flex-col items-center gap-1">
                    <div
                        class="w-12 h-12 rounded-full bg-slate-500/30 border-2 border-slate-400 flex items-center justify-center font-black text-slate-300 text-lg">
                        M</div>
                    <span class="text-[9px] font-bold text-slate-400">MarieL</span>
                    <span class="material-symbols-outlined"
                        style="font-size:16px;color:#6b7280;font-variation-settings:'FILL' 1">anchor</span>
                    <div class="w-16 h-16 bg-slate-600/30 rounded-t-lg flex items-center justify-center text-2xl">ü•à
                    </div>
                </div>
                <!-- 1er -->
                <div class="flex flex-col items-center gap-1 -mb-2">
                    <div class="w-16 h-16 rounded-full border-4 border-amber-400 flex items-center justify-center font-black text-amber-400 text-xl"
                        style="background:rgba(251,191,36,.15)">J</div>
                    <div class="flex flex-col items-center">
                        <span class="text-[10px] font-black text-amber-300">Jer√¥meS</span>
                        <span class="material-symbols-outlined"
                            style="font-size:16px;color:#ef4444;font-variation-settings:'FILL' 1;margin-top:2px">landscape</span>
                    </div>
                    <div
                        class="w-20 h-20 bg-amber-400/15 rounded-t-lg flex items-center justify-center text-3xl border border-amber-400/30">
                        ü•á</div>
                </div>
                <!-- 3√®me -->
                <div class="flex flex-col items-center gap-1">
                    <div
                        class="w-12 h-12 rounded-full bg-orange-500/20 border-2 border-orange-400 flex items-center justify-center font-black text-orange-300 text-lg">
                        A</div>
                    <span class="text-[9px] font-bold text-slate-400">AlexS29</span>
                    <span class="material-symbols-outlined"
                        style="font-size:16px;color:#6b7280;font-variation-settings:'FILL' 1">anchor</span>
                    <div class="w-14 h-10 bg-orange-500/20 rounded-t-lg flex items-center justify-center text-xl">ü•â
                    </div>
                </div>
            </div>

            <!-- Rivalit√© r√©gionale -->
            <div class="card rounded-2xl p-3">
                <p class="text-[10px] text-slate-500 font-black uppercase tracking-widest mb-3">‚öîÔ∏è Rivalit√© R√©gionale ‚Äî
                    Sessions ce mois</p>
                <div id="rivalieChart" class="space-y-2">
                    <div>
                        <div class="flex justify-between text-xs mb-1"><span class="font-bold">üèÑ Pays
                                Basque</span><span class="text-[#00bad6] font-bold">247 sessions</span></div>
                        <div class="bg-white/5 rounded-full h-2">
                            <div class="h-2 rounded-full"
                                style="width:82%;background:linear-gradient(90deg,#16a34a,#22c55e)"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-xs mb-1"><span class="font-bold">üåä Landes</span><span
                                class="text-[#00bad6] font-bold">201 sessions</span></div>
                        <div class="bg-white/5 rounded-full h-2">
                            <div class="h-2 rounded-full"
                                style="width:67%;background:linear-gradient(90deg,#2563eb,#3b82f6)"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-xs mb-1"><span class="font-bold">‚öì Bretagne</span><span
                                class="text-[#00bad6] font-bold">183 sessions</span></div>
                        <div class="bg-white/5 rounded-full h-2">
                            <div class="h-2 rounded-full"
                                style="width:61%;background:linear-gradient(90deg,#374151,#6b7280)"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-xs mb-1"><span class="font-bold">‚òÄÔ∏è C√¥te
                                d'Azur</span><span class="text-[#00bad6] font-bold">94 sessions</span></div>
                        <div class="bg-white/5 rounded-full h-2">
                            <div class="h-2 rounded-full"
                                style="width:31%;background:linear-gradient(90deg,#0ea5e9,#38bdf8)"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Full ranking list -->
            <div class="space-y-2" id="fullRanking">
                <!-- Generated by JS -->
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB SESSIONS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section id="tab-sessions" class="hidden space-y-3">
            <div class="flex items-center justify-between mb-1">
                <h2 class="font-black text-base">üìì Journal de Sessions</h2>
                <button onclick="openLogSession()"
                    class="bg-[#00bad6] text-[#000] font-bold text-xs px-3 py-1.5 rounded-xl flex items-center gap-1 active:scale-95 transition-transform">
                    <span class="material-symbols-outlined text-sm">add</span>Loguer
                </button>
            </div>
            <div id="sessionsList" class="space-y-2.5"></div>
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB SPOTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section id="tab-spots" class="hidden space-y-3">
            <h2 class="font-black text-base">üìç Spots signal√©s par la communaut√©</h2>
            <div id="communitySpots" class="space-y-2"></div>
        </section>

    </main>

    <!-- Log Session Modal -->
    <div id="logModal" class="fixed inset-0 z-[200] hidden items-end justify-center bg-black/60 backdrop-blur-sm">
        <div class="w-full max-w-lg bg-[#111] rounded-t-3xl border-t border-[#00bad6]/20 p-5 space-y-3">
            <div class="flex items-center justify-between mb-1">
                <h3 class="font-black text-base">üìì Logger une session</h3>
                <button onclick="closeLogSession()" class="text-slate-400"><span
                        class="material-symbols-outlined">close</span></button>
            </div>
            <select id="logSpot"
                class="w-full bg-[#000] border border-[#00bad6]/20 rounded-xl px-3 py-2.5 text-sm text-white focus:outline-none focus:ring-1 focus:ring-[#00bad6]/50">
                <option value="">üìç S√©lectionner un spot...</option>
                <option>Hossegor ‚Äî La Gravi√®re</option>
                <option>Biarritz ‚Äî La C√¥te des Basques</option>
                <option>La Torche ‚Äî Bretagne</option>
                <option>Lacanau ‚Äî Ocean</option>
                <option>Seignosse ‚Äî Les Bourdaines</option>
            </select>
            <div class="grid grid-cols-2 gap-2">
                <div>
                    <label class="text-[10px] text-slate-400 font-bold mb-1 block">HAUTEUR VAGUES</label>
                    <select id="logWave"
                        class="w-full bg-[#000] border border-[#00bad6]/20 rounded-xl px-3 py-2 text-sm text-white focus:outline-none">
                        <option>
                            < 0.5m</option>
                        <option>0.5m ‚Äî 1m</option>
                        <option>1m ‚Äî 1.5m</option>
                        <option selected>1.5m ‚Äî 2m</option>
                        <option>2m ‚Äî 2.5m</option>
                        <option>2.5m+</option>
                    </select>
                </div>
                <div>
                    <label class="text-[10px] text-slate-400 font-bold mb-1 block">NOTE</label>
                    <select id="logScore"
                        class="w-full bg-[#000] border border-[#00bad6]/20 rounded-xl px-3 py-2 text-sm text-white focus:outline-none">
                        <option>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5/5</option>
                        <option selected>‚≠ê‚≠ê‚≠ê‚≠ê 4/5</option>
                        <option>‚≠ê‚≠ê‚≠ê 3/5</option>
                        <option>‚≠ê‚≠ê 2/5</option>
                        <option>‚≠ê 1/5</option>
                    </select>
                </div>
            </div>
            <textarea id="logNote" rows="2" placeholder="Note de session (vent, foule, fond‚Ä¶)"
                class="w-full bg-[#000] border border-[#00bad6]/20 rounded-xl px-3 py-2 text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-1 focus:ring-[#00bad6]/40 resize-none"></textarea>
            <button onclick="submitSession()"
                class="w-full bg-[#00bad6] text-[#000] font-black py-3 rounded-xl text-sm active:scale-95 transition-transform">Enregistrer
                la
                session</button>
        </div>
    </div>

    <!-- Badge Shop Modal (Full Boutique) -->
    <div id="badgeShopModal" class="fixed inset-0 z-[200] hidden items-end justify-center bg-black/60 backdrop-blur-sm"
        style="overflow-y:auto">
        <div class="w-full max-w-lg bg-[#111] rounded-t-3xl border-t border-[#00bad6]/20 p-5 space-y-3"
            style="max-height:85vh;overflow-y:auto">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="font-black text-base">üè™ Boutique SwellSync</h3>
                    <p class="text-[10px] text-slate-500 mt-0.5">Personnalise ton profil et tes interactions ü§ô</p>
                </div>
                <button onclick="closeBadgeShop()" class="text-slate-400"><span
                        class="material-symbols-outlined">close</span></button>
            </div>

            <!-- Shop Tabs -->
            <div class="flex gap-1 bg-[#000] rounded-xl p-1">
                <button onclick="shopTab('badges')" id="shopTabBadges"
                    class="flex-1 py-2 rounded-lg text-xs font-bold bg-[#00bad6] text-[#000]">üèÖ Badges</button>
                <button onclick="shopTab('stickers')" id="shopTabStickers"
                    class="flex-1 py-2 rounded-lg text-xs font-bold text-slate-400">üí¨ Stickers</button>
                <button onclick="shopTab('profil')" id="shopTabProfil"
                    class="flex-1 py-2 rounded-lg text-xs font-bold text-slate-400">‚ú® Profil</button>
            </div>

            <!-- TAB: Badges -->
            <div id="shopPanelBadges" class="space-y-2">
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">R√©gionaux</p>
                <div class="space-y-2">
                    <div class="flex items-center gap-3 card rounded-xl p-3">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center"
                            style="background:linear-gradient(135deg,#ef4444,#b91c1c)">
                            <span class="material-symbols-outlined text-white text-xl"
                                style="font-variation-settings:'FILL' 1">landscape</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs font-bold">Badge Pays Basque</p>
                            <p class="text-[10px] text-slate-500">Repr√©sente la c√¥te basque üèÑ</p>
                        </div>
                        <button
                            class="bg-[#00bad6] text-[#000] font-bold text-xs px-3 py-1.5 rounded-lg active:scale-95 transition-transform"
                            onclick="window.location.href='badges.html'">√âquiper ‚Üí</button>
                    </div>
                    <div class="flex items-center gap-3 card rounded-xl p-3">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center"
                            style="background:linear-gradient(135deg,#16a34a,#15803d)">
                            <span class="material-symbols-outlined text-white text-xl"
                                style="font-variation-settings:'FILL' 1">forest</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs font-bold">Badge Landes</p>
                            <p class="text-[10px] text-slate-500">Surfeur des Landes üå≤</p>
                        </div>
                        <button
                            class="bg-[#00bad6] text-[#000] font-bold text-xs px-3 py-1.5 rounded-lg active:scale-95 transition-transform"
                            onclick="buyBadge('Landes',0.99)">0,99‚Ç¨</button>
                    </div>
                    <div class="flex items-center gap-3 card rounded-xl p-3">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center"
                            style="background:linear-gradient(135deg,#111827,#374151);border:1px solid #6b7280">
                            <span class="material-symbols-outlined text-white text-xl"
                                style="font-variation-settings:'FILL' 1">anchor</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs font-bold">Badge Bretagne</p>
                            <p class="text-[10px] text-slate-500">Surfeur breton ‚öì</p>
                        </div>
                        <button
                            class="bg-[#00bad6] text-[#000] font-bold text-xs px-3 py-1.5 rounded-lg active:scale-95 transition-transform"
                            onclick="buyBadge('Bretagne',0.99)">0,99‚Ç¨</button>
                    </div>
                    <div class="flex items-center gap-3 card rounded-xl p-3">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center"
                            style="background:linear-gradient(135deg,#f97316,#ea580c)">
                            <span class="material-symbols-outlined text-white text-xl"
                                style="font-variation-settings:'FILL' 1">volcano</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs font-bold">Badge La R√©union</p>
                            <p class="text-[10px] text-slate-500">Surfeur r√©unionnais üå¥</p>
                        </div>
                        <button
                            class="bg-[#00bad6] text-[#000] font-bold text-xs px-3 py-1.5 rounded-lg active:scale-95 transition-transform"
                            onclick="buyBadge('R√©union',0.99)">0,99‚Ç¨</button>
                    </div>
                    <div class="flex items-center gap-3 card rounded-xl p-3">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center"
                            style="background:linear-gradient(135deg,#06b6d4,#0891b2)">
                            <span class="material-symbols-outlined text-white text-xl"
                                style="font-variation-settings:'FILL' 1">beach_access</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs font-bold">Badge Guadeloupe</p>
                            <p class="text-[10px] text-slate-500">Surfeur carib√©en üèùÔ∏è</p>
                        </div>
                        <button
                            class="bg-[#00bad6] text-[#000] font-bold text-xs px-3 py-1.5 rounded-lg active:scale-95 transition-transform"
                            onclick="buyBadge('Guadeloupe',0.99)">0,99‚Ç¨</button>
                    </div>
                </div>
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest pt-2">Comp√©tition & Style</p>
                <div class="space-y-2">
                    <div class="flex items-center gap-3 card rounded-xl p-3">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center"
                            style="background:linear-gradient(135deg,#00bad6,#0891b2)">
                            <span class="material-symbols-outlined text-white text-xl"
                                style="font-variation-settings:'FILL' 1">surfing</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs font-bold">Badge Shortboard</p>
                            <p class="text-[10px] text-slate-500">Specialist shortboard üèÑ‚Äç‚ôÇÔ∏è</p>
                        </div>
                        <button
                            class="bg-[#00bad6] text-[#000] font-bold text-xs px-3 py-1.5 rounded-lg active:scale-95 transition-transform"
                            onclick="buyBadge('Shortboard',0.99)">0,99‚Ç¨</button>
                    </div>
                    <div class="flex items-center gap-3 card rounded-xl p-3" style="border-color:rgba(245,158,11,.3)">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center"
                            style="background:linear-gradient(135deg,#f59e0b,#d97706)">
                            <span class="material-symbols-outlined text-[#000] text-xl"
                                style="font-variation-settings:'FILL' 1">military_tech</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs font-bold text-amber-300">Badge Elite</p>
                            <p class="text-[10px] text-slate-500">Exclusif ‚Äî Surfeur d'√©lite ‚ö°</p>
                        </div>
                        <button
                            class="font-bold text-xs px-3 py-1.5 rounded-lg active:scale-95 transition-transform text-black"
                            style="background:linear-gradient(135deg,#f59e0b,#d97706)"
                            onclick="buyBadge('Elite',1.99)">1,99‚Ç¨</button>
                    </div>
                    <div class="flex items-center gap-3 card rounded-xl p-3" style="border-color:rgba(168,85,247,.3)">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center"
                            style="background:linear-gradient(135deg,#7c3aed,#a855f7)">
                            <span class="material-symbols-outlined text-white text-xl"
                                style="font-variation-settings:'FILL' 1">workspace_premium</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs font-bold text-purple-300">Badge Pro Star ‚≠ê</p>
                            <p class="text-[10px] text-slate-500">Badge Pro officiel SwellSync</p>
                        </div>
                        <button
                            class="font-bold text-xs px-3 py-1.5 rounded-lg active:scale-95 transition-transform text-white"
                            style="background:linear-gradient(135deg,#7c3aed,#a855f7)"
                            onclick="buyBadge('Pro Star',2.99)">2,99‚Ç¨</button>
                    </div>
                </div>
            </div>

            <!-- TAB: Stickers (quick reactions for posts) -->
            <div id="shopPanelStickers" class="hidden space-y-3">
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">R√©actions rapides pour les
                    posts</p>
                <p class="text-[10px] text-slate-400">Ajoute des r√©actions uniques sur les posts de la communaut√©</p>

                <p class="text-[9px] text-[#00bad6] font-bold uppercase mt-2">üèÑ Surf</p>
                <div class="grid grid-cols-4 gap-2">
                    <button onclick="buySticker('ü§ô','Shaka')"
                        class="card rounded-xl p-3 text-center hover:border-[#00bad6]/40 transition-all active:scale-95">
                        <span class="text-2xl block">ü§ô</span>
                        <span class="text-[9px] text-slate-400 block mt-1">Shaka</span>
                        <span class="text-[9px] text-[#00bad6] font-bold block">0,49‚Ç¨</span>
                    </button>
                    <button onclick="buySticker('üèÑ','Surfeur')"
                        class="card rounded-xl p-3 text-center hover:border-[#00bad6]/40 transition-all active:scale-95">
                        <span class="text-2xl block">üèÑ</span>
                        <span class="text-[9px] text-slate-400 block mt-1">Surfeur</span>
                        <span class="text-[9px] text-[#00bad6] font-bold block">0,49‚Ç¨</span>
                    </button>
                    <button onclick="buySticker('üåä','Big Wave')"
                        class="card rounded-xl p-3 text-center hover:border-[#00bad6]/40 transition-all active:scale-95">
                        <span class="text-2xl block">üåä</span>
                        <span class="text-[9px] text-slate-400 block mt-1">Big Wave</span>
                        <span class="text-[9px] text-[#00bad6] font-bold block">0,49‚Ç¨</span>
                    </button>
                    <button onclick="buySticker('üî•','En Feu')"
                        class="card rounded-xl p-3 text-center hover:border-[#00bad6]/40 transition-all active:scale-95">
                        <span class="text-2xl block">üî•</span>
                        <span class="text-[9px] text-slate-400 block mt-1">En Feu</span>
                        <span class="text-[9px] text-[#00bad6] font-bold block">0,49‚Ç¨</span>
                    </button>
                </div>

                <p class="text-[9px] text-[#00bad6] font-bold uppercase mt-2">‚òÄÔ∏è M√©t√©o & Conditions</p>
                <div class="grid grid-cols-4 gap-2">
                    <button onclick="buySticker('‚òÄÔ∏è','Soleil')"
                        class="card rounded-xl p-3 text-center hover:border-[#00bad6]/40 transition-all active:scale-95">
                        <span class="text-2xl block">‚òÄÔ∏è</span>
                        <span class="text-[9px] text-slate-400 block mt-1">Soleil</span>
                        <span class="text-[9px] text-[#00bad6] font-bold block">0,49‚Ç¨</span>
                    </button>
                    <button onclick="buySticker('üí®','Offshore')"
                        class="card rounded-xl p-3 text-center hover:border-[#00bad6]/40 transition-all active:scale-95">
                        <span class="text-2xl block">üí®</span>
                        <span class="text-[9px] text-slate-400 block mt-1">Offshore</span>
                        <span class="text-[9px] text-[#00bad6] font-bold block">0,49‚Ç¨</span>
                    </button>
                    <button onclick="buySticker('üåÖ','Sunset')"
                        class="card rounded-xl p-3 text-center hover:border-[#00bad6]/40 transition-all active:scale-95">
                        <span class="text-2xl block">üåÖ</span>
                        <span class="text-[9px] text-slate-400 block mt-1">Sunset</span>
                        <span class="text-[9px] text-[#00bad6] font-bold block">0,49‚Ç¨</span>
                    </button>
                    <button onclick="buySticker('ü¶à','Shark!')"
                        class="card rounded-xl p-3 text-center hover:border-[#00bad6]/40 transition-all active:scale-95">
                        <span class="text-2xl block">ü¶à</span>
                        <span class="text-[9px] text-slate-400 block mt-1">Shark!</span>
                        <span class="text-[9px] text-[#00bad6] font-bold block">0,49‚Ç¨</span>
                    </button>
                </div>

                <p class="text-[9px] text-[#00bad6] font-bold uppercase mt-2">üéâ C√©l√©bration</p>
                <div class="grid grid-cols-4 gap-2">
                    <button onclick="buySticker('üèÜ','Champ')"
                        class="card rounded-xl p-3 text-center hover:border-[#00bad6]/40 transition-all active:scale-95">
                        <span class="text-2xl block">üèÜ</span>
                        <span class="text-[9px] text-slate-400 block mt-1">Champ</span>
                        <span class="text-[9px] text-[#00bad6] font-bold block">0,49‚Ç¨</span>
                    </button>
                    <button onclick="buySticker('üí™','Strong')"
                        class="card rounded-xl p-3 text-center hover:border-[#00bad6]/40 transition-all active:scale-95">
                        <span class="text-2xl block">üí™</span>
                        <span class="text-[9px] text-slate-400 block mt-1">Strong</span>
                        <span class="text-[9px] text-[#00bad6] font-bold block">0,49‚Ç¨</span>
                    </button>
                    <button onclick="buySticker('üòç','Love It')"
                        class="card rounded-xl p-3 text-center hover:border-[#00bad6]/40 transition-all active:scale-95">
                        <span class="text-2xl block">üòç</span>
                        <span class="text-[9px] text-slate-400 block mt-1">Love It</span>
                        <span class="text-[9px] text-[#00bad6] font-bold block">0,49‚Ç¨</span>
                    </button>
                    <button onclick="buySticker('üéØ','Pr√©cis')"
                        class="card rounded-xl p-3 text-center hover:border-[#00bad6]/40 transition-all active:scale-95">
                        <span class="text-2xl block">üéØ</span>
                        <span class="text-[9px] text-slate-400 block mt-1">Pr√©cis</span>
                        <span class="text-[9px] text-[#00bad6] font-bold block">0,49‚Ç¨</span>
                    </button>
                </div>

                <!-- Pack promo -->
                <div class="card rounded-xl p-3 flex items-center gap-3 mt-2" style="border-color:rgba(0,186,214,.3)">
                    <div class="text-xl">üì¶</div>
                    <div class="flex-1">
                        <p class="text-xs font-bold text-[#00bad6]">Pack 12 Stickers</p>
                        <p class="text-[10px] text-slate-500">Tous les stickers d'un coup !</p>
                    </div>
                    <div class="text-right">
                        <span class="text-[10px] text-slate-500 line-through">5,88‚Ç¨</span>
                        <button
                            class="block bg-[#00bad6] text-[#000] font-bold text-xs px-3 py-1.5 rounded-lg active:scale-95 transition-transform mt-0.5"
                            onclick="buySticker('all','Pack')">2,99‚Ç¨</button>
                    </div>
                </div>
            </div>

            <!-- TAB: Profil (frames, auras, effects) -->
            <div id="shopPanelProfil" class="hidden space-y-3">
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Cadres de profil</p>
                <p class="text-[10px] text-slate-400">Un cadre autour de ton avatar dans la communaut√©</p>

                <div class="grid grid-cols-3 gap-2">
                    <button onclick="buyFrame('ocean')"
                        class="card rounded-xl p-3 text-center hover:border-[#00bad6]/40 transition-all active:scale-95">
                        <div class="w-12 h-12 rounded-full mx-auto mb-1.5 flex items-center justify-center text-lg font-black"
                            style="border:3px solid #00bad6;background:rgba(0,186,214,.15)">S</div>
                        <span class="text-[9px] text-slate-300 font-bold block">Ocean</span>
                        <span class="text-[9px] text-[#00bad6] font-bold block">0,99‚Ç¨</span>
                    </button>
                    <button onclick="buyFrame('fire')"
                        class="card rounded-xl p-3 text-center hover:border-[#00bad6]/40 transition-all active:scale-95">
                        <div class="w-12 h-12 rounded-full mx-auto mb-1.5 flex items-center justify-center text-lg font-black"
                            style="border:3px solid #f97316;background:rgba(249,115,22,.15)">S</div>
                        <span class="text-[9px] text-slate-300 font-bold block">Fire</span>
                        <span class="text-[9px] text-orange-400 font-bold block">0,99‚Ç¨</span>
                    </button>
                    <button onclick="buyFrame('gold')"
                        class="card rounded-xl p-3 text-center hover:border-[#00bad6]/40 transition-all active:scale-95">
                        <div class="w-12 h-12 rounded-full mx-auto mb-1.5 flex items-center justify-center text-lg font-black"
                            style="border:3px solid #f59e0b;background:rgba(245,158,11,.15)">S</div>
                        <span class="text-[9px] text-slate-300 font-bold block">Gold</span>
                        <span class="text-[9px] text-amber-400 font-bold block">1,49‚Ç¨</span>
                    </button>
                    <button onclick="buyFrame('rainbow')"
                        class="card rounded-xl p-3 text-center hover:border-[#00bad6]/40 transition-all active:scale-95">
                        <div class="w-12 h-12 rounded-full mx-auto mb-1.5 flex items-center justify-center text-lg font-black"
                            style="border:3px solid;border-image:linear-gradient(135deg,#f43f5e,#8b5cf6,#00bad6) 1;border-radius:50%;background:rgba(139,92,246,.1)">
                            S</div>
                        <span class="text-[9px] text-slate-300 font-bold block">Rainbow</span>
                        <span class="text-[9px] text-purple-400 font-bold block">1,99‚Ç¨</span>
                    </button>
                    <button onclick="buyFrame('neon')"
                        class="card rounded-xl p-3 text-center hover:border-[#00bad6]/40 transition-all active:scale-95">
                        <div class="w-12 h-12 rounded-full mx-auto mb-1.5 flex items-center justify-center text-lg font-black"
                            style="border:3px solid #22d3ee;box-shadow:0 0 8px rgba(34,211,238,.5);background:rgba(34,211,238,.1)">
                            S</div>
                        <span class="text-[9px] text-slate-300 font-bold block">Neon</span>
                        <span class="text-[9px] text-cyan-400 font-bold block">1,99‚Ç¨</span>
                    </button>
                    <button onclick="buyFrame('diamond')"
                        class="card rounded-xl p-3 text-center hover:border-[#00bad6]/40 transition-all active:scale-95">
                        <div class="w-12 h-12 rounded-full mx-auto mb-1.5 flex items-center justify-center text-lg font-black"
                            style="border:3px solid #e2e8f0;box-shadow:0 0 12px rgba(226,232,240,.4);background:rgba(226,232,240,.08)">
                            S</div>
                        <span class="text-[9px] text-slate-300 font-bold block">Diamond üíé</span>
                        <span class="text-[9px] text-slate-200 font-bold block">2,99‚Ç¨</span>
                    </button>
                </div>

                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest pt-2">Effets de nom</p>
                <div class="space-y-2">
                    <div class="flex items-center gap-3 card rounded-xl p-3">
                        <span class="text-sm font-black"
                            style="background:linear-gradient(90deg,#00bad6,#22d3ee);-webkit-background-clip:text;-webkit-text-fill-color:transparent">SwellSurfer</span>
                        <div class="flex-1">
                            <p class="text-[10px] text-slate-500">Nom en d√©grad√© ocean</p>
                        </div>
                        <button
                            class="bg-[#00bad6] text-[#000] font-bold text-xs px-3 py-1.5 rounded-lg active:scale-95 transition-transform"
                            onclick="buyEffect('gradient')">0,99‚Ç¨</button>
                    </div>
                    <div class="flex items-center gap-3 card rounded-xl p-3">
                        <span class="text-sm font-black"
                            style="background:linear-gradient(90deg,#f59e0b,#f97316);-webkit-background-clip:text;-webkit-text-fill-color:transparent">SwellSurfer</span>
                        <div class="flex-1">
                            <p class="text-[10px] text-slate-500">Nom en d√©grad√© fire</p>
                        </div>
                        <button
                            class="font-bold text-xs px-3 py-1.5 rounded-lg active:scale-95 transition-transform text-black"
                            style="background:linear-gradient(135deg,#f59e0b,#f97316)"
                            onclick="buyEffect('fire')">0,99‚Ç¨</button>
                    </div>
                    <div class="flex items-center gap-3 card rounded-xl p-3" style="border-color:rgba(168,85,247,.2)">
                        <span class="text-sm font-black"
                            style="background:linear-gradient(90deg,#a855f7,#ec4899,#f43f5e);-webkit-background-clip:text;-webkit-text-fill-color:transparent">SwellSurfer
                            ‚ú®</span>
                        <div class="flex-1">
                            <p class="text-[10px] text-slate-500">Nom arc-en-ciel + sparkle</p>
                        </div>
                        <button
                            class="font-bold text-xs px-3 py-1.5 rounded-lg active:scale-95 transition-transform text-white"
                            style="background:linear-gradient(135deg,#a855f7,#ec4899)"
                            onclick="buyEffect('rainbow')">1,99‚Ç¨</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reply Modal -->
    <div id="replyModal" class="fixed inset-0 z-[200] hidden items-end justify-center bg-black/60 backdrop-blur-sm">
        <div class="w-full max-w-lg bg-[#111] rounded-t-3xl border-t border-[#00bad6]/20 p-5 space-y-3">
            <div class="flex items-center justify-between">
                <h3 class="font-black text-sm">üí¨ R√©pondre</h3>
                <button onclick="closeReplyModal()" class="text-slate-400"><span
                        class="material-symbols-outlined text-lg">close</span></button>
            </div>
            <div id="replyContext" class="reply-box text-xs text-slate-400"></div>
            <div class="flex gap-2.5">
                <div
                    class="w-8 h-8 rounded-full bg-[#00bad6]/20 flex items-center justify-center font-bold text-[#00bad6] text-sm shrink-0 active:scale-95 transition-transform">
                    S</div>
                <textarea id="replyText" rows="3" placeholder="Ta r√©ponse‚Ä¶"
                    class="flex-1 bg-[#000] rounded-xl px-3 py-2 text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-1 focus:ring-[#00bad6]/40 border border-[#00bad6]/10 resize-none"></textarea>
            </div>
            <button onclick="submitReply()"
                class="w-full bg-[#00bad6] text-[#000] font-black py-3 rounded-xl text-sm active:scale-95 transition-transform">Publier
                la
                r√©ponse</button>
        </div>
    </div>

    <!-- Bottom Nav -->
    <nav class="fixed bottom-0 left-0 right-0 border-t border-[#00bad6]/20 pb-6 pt-2 px-2 flex justify-between items-center z-50 backdrop-blur-lg transition-colors duration-300"
        style="background: var(--nav-bg, rgba(8,15,26,0.95))">
        <a class="flex flex-col items-center gap-1 text-slate-500 flex-1" href="home.html"><span
                class="material-symbols-outlined">home</span><span class="text-[10px]">Home</span>

        </a>
        <a class="flex flex-col items-center gap-1 text-slate-500 flex-1" href="map.html"><span
                class="material-symbols-outlined">travel_explore</span><span class="text-[10px]">Spots</span></a>
        <a class="flex flex-col items-center gap-1 text-slate-500 flex-1" href="alerts.html"><span
                style="position:relative;display:inline-block;"><span
                    class="material-symbols-outlined">notifications</span><span
                    style="position:absolute;top:-1px;left:-3px;font-size:8px;line-height:1;z-index:2;display:inline-flex;align-items:center;justify-content:center;background:#f59e0b;border-radius:50%;width:11px;height:11px;font-weight:900;color:#000;">‚≠ê</span></span><span
                class="text-[10px]">Alertes</span></a>
        <a class="flex flex-col items-center gap-1 text-[#00bad6] flex-1" href="community.html"><span
                class="material-symbols-outlined" style="font-variation-settings:\'FILL\' 1">groups</span><span
                class="text-[10px] font-bold">Communaut√©</span>
            <div class="w-1 h-1 bg-[#00bad6] rounded-full mt-0.5 active:scale-95 transition-transform"></div>
        </a>
        <a class="flex flex-col items-center gap-1 text-slate-500 flex-1" href="profile.html"><span
                class="material-symbols-outlined">person</span><span class="text-[10px]">Profil</span></a>
    </nav>

    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // DATA
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const BADGES = {
            'Pays Basque': { icon: 'landscape', gradient: 'linear-gradient(135deg,#ef4444,#b91c1c)', label: 'Pays Basque' },
            'Landes': { icon: 'forest', gradient: 'linear-gradient(135deg,#16a34a,#15803d)', label: 'Landes' },
            'Bretagne': { icon: 'anchor', gradient: 'linear-gradient(135deg,#111827,#374151)', label: 'Bretagne' },
            'R√©union': { icon: 'volcano', gradient: 'linear-gradient(135deg,#f97316,#ea580c)', label: 'La R√©union' },
            'Guadeloupe': { icon: 'beach_access', gradient: 'linear-gradient(135deg,#06b6d4,#0891b2)', label: 'Guadeloupe' },
            'Shortboard': { icon: 'surfing', gradient: 'linear-gradient(135deg,#00bad6,#0891b2)', label: 'Shortboard' },
            'Elite': { icon: 'military_tech', gradient: 'linear-gradient(135deg,#f59e0b,#d97706)', label: 'Elite' },
            'Pro': { icon: 'workspace_premium', gradient: 'linear-gradient(135deg,#7c3aed,#a855f7)', label: 'Pro Star' },
        };

        let POSTS = [
            {
                id: 1, user: 'Jer√¥meS', av: 'J', color: 'bg-[#00bad6]/20 text-[#00bad6]', badges: ['Pro', 'Pays Basque'], tag: 'session', time: '2min',
                text: 'Session incroyable √† Hossegor ce matin üî• 2m+ de houle, vent offshore parfait √† 20km/h. La Gravi√®re √©tait √©pique !',
                img: 'https://images.unsplash.com/photo-1502680390469-be75c86b636f?w=800&q=80',
                likes: 12, liked: false, replies: [{ user: 'MarieLR', text: 'Trop jalouse ! Quelle heure tu y √©tais ? üòç', time: '1min' }]
            },
            {
                id: 2, user: 'MarieLR', av: 'M', color: 'bg-purple-500/20 text-purple-400', badges: ['Bretagne'], tag: 'question', time: '18min',
                text: "Quelqu'un a des infos sur La Torche ce week-end ? üèÑ‚Äç‚ôÄÔ∏è Je pr√©vois d'y aller samedi matin.",
                likes: 5, liked: false, replies: [{ user: 'AlexS29', text: "Conditions annonc√©es 1.5m propre, foule mod√©r√©e samedi matin !", time: '15min' }]
            },
            {
                id: 3, user: 'AlexSurf29', av: 'A', color: 'bg-emerald-500/20 text-emerald-400', badges: ['Bretagne'], tag: 'houle', time: '1h',
                text: 'Houle 2.8m pr√©vue vendredi sur la c√¥te basque selon Stormglass. Qui sera √† Hossegor ? ü§ô',
                likes: 23, liked: false, replies: []
            },
            {
                id: 4, user: 'SurfGuide64', av: 'S', color: 'bg-amber-500/20 text-amber-400', badges: ['Pro', 'Landes'], tag: 'spot', time: '2h',
                text: 'Note session Bidart 7/10 ‚Äî Fond sable parfait, mais foule au pic. Allez plut√¥t √† 7h du matin pour √©viter la foule.',
                img: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=800&q=80',
                likes: 18, liked: false, replies: [{ user: 'J√©r√¥meS', text: 'Confirme ! 6h30-9h c\'est le paradis √† Bidart', time: '1h50' }]
            },
            {
                id: 5, user: 'BretagneSurf', av: 'B', color: 'bg-red-500/20 text-red-400', badges: ['Bretagne'], tag: 'session', time: '3h',
                text: 'La Palue absolument vide hier avec 1.5m propre üòç Seuls 4 surfeurs √† l\'eau. Bretagne > tout le reste !',
                likes: 31, liked: false, replies: []
            },
            {
                id: 6, user: 'WSL_Follow', av: 'W', color: 'bg-red-600/20 text-red-500', badges: ['WSL'], tag: 'competition', time: '5h',
                text: 'üèÜ R√©sultats Quik Pro France : Kelly Slater en 1/4 de finale ! Hossegor en feu cette semaine üî•üî•',
                likes: 67, liked: false, replies: []
            },
        ];

        const SESSIONS = [
            { id: 1, spot: 'Hossegor ‚Äî La Gravi√®re', wave: '2m ‚Äî 2.5m', score: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê', date: 'Auj.', note: 'Session incroyable, vent offshore parfait' },
            { id: 2, spot: 'Biarritz ‚Äî C√¥te des Basques', wave: '1m ‚Äî 1.5m', score: '‚≠ê‚≠ê‚≠ê‚≠ê', date: 'Hier', note: 'Fond sable propre, bonne foule' },
            { id: 3, spot: 'La Torche', wave: '1.5m ‚Äî 2m', score: '‚≠ê‚≠ê‚≠ê‚≠ê', date: 'Sam.', note: 'Conditions parfaites le matin' },
        ];

        const RANKING_USERS = [
            { rank: 1, user: 'Jer√¥meS', av: 'J', color: 'text-amber-400', badges: ['Pro', 'Pays Basque'], sessions: 42, likes: 247, region: 'Pays Basque' },
            { rank: 2, user: 'MarieLR', av: 'M', color: 'text-purple-400', badges: ['Bretagne'], sessions: 38, likes: 189, region: 'Bretagne' },
            { rank: 3, user: 'AlexSurf29', av: 'A', color: 'text-emerald-400', badges: ['Bretagne'], sessions: 31, likes: 143, region: 'Bretagne' },
            { rank: 4, user: 'SurfGuide64', av: 'S', color: 'text-amber-300', badges: ['Pro', 'Landes'], sessions: 28, likes: 201, region: 'Landes' },
            { rank: 5, user: 'BretagneSurf', av: 'B', color: 'text-red-400', badges: ['Bretagne'], sessions: 25, likes: 167, region: 'Bretagne' },
            { rank: 6, user: 'WSL_Follow', av: 'W', color: 'text-red-500', badges: ['WSL'], sessions: 22, likes: 312, region: 'Pays Basque' },
            { rank: 7, user: 'PicoPescado', av: 'P', color: 'text-sky-400', badges: ['Landes'], sessions: 19, likes: 88, region: 'Landes' },
            { rank: 8, user: 'FloB64', av: 'F', color: 'text-violet-400', badges: ['Pays Basque'], sessions: 17, likes: 76, region: 'Pays Basque' },
        ];

        let currentFilter = 'all';
        let activeTag = null;
        let replyingToId = null;

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // TABS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function switchTab(tab, el) {
            document.querySelectorAll('[id^="tab-"]').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-' + tab).classList.remove('hidden');
            el.classList.add('active');
            if (tab === 'ranking') renderRanking();
            if (tab === 'sessions') renderSessions();
            if (tab === 'spots') renderCommunitySpots();
        }

        // Monthly rotation seed
        function monthSeed() {
            const d = new Date();
            return d.getFullYear() * 100 + d.getMonth();
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // BADGE
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function badgeHtml(b) {
            const bd = BADGES[b];
            if (!bd) return '';
            return `<span class="material-symbols-outlined" style="font-size:16px;display:inline-block;vertical-align:middle;flex-shrink:0;font-variation-settings:'FILL' 1;background:${bd.gradient};-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text" title="${bd.label}">${bd.icon}</span>`;
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // FILTER + FEED
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function setFilter(f, el) {
            currentFilter = f;
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            renderFeed();
        }

        function toggleTag(t) {
            activeTag = activeTag === t ? null : t;
            document.querySelectorAll('.post-tag').forEach(b => {
                b.classList.remove('bg-[#00bad6]/20', 'text-[#00bad6]', 'border-[#00bad6]/40');
                b.classList.add('text-slate-400');
            });
            if (activeTag) {
                const el = document.getElementById('tag-' + activeTag);
                if (el) { el.classList.add('bg-[#00bad6]/20', 'text-[#00bad6]', 'border-[#00bad6]/40'); el.classList.remove('text-slate-400'); }
            }
        }

        function tagLabel(t) { return { session: 'üèÑ Session', spot: 'üìç Spot', houle: 'üåä Houle', competition: 'üèÜ Comp√©tition', question: '‚ùì Question' }[t] || t; }

        function renderFeed() {
            const posts = currentFilter === 'all' ? POSTS : POSTS.filter(p => p.tag === currentFilter);
            document.getElementById('feed').innerHTML = posts.map(p => postHtml(p)).join('');
        }

        function postHtml(p) {
            const repliesHtml = p.replies.map(r => `
        <div class="reply-box flex gap-2 mt-2">
            <div class="w-5 h-5 rounded-full bg-slate-600 flex items-center justify-center text-[9px] font-bold text-slate-300 shrink-0">${r.user[0]}</div>
            <div class="flex-1">
                <span class="text-[10px] font-bold text-slate-300">${r.user}</span>
                <span class="text-[9px] text-slate-500 ml-1">${r.time}</span>
                <p class="text-[11px] text-slate-300 mt-0.5">${r.text}</p>
            </div>
        </div>`).join('');

            const imgHtml = p.img ? `
        <div class="rounded-xl overflow-hidden mt-1 cursor-pointer relative group" onclick="openLightbox('${p.img}')">
            <img src="${p.img}" alt="Post photo" loading="lazy"
                class="w-full max-h-64 object-cover rounded-xl transition-transform group-hover:scale-[1.02]"/>
            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors rounded-xl flex items-center justify-center">
                <span class="material-symbols-outlined text-white text-2xl opacity-0 group-hover:opacity-80 transition-opacity">zoom_in</span>
            </div>
        </div>` : '';

            return `<div class="post-enter card rounded-2xl p-3.5 space-y-2.5" id="post-${p.id}">
        <div class="flex items-start gap-2.5">
            <div class="w-9 h-9 rounded-full ${p.color} flex items-center justify-center font-black shrink-0 text-sm">${p.av}</div>
            <div class="flex-1 min-w-0">
                <div class="flex items-center gap-1.5 flex-wrap">
                    <span class="font-black text-sm">${p.user}</span>
                    ${p.badges.map(badgeHtml).join('')}
                    <span class="text-[9px] text-slate-500 ml-auto shrink-0">${p.time}</span>
                </div>
                <span class="text-[9px] bg-[#00bad6]/10 text-[#00bad6] px-2 py-0.5 rounded-full font-semibold mt-1 inline-block active:scale-95 transition-transform">${tagLabel(p.tag)}</span>
                ${p.text ? `<p class="text-sm text-slate-200 mt-1.5 leading-relaxed">${p.text}</p>` : ''}
            </div>
        </div>
        ${imgHtml}
        ${repliesHtml}
        <div class="flex items-center gap-4 pt-1 border-t border-white/5">
            <button onclick="toggleLike(${p.id}, this)" class="like-btn flex items-center gap-1.5 text-[11px] ${p.liked ? 'text-red-400 liked' : 'text-slate-400'} hover:text-red-400 transition-colors">
                <span class="material-symbols-outlined text-[16px]" style="font-variation-settings:'FILL' ${p.liked ? 1 : 0}">${p.liked ? 'favorite' : 'favorite_border'}</span>
                <span class="like-count">${p.likes + (p.liked ? 0 : 0)}</span>
            </button>
            <button onclick="openReplyModal(${p.id})" class="flex items-center gap-1.5 text-[11px] text-slate-400 hover:text-[#00bad6] transition-colors">
                <span class="material-symbols-outlined text-[16px]">chat_bubble_outline</span>
                <span>${p.replies.length}</span>
            </button>
            <button onclick="sharePost(${p.id})" class="flex items-center gap-1.5 text-[11px] text-slate-400 hover:text-[#00bad6] transition-colors ml-auto">
                <span class="material-symbols-outlined text-[16px]">share</span>
                Partager
            </button>
        </div>
    </div>`;
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // ACTIONS: LIKE / REPLY / SHARE
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function toggleLike(postId, btn) {
            const p = POSTS.find(x => x.id === postId);
            if (!p) return;
            p.liked = !p.liked;
            p.likes += p.liked ? 1 : -1;
            const countEl = btn.querySelector('.like-count');
            if (countEl) countEl.textContent = p.likes;
            btn.classList.toggle('liked', p.liked);
            const icon = btn.querySelector('.material-symbols-outlined');
            if (icon) { icon.style.fontVariationSettings = p.liked ? "'FILL' 1" : "'FILL' 0"; icon.textContent = p.liked ? 'favorite' : 'favorite_border'; }
            btn.style.color = p.liked ? '#f43f5e' : '';
        }

        function openReplyModal(postId) {
            replyingToId = postId;
            const p = POSTS.find(x => x.id === postId);
            if (!p) return;
            document.getElementById('replyContext').innerHTML = `<span class="font-bold text-slate-300">${p.user}:</span> ${p.text.substring(0, 80)}${p.text.length > 80 ? '‚Ä¶' : ''}`;
            document.getElementById('replyText').value = '';
            document.getElementById('replyModal').classList.replace('hidden', 'flex');
        }
        function closeReplyModal() { document.getElementById('replyModal').classList.replace('flex', 'hidden'); replyingToId = null; }

        function submitReply() {
            const text = document.getElementById('replyText').value.trim();
            if (!text || !replyingToId) return;
            const p = POSTS.find(x => x.id === replyingToId);
            if (!p) return;
            p.replies.push({ user: 'Moi', text, time: 'maintenant' });
            closeReplyModal();
            renderFeed();
        }

        function sharePost(postId) {
            const p = POSTS.find(x => x.id === postId);
            if (!p) return;
            const shareUrl = `${window.location.origin}/pages/community.html#post-${postId}`;
            if (navigator.share) {
                navigator.share({ title: 'SwellSync Communaut√©', text: `${p.user}: ${p.text}`, url: shareUrl }).catch(() => { });
            } else {
                navigator.clipboard.writeText(shareUrl).then(() => showToast('Lien copi√© ! üîó', 'success'));
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // SUBMIT POST
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // Photo upload
        let pendingPhotoUrl = null;
        function previewPhoto(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = ev => {
                pendingPhotoUrl = ev.target.result;
                document.getElementById('photoPreviewImg').src = pendingPhotoUrl;
                document.getElementById('photoPreview').classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }
        function removePhoto() {
            pendingPhotoUrl = null;
            document.getElementById('postPhotoInput').value = '';
            document.getElementById('photoPreview').classList.add('hidden');
            document.getElementById('photoPreviewImg').src = '';
        }

        function submitPost() {
            const text = document.getElementById('postText').value.trim();
            if (!text && !pendingPhotoUrl) return;
            POSTS.unshift({
                id: Date.now(), user: 'Moi', av: 'M',
                color: 'bg-[#00bad6]/20 text-[#00bad6]', badges: [],
                tag: activeTag || 'session', time: 'maintenant',
                text: text || '', likes: 0, liked: false, replies: [],
                img: pendingPhotoUrl || null
            });
            document.getElementById('postText').value = '';
            removePhoto();
            activeTag = null;
            document.querySelectorAll('.post-tag').forEach(b => { b.classList.remove('bg-[#00bad6]/20', 'text-[#00bad6]', 'border-[#00bad6]/40'); b.classList.add('text-slate-400'); });
            renderFeed();
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // RANKING ‚Äî Monthly rotation + clickable profiles
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function renderRanking() {
            // Monthly rotation based on seed
            const seed = monthSeed();
            const rotated = [...RANKING_USERS].sort((a, b) => {
                // Pseudo-shuffle based on month seed + rank
                const sa = (a.rank * 31 + seed * 7) % 17;
                const sb = (b.rank * 31 + seed * 7 + 3) % 17;
                return sa - sb;
            }).map((u, i) => ({ ...u, rank: i + 1 }));

            const profileIds = ['jeromesS', 'marieLR', 'alexSurf29', 'surfGuide64', 'bretagneSurf', '', '', ''];

            // Update podium to be clickable
            const podiumTop = rotated.slice(0, 3);

            // Section label for clarity
            const monthName = new Date().toLocaleString('fr-FR', { month: 'long', year: 'numeric' });

            const top4 = rotated.slice(3);
            document.getElementById('fullRanking').innerHTML =
                `<div class="card rounded-2xl p-3 mb-1">
                    <p class="text-[10px] text-slate-500 font-black uppercase tracking-widest mb-2">üìä Suite du classement ‚Äî ${monthName}</p>
                    ${top4.map((u, i) => `<div class="flex items-center gap-3 py-2.5 border-b border-white/5 last:border-0 cursor-pointer hover:bg-[#00bad6]/5 rounded-lg transition-colors px-1 active:scale-95 transition-transform" onclick="window.location.href='user-profile.html?id=${profileIds[i + 3] || 'jeromesS'}'">
                        <span class="text-slate-400 font-black text-sm w-6 text-center shrink-0">${u.rank}</span>
                        <div class="w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center font-black ${u.color} text-sm shrink-0">${u.av}</div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-1 flex-wrap"><span class="font-bold text-sm">${u.user}</span>${u.badges.map(badgeHtml).join('')}</div>
                            <p class="text-[9px] text-slate-500">${u.region} ¬∑ ${u.sessions} sessions</p>
                        </div>
                        <div class="text-right shrink-0">
                            <span class="text-[#00bad6] font-bold text-sm">${u.likes}</span>
                            <p class="text-[9px] text-slate-500">‚ù§Ô∏è likes</p>
                        </div>
                    </div>`).join('')}
                </div>`;
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // SESSIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function renderSessions() {
            document.getElementById('sessionsList').innerHTML = SESSIONS.map(s => `
        <div class="card rounded-2xl p-3.5 flex gap-3 items-start">
            <div class="w-10 h-10 rounded-xl bg-[#00bad6]/20 flex items-center justify-center shrink-0 active:scale-95 transition-transform"><span class="material-symbols-outlined text-[#00bad6] text-[20px]">surfing</span></div>
            <div class="flex-1 min-w-0">
                <div class="flex items-center justify-between"><span class="font-bold text-sm truncate">${s.spot}</span><span class="text-[9px] text-slate-500 shrink-0">${s.date}</span></div>
                <div class="flex items-center gap-2 mt-1"><span class="text-[#00bad6] text-xs font-bold">${s.wave}</span><span class="text-slate-500 text-xs">¬∑</span><span class="text-xs">${s.score}</span></div>
                <p class="text-[11px] text-slate-400 mt-1">${s.note}</p>
            </div>
        </div>`).join('');
        }

        function openLogSession() { document.getElementById('logModal').classList.replace('hidden', 'flex'); }
        function closeLogSession() { document.getElementById('logModal').classList.replace('flex', 'hidden'); }
        function submitSession() {
            const spot = document.getElementById('logSpot').value, wave = document.getElementById('logWave').value, score = document.getElementById('logScore').value, note = document.getElementById('logNote').value;
            if (!spot) { showToast('Choisis un spot !', 'warning'); return; }
            SESSIONS.unshift({ id: Date.now(), spot, wave, score, date: 'maintenant', note: note || '‚Äî' });
            closeLogSession(); renderSessions();
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // COMMUNITY SPOTS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function renderCommunitySpots() {
            const spots = [
                { name: 'Hossegor ‚Äî La Gravi√®re', loc: 'Landes', cond: 'Excellent', h: '2.5m', reports: 14, rating: '4.9' },
                { name: 'Biarritz ‚Äî C√¥te des Basques', loc: 'Pays Basque', cond: 'Bon', h: '1.2m', reports: 8, rating: '4.2' },
                { name: 'La Torche', loc: 'Bretagne', cond: 'Correct', h: '1.8m', reports: 6, rating: '3.8' },
                { name: 'Lacanau Ocean', loc: 'Gironde', cond: 'Bon', h: '1.5m', reports: 9, rating: '4.1' },
                { name: 'Seignosse ‚Äî Les Bourdaines', loc: 'Landes', cond: 'Excellent', h: '2.1m', reports: 11, rating: '4.7' },
            ];
            const condColor = c => ({ Excellent: 'text-emerald-400', Bon: 'text-[#00bad6]', Correct: 'text-amber-400', Mauvais: 'text-red-400' }[c] || 'text-slate-400');
            document.getElementById('communitySpots').innerHTML = spots.map(s => `
        <div class="card rounded-2xl p-3.5 flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-[#00bad6]/15 flex items-center justify-center shrink-0 active:scale-95 transition-transform"><span class="material-symbols-outlined text-[#00bad6]">place</span></div>
            <div class="flex-1 min-w-0"><p class="font-bold text-sm truncate">${s.name}</p><p class="text-[10px] text-slate-400">${s.loc}</p><div class="flex items-center gap-2 mt-0.5"><span class="text-xs font-bold ${condColor(s.cond)}">${s.cond}</span><span class="text-slate-500 text-xs">¬∑</span><span class="text-xs text-[#00bad6] font-bold">${s.h}</span></div></div>
            <div class="text-right shrink-0"><span class="text-amber-400 font-bold text-sm">‚òÖ ${s.rating}</span><p class="text-[9px] text-slate-500">${s.reports} rapports</p></div>
        </div>`).join('');
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // BADGE SHOP
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function showBadgeShop() { document.getElementById('badgeShopModal').classList.replace('hidden', 'flex'); }
        function closeBadgeShop() { document.getElementById('badgeShopModal').classList.replace('flex', 'hidden'); }
        function buyBadge(name, price) {
            const btn = event.target;
            const origText = btn.textContent;
            btn.textContent = '‚è≥...';
            btn.disabled = true;

            fetch('/api/stripe/buy-badge', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({
                    badge_id: name.toLowerCase().replace(/\s+/g, '_'),
                    badge_name: name,
                    price: price
                })
            })
                .then(r => r.json())
                .then(data => {
                    if (data.url) {
                        // Rediriger vers Stripe Checkout
                        window.location.href = data.url;
                    } else if (data.demo) {
                        // Mode d√©mo ‚Äî pas connect√© ou pas de Stripe
                        const m = document.createElement('div');
                        m.className = 'fixed inset-0 z-[999] flex items-center justify-center bg-black/70 backdrop-blur-sm';
                        m.innerHTML = `<div class="bg-[#111] rounded-3xl border border-[#00bad6]/20 p-8 max-w-sm mx-4 text-center shadow-2xl">
                        <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-[#00bad6] to-emerald-400 flex items-center justify-center mx-auto mb-4"><span class="material-symbols-outlined text-3xl text-[#000]" style="font-variation-settings:'FILL' 1">shopping_bag</span></div>
                        <h3 class="text-xl font-black mb-2">Badge ${name}</h3>
                        <p class="text-2xl font-black text-[#00bad6] mb-2">${price.toFixed(2)}‚Ç¨</p>
                        <p class="text-sm text-slate-400 mb-4">Connecte-toi pour acheter ce badge via Stripe.</p>
                        <button onclick="this.closest('.fixed').remove()" class="w-full py-3 rounded-2xl bg-[#00bad6] font-black text-sm text-[#000] active:scale-95 transition-transform">Compris !</button>
                    </div>`;
                        document.body.appendChild(m);
                        m.addEventListener('click', e => { if (e.target === m) m.remove(); });
                    } else {
                        showToast(data.error || 'Erreur paiement', 'error');
                    }
                })
                .catch(() => showToast('Erreur r√©seau', 'error'))
                .finally(() => {
                    btn.textContent = origText;
                    btn.disabled = false;
                });
        }
        function unlockBadge() { showBadgeShop(); }

        function shopTab(tab) {
            ['badges', 'stickers', 'profil'].forEach(t => {
                document.getElementById('shopPanel' + t.charAt(0).toUpperCase() + t.slice(1)).classList.toggle('hidden', t !== tab);
                const btn = document.getElementById('shopTab' + t.charAt(0).toUpperCase() + t.slice(1));
                if (t === tab) { btn.className = 'flex-1 py-2 rounded-lg text-xs font-bold bg-[#00bad6] text-[#000]'; }
                else { btn.className = 'flex-1 py-2 rounded-lg text-xs font-bold text-slate-400'; }
            });
        }

        function buySticker(emoji, name) {
            const price = emoji === 'all' ? 2.99 : 0.49;
            showPurchaseModal('Sticker ' + name, emoji === 'all' ? 'üì¶' : emoji, price);
        }
        function buyFrame(type) {
            const prices = { ocean: 0.99, fire: 0.99, gold: 1.49, rainbow: 1.99, neon: 1.99, diamond: 2.99 };
            showPurchaseModal('Cadre ' + type.charAt(0).toUpperCase() + type.slice(1), 'üñºÔ∏è', prices[type] || 0.99);
        }
        function buyEffect(type) {
            const prices = { gradient: 0.99, fire: 0.99, rainbow: 1.99 };
            showPurchaseModal('Effet ' + type.charAt(0).toUpperCase() + type.slice(1), '‚ú®', prices[type] || 0.99);
        }
        function showPurchaseModal(name, icon, price) {
            const m = document.createElement('div');
            m.className = 'fixed inset-0 z-[999] flex items-center justify-center bg-black/70 backdrop-blur-sm';
            m.innerHTML = `<div class="bg-[#111] rounded-3xl border border-[#00bad6]/20 p-8 max-w-sm mx-4 text-center shadow-2xl">
                <div class="text-5xl mb-4">${icon}</div>
                <h3 class="text-xl font-black mb-2">${name}</h3>
                <p class="text-2xl font-black text-[#00bad6] mb-2">${price.toFixed(2)}‚Ç¨</p>
                <p class="text-sm text-slate-400 mb-4">Connecte-toi pour acheter cet article via Stripe.</p>
                <button onclick="this.closest('.fixed').remove()" class="w-full py-3 rounded-2xl bg-[#00bad6] font-black text-sm text-[#000] active:scale-95 transition-transform">Compris !</button>
            </div>`;
            document.body.appendChild(m);
            m.addEventListener('click', e => { if (e.target === m) m.remove(); });
        }

        function showSearch() { window.location.href = 'search.html'; }

        // Init
        renderFeed();
        try { API.auth.me().then(me => { if (me?.name) { document.getElementById('compAvatar').textContent = me.name[0].toUpperCase(); } }).catch(() => { }); } catch (e) { }

        // ‚îÄ‚îÄ Highlight post from URL hash (e.g. community.html#post-3) ‚îÄ‚îÄ
        function highlightPost() {
            const hash = window.location.hash; // #post-3
            if (!hash || !hash.startsWith('#post-')) return;
            const postId = parseInt(hash.replace('#post-', ''));
            if (!postId) return;
            const el = document.getElementById('post-' + postId);
            if (!el) return;
            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
            // Add highlight animation
            setTimeout(() => {
                el.classList.add('post-highlight');
                setTimeout(() => el.classList.remove('post-highlight'), 3000);
            }, 400);
        }
        // Run after a short delay to allow renderFeed() to complete
        setTimeout(highlightPost, 300);

        // Follow notification handler from SW
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.addEventListener('message', e => {
                if (e.data?.type === 'FOLLOW_NOTIF') {
                    // Could show an in-app toast here
                }
            });
        }


        // Handle new post modal
        function openNewPostModal() {
            document.getElementById('newPostModal').classList.replace('hidden', 'flex');
            document.getElementById('postContent').focus();
        }
        function closeNewPostModal() {
            document.getElementById('newPostModal').classList.replace('flex', 'hidden');
            document.getElementById('postContent').value = '';
        }
        function submitNewPost() {
            const content = document.getElementById('postContent').value.trim();
            if (!content) return;
            const btn = document.getElementById('submitPostBtn');
            btn.innerHTML = '<span class="material-symbols-outlined animate-spin">sync</span> Publication...';
            // Simulate API call
            setTimeout(() => {
                closeNewPostModal();
                btn.innerHTML = '<span class="material-symbols-outlined">send</span> Publier';
                showToast('Ton message a √©t√© publi√© ! üéâ', 'success');
            }, 800);
        }
    </script>

    <!-- FAB Ajouter Post -->
    <div class="fixed bottom-24 right-6 z-40">
        <button onclick="openNewPostModal()"
            class="w-14 h-14 bg-[#00bad6] text-[#000] rounded-full flex items-center justify-center shadow-lg shadow-[#00bad6]/30 hover:scale-105 active:scale-95 transition-transform">
            <span class="material-symbols-outlined text-[28px]">add</span>
        </button>
    </div>

    <!-- Modale Nouveau Post -->
    <div id="newPostModal"
        class="hidden fixed inset-0 z-50 items-center justify-center bg-black/60 backdrop-blur-sm p-4">
        <div class="w-full max-w-md bg-[#111] rounded-3xl border border-[#00bad6]/20 p-5 shadow-2xl relative">
            <button onclick="closeNewPostModal()"
                class="absolute top-4 right-4 text-slate-400 hover:text-white transition-colors">
                <span class="material-symbols-outlined">close</span>
            </button>
            <h2 class="text-xl font-bold mb-4">Nouveau message</h2>
            <textarea id="postContent"
                class="w-full h-32 bg-black/20 border border-white/10 rounded-xl p-4 text-sm text-white focus:outline-none focus:border-[#00bad6]/40 resize-none mb-4"
                placeholder="Partage tes infos sur le spot, une question, une observation..."></textarea>

            <div class="flex items-center justify-between">
                <div class="flex gap-2">
                    <button
                        class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-[#00bad6] hover:bg-white/10 transition-colors">
                        <span class="material-symbols-outlined">add_photo_alternate</span>
                    </button>
                    <button
                        class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-emerald-400 hover:bg-white/10 transition-colors">
                        <span class="material-symbols-outlined">location_on</span>
                    </button>
                </div>
                <button id="submitPostBtn" onclick="submitNewPost()"
                    class="px-6 py-2.5 bg-[#00bad6] text-[#000] font-bold rounded-xl flex items-center gap-2 hover:opacity-90 transition-opacity active:scale-95 transition-transform">
                    <span class="material-symbols-outlined text-sm">send</span> Publier
                </button>
            </div>
        </div>
    </div>
    <!-- Image Lightbox -->
    <div id="imageLightbox"
        class="hidden fixed inset-0 z-[500] items-center justify-center bg-black/92 backdrop-blur-md"
        onclick="if(event.target===this)closeLightbox()">
        <button onclick="closeLightbox()"
            class="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/10 flex items-center justify-center">
            <span class="material-symbols-outlined text-white">close</span>
        </button>
        <img id="lightboxImg" src="" alt="Photo" class="max-w-full max-h-[90vh] object-contain rounded-xl shadow-2xl" />
    </div>

    <script>
        function openLightbox(src) {
            document.getElementById('lightboxImg').src = src;
            var lb = document.getElementById('imageLightbox');
            lb.classList.remove('hidden'); lb.classList.add('flex');
            document.body.style.overflow = 'hidden';
        }
        function closeLightbox() {
            var lb = document.getElementById('imageLightbox');
            lb.classList.add('hidden'); lb.classList.remove('flex');
            document.body.style.overflow = '';
        }
    </script>
    <script src="js/adsense.js"></script>
    <script src="js/share-social.js"></script>
    <script src="js/ui-components.js"></script>
    <script src="js/notif-badge.js"></script>
    <script src="js/stories.js"></script>
    <script src="/js/i18n.js"></script>
    <script src="/js/push_notifs.js" defer></script>
</body>

</html>
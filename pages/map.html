<!DOCTYPE html>
<html class="dark" lang="fr">

<head>
    <script src="js/app-guard.js"></script>
    <meta charset="utf-8" />
    <meta content="width=device-width,initial-scale=1.0" name="viewport" />
    <title>Carte des spots ‚Äî SwellSync</title>
    <meta property="og:type" content="website">
    <meta property="og:title" content="SwellSync ‚Äî Carte des Spots">
    <meta property="og:description" content="Carte interactive de 60+ spots de surf sur la c√¥te Atlantique.">
    <meta property="og:image" content="https://swellsync.fr/assets/images/swellsync_logo.png?v=3">
    <meta property="og:site_name" content="SwellSync">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://bxudysseskfpmlpagoid.supabase.co">
    <link rel="apple-touch-icon" href="/assets/images/swellsync_logo.png?v=3">
    <meta name="description"
        content="SwellSync Spots ‚Äî Trouvez les meilleurs spots de surf sur la c√¥te Atlantique avec conditions en temps r√©el.">
    <script src="js/theme.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script>tailwind.config = { darkMode: "class", theme: { extend: { colors: { "primary": "#00bad6", "background-dark": "#000", "card-dark": "#111", "background-light": "#f0f6ff", "card-light": "#ffffff" }, fontFamily: { "display": ["Space Grotesk", "sans-serif"] } } } }</script>
    <style>
        /* Dark */
        .dark body {
            background: #000;
            color: #f1f5f9
        }

        .dark .card {
            background: rgba(15, 36, 56, 0.8);
            border: 1px solid rgba(0, 186, 214, 0.12)
        }

        .dark .search-bar {
            background: rgba(15, 36, 56, 0.8);
            border: 1px solid rgba(0, 186, 214, 0.15);
            color: #f1f5f9
        }

        .dark .chip {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #94a3b8
        }

        .dark .chip.active {
            background: rgba(0, 186, 214, 0.2);
            border-color: rgba(0, 186, 214, 0.4);
            color: #00bad6
        }

        .dark .page-bg {
            background: #000
        }

        .dark .hdr {
            background: rgba(8, 15, 26, 0.85);
            backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(0, 186, 214, 0.1)
        }

        .dark .nav-bar {
            background: #000;
            border-top: 1px solid rgba(255, 255, 255, 0.06)
        }

        .dark .spot-title {
            color: #f1f5f9
        }

        .dark .spot-sub {
            color: #64748b
        }

        /* Light */
        .light body {
            background: #f0f6ff;
            color: #1e293b
        }

        .light .card {
            background: #fff;
            border: 1px solid #e2eaf4;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06)
        }

        .light .search-bar {
            background: #fff;
            border: 1px solid #c7dff7;
            color: #1e293b
        }

        .light .chip {
            background: #fff;
            border: 1px solid #e2eaf4;
            color: #64748b
        }

        .light .chip.active {
            background: rgba(0, 186, 214, 0.1);
            border-color: #00bad6;
            color: #0099b3
        }

        .light .page-bg {
            background: #f0f6ff
        }

        .light .hdr {
            background: rgba(240, 246, 255, 0.9);
            backdrop-filter: blur(16px);
            border-bottom: 1px solid #e2eaf4
        }

        .light .nav-bar {
            background: #fff;
            border-top: 1px solid #e2eaf4
        }

        .light .spot-title {
            color: #1e293b
        }

        .light .spot-sub {
            color: #64748b
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            min-height: max(884px, 100dvh)
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none
        }

        .skeleton {
            background: linear-gradient(90deg, rgba(0, 186, 214, .06) 25%, rgba(0, 186, 214, .12) 50%, rgba(0, 186, 214, .06) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.4s infinite
        }

        @keyframes shimmer {
            0% {
                background-position: 200% 0
            }

            100% {
                background-position: -200% 0
            }
        }
    </style>

    <style>
        :root {
            --bg-primary: #000;
            --bg-card: #111;
            --bg-nav: rgba(8, 15, 26, 0.95);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: rgba(0, 186, 214, 0.2);
        }

        .light {
            --bg-primary: #f0f4f8;
            --bg-card: #ffffff;
            --bg-nav: rgba(255, 255, 255, 0.95);
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --border-color: rgba(0, 186, 214, 0.15);
        }

        .light body {
            background: var(--bg-primary) !important;
            color: var(--text-primary) !important;
        }

        .light .card,
        .light [class*="bg-[#111]"] {
            background: var(--bg-card) !important;
        }

        .light [class*="bg-[#000]"] {
            background: var(--bg-primary) !important;
        }

        .light [class*="bg-[#111]"] {
            background: #f8fafc !important;
        }

        .light [class*="text-white"] {
            color: #0f172a !important;
        }

        .light [class*="text-slate-400"],
        .light [class*="text-slate-500"] {
            color: #64748b !important;
        }

        .light [class*="border-[#00bad6]"] {
            border-color: rgba(0, 186, 214, 0.25) !important;
        }

        .light nav[style*="--nav-bg"] {
            --nav-bg: rgba(255, 255, 255, 0.95) !important;
            border-color: rgba(0, 186, 214, 0.15) !important;
        }

        .light .section-label {
            color: #334155 !important;
        }

        .light .setting-row:hover {
            background: #e2e8f0 !important;
        }
    </style>

    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#00bad6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="/assets/images/swellsync_logo.png?v=3">
    <!-- Splash screens iOS -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3)" href="/assets/splash/splash-1290x2796.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3)" href="/assets/splash/splash-1179x2556.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)" href="/assets/splash/splash-1170x2532.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)" href="/assets/splash/splash-1125x2436.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" href="/assets/splash/splash-750x1334.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 360px) and (device-height: 780px) and (-webkit-device-pixel-ratio: 3)" href="/assets/splash/splash-1080x2340.png">
  <link rel="canonical" href="https://swellsync.fr/pages/map.html">
</head>

<body class="page-bg font-display pb-28">
  <a href="#main-content" class="skip-link" style="position:absolute;top:-40px;left:0;background:#0ea5e9;color:#fff;padding:8px 16px;z-index:9999;border-radius:0 0 8px 0;font-weight:600;text-decoration:none;transition:top .2s" onfocus="this.style.top='0'" onblur="this.style.top='-40px'">Aller au contenu principal</a>

    <!-- Header sticky -->
    <header class="hdr sticky top-0 z-30 px-4 py-3 space-y-3">
        <div class="flex items-center gap-3">
            <span class="material-symbols-outlined text-[#00bad6]">travel_explore</span>
            <h1 class="text-xl font-bold flex-1">Spots</h1>
            <span id="spotCount"
                class="text-xs px-2.5 py-1 rounded-full bg-[#00bad6]/20 text-[#00bad6] font-bold active:scale-95 transition-transform">‚Äî</span>
        </div>
        <!-- Barre de recherche -->
        <div class="relative">
            <input id="searchInput" type="search" inputmode="search" placeholder="üîç  Chercher un spot, une ville‚Ä¶"
                class="search-bar w-full rounded-2xl px-4 py-3 pr-10 text-sm focus:outline-none focus:ring-2 focus:ring-[#00bad6]/40"
                oninput="onSearch(this.value)" />
            <button type="button" onclick="document.getElementById('searchInput').value='';onSearch('')"
                class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-[#00bad6] transition-colors">
                <span class="material-symbols-outlined text-[18px]">close</span>
            </button>
        </div>
        <!-- Filtres -->
        <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1">
            <button type="button" onclick="setChip('all',this)" data-val="all"
                class="chip active whitespace-nowrap text-xs font-semibold px-3 py-1.5 rounded-full">Tous</button>
            <button type="button" onclick="setChip('debutant',this)" data-val="debutant"
                class="chip whitespace-nowrap text-xs font-semibold px-3 py-1.5 rounded-full">üåä D√©butant</button>
            <button type="button" onclick="setChip('intermediaire',this)" data-val="intermediaire"
                class="chip whitespace-nowrap text-xs font-semibold px-3 py-1.5 rounded-full">‚ö° Inter.</button>
            <button type="button" onclick="setChip('avance',this)" data-val="avance"
                class="chip whitespace-nowrap text-xs font-semibold px-3 py-1.5 rounded-full">üî• Avanc√©</button>
            <button type="button" onclick="setChip('favs',this)" data-val="favs"
                class="chip whitespace-nowrap text-xs font-semibold px-3 py-1.5 rounded-full">‚ù§Ô∏è Favoris</button>
        </div>
    </header>

    <!-- Paywall favoris modal -->
    <div id="favPaywall"
        class="fixed inset-0 z-[200] hidden items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
        <div class="w-full max-w-xs bg-[#111] rounded-3xl border border-amber-400/30 overflow-hidden">
            <div class="p-6 text-center space-y-3">
                <div class="w-14 h-14 rounded-2xl bg-amber-400/20 flex items-center justify-center mx-auto">
                    <span class="material-symbols-outlined text-amber-400 text-3xl">favorite</span>
                </div>
                <h2 class="font-black text-base text-amber-300">Limite atteinte !</h2>
                <p class="text-xs text-slate-400 leading-relaxed">Les membres gratuits peuvent ajouter jusqu'√† <strong
                        class="text-white">3 spots en favoris</strong>. Passe √† <strong class="text-amber-400">SwellSync
                        Pro</strong> pour des favoris illimit√©s.</p>
                <a href="community.html"
                    class="flex items-center justify-center gap-2 w-full py-3 rounded-2xl font-black text-sm text-black"
                    style="background:linear-gradient(135deg,#f59e0b,#d97706)">
                    <span class="material-symbols-outlined text-[18px]">star</span>Passer Pro ‚Äî Favoris illimit√©s
                </a>
                <button type="button" onclick="document.getElementById('favPaywall').classList.replace('flex','hidden')"
                    class="w-full py-2 text-slate-500 text-xs">Plus tard</button>
            </div>
        </div>
    </div>

    <main id="list" class="px-4 py-4 space-y-3 max-w-lg mx-auto">
        <!-- Skeletons -->
        <div class="skeleton h-20 rounded-2xl"></div>
        <div class="skeleton h-20 rounded-2xl"></div>
        <div class="skeleton h-20 rounded-2xl"></div>
        <div class="skeleton h-20 rounded-2xl"></div>
        <div class="skeleton h-20 rounded-2xl"></div>
    </main>

    <!-- Bottom Nav -->
    <nav class="fixed bottom-0 left-0 right-0 border-t border-[#00bad6]/20 pb-6 pt-2 px-2 flex justify-between items-center z-50 backdrop-blur-lg transition-colors duration-300"
        style="background: var(--nav-bg, rgba(8,15,26,0.95))">
        <a class="flex flex-col items-center gap-1 text-slate-500 flex-1" href="home.html"><span
                class="material-symbols-outlined">home</span><span class="text-[10px]">Home</span>

        </a>
        <a class="flex flex-col items-center gap-1 text-[#00bad6] flex-1" href="map.html"><span
                class="material-symbols-outlined" style="font-variation-settings:\'FILL\' 1">travel_explore</span><span
                class="text-[10px] font-bold">Spots</span>
            <div class="w-1 h-1 bg-[#00bad6] rounded-full mt-0.5 active:scale-95 transition-transform"></div>
        </a>
        <a class="flex flex-col items-center gap-1 text-slate-500 flex-1" href="alerts.html"><span class="material-symbols-outlined">notifications</span><span
                class="text-[10px]">Alertes</span></a>
        <a class="flex flex-col items-center gap-1 text-slate-500 flex-1" href="community.html"><span
                class="material-symbols-outlined">groups</span><span class="text-[10px]">Communaut√©</span></a>
        <a class="flex flex-col items-center gap-1 text-slate-500 flex-1" href="profile.html"><span
                class="material-symbols-outlined">person</span><span class="text-[10px]">Profil</span></a>
    </nav>


    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <script src="js/api.js"></script>
    <script>
        // 12 images uniques pour les spots
        const SPOT_IMAGES = [
            'https://images.unsplash.com/photo-1502680390469-be75c86b636f?w=600&q=80', // barrel wave
            'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=600&q=80', // tropical beach
            'https://images.unsplash.com/photo-1505459668311-8dfac7952bf0?w=600&q=80', // sunset surf
            'https://images.unsplash.com/photo-1455729552457-5c322b29c789?w=600&q=80', // ocean wave
            'https://images.unsplash.com/photo-1519451241324-20b4ea2c4220?w=600&q=80', // beach aerial
            'https://images.unsplash.com/photo-1484291470158-b8f8d608850d?w=600&q=80', // big wave
            'https://images.unsplash.com/photo-1509914398892-963f53e6e2f1?w=600&q=80', // surfer silhouette
            'https://images.unsplash.com/photo-1416163785019-75f3889c56b0?w=600&q=80', // rocky coast
            'https://images.unsplash.com/photo-1476673160081-cf065607f449?w=600&q=80', // turquoise sea
            'https://images.unsplash.com/photo-1505142468610-359e7d316be0?w=600&q=80', // surfboard beach
            'https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=600&q=80', // dawn surf
            'https://images.unsplash.com/photo-1437719417032-8b217f069f31?w=600&q=80'  // wave closeup
        ];

        function getSpotImg(spot) {
            if (!spot) return SPOT_IMAGES[0];
            // Hash-based distribution pour images uniques par spot
            const hash = ((spot.id || 0) * 2654435761) >>> 0;
            return SPOT_IMAGES[hash % SPOT_IMAGES.length];
        }

        // R√©gions pour regroupement
        function getRegion(spot) {
            const loc = (spot.location || '').toLowerCase();
            const name = (spot.name || '').toLowerCase();
            if (loc.includes('landes') || name.includes('hossegor') || name.includes('seignosse') || name.includes('capbreton') || name.includes('graviere') || name.includes('moliets')) return 'Landes';
            if (loc.includes('basque') || loc.includes('biarritz') || name.includes('biarritz') || name.includes('guethary') || name.includes('anglet') || name.includes('hendaye') || name.includes('saint-jean')) return 'Pays Basque';
            if (loc.includes('bretagne') || name.includes('torche') || name.includes('palue') || name.includes('quiberon') || name.includes('crozon') || name.includes('presqu')) return 'Bretagne';
            if (loc.includes('gironde') || name.includes('lacanau') || name.includes('arcachon') || name.includes('le porge') || name.includes('hourtin')) return 'Gironde';
            if (loc.includes('charente') || name.includes('royan') || name.includes('ol√©ron') || name.includes('r√©')) return 'Charente-Maritime';
            if (loc.includes('vend√©e') || name.includes('sables') || name.includes('br√©tignolles') || name.includes('jaunay')) return 'Vend√©e';
            return 'Autres';
        }

        const REGION_EMOJIS = { 'Landes': 'üå≤', 'Pays Basque': 'üèîÔ∏è', 'Bretagne': '‚öì', 'Gironde': 'üç∑', 'Charente-Maritime': 'ü¶™', 'Vend√©e': '‚õµ', 'Autres': 'üèñÔ∏è' };
        const REGION_ORDER = ['Pays Basque', 'Landes', 'Gironde', 'Charente-Maritime', 'Vend√©e', 'Bretagne', 'Autres'];

        const MAX_FAVS_FREE = 3;
        let allSpots = [], favIds = [], currentFilter = 'all', query = '', isPro = false;
        const COND = ['Bon', 'Excellent', 'Correct', 'Tr√®s bon', 'Correct'];

        const diffLabel = d => ({ debutant: 'üåä D√©butant', intermediaire: '‚ö° Inter.', avance: 'üî• Avanc√©', expert: 'üíÄ Expert' }[d?.toLowerCase()] || d || '‚Äî');
        const condColor = c => ({ 'Excellent': 'text-[#00bad6]', 'Tr√®s bon': 'text-emerald-400', 'Bon': 'text-green-400', 'Correct': 'text-yellow-400' }[c] || 'text-slate-400');
        const diffColor = d => ({ debutant: 'bg-emerald-500/20 text-emerald-400', intermediaire: 'bg-yellow-500/20 text-yellow-400', avance: 'bg-orange-500/20 text-orange-400', expert: 'bg-red-500/20 text-red-400' }[d?.toLowerCase()] || 'bg-slate-700 text-slate-400');

        async function init() {
            try {
                allSpots = await API.spots.list();
                try {
                    const f = await API.favorites.list();
                    favIds = f.map(x => x.spot_id);
                } catch { }
                try {
                    const me = await API.auth.me();
                    isPro = !!me.is_pro;
                } catch { }
                document.getElementById('spotCount').textContent = allSpots.length + ' spots';
                render();
            } catch {
                document.getElementById('list').innerHTML = '<p class="text-slate-500 text-sm text-center py-10">Impossible de charger les spots.<br/>V√©rifie que le serveur tourne.</p>';
            }
        }

        function norm(s) {
            return (s || '').normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
        }

        function getFiltered() {
            let spots = allSpots;
            if (currentFilter === 'favs') spots = spots.filter(s => favIds.includes(s.id));
            else if (currentFilter !== 'all') spots = spots.filter(s => norm(s.difficulty).includes(norm(currentFilter)));
            if (query) {
                const q = query.toLowerCase();
                spots = spots.filter(s => s.name.toLowerCase().includes(q) || s.location.toLowerCase().includes(q));
            }
            return spots;
        }

        async function toggleFav(e, spotId) {
            e.preventDefault(); e.stopPropagation();
            const isFav = favIds.includes(spotId);
            if (!isFav && !isPro && favIds.length >= MAX_FAVS_FREE) {
                document.getElementById('favPaywall').classList.replace('hidden', 'flex');
                return;
            }
            const btn = e.currentTarget;
            const icon = btn.querySelector('.material-symbols-outlined');
            if (!isFav) {
                btn.style.background = 'rgba(239,68,68,.3)';
                if (icon) {
                    icon.style.color = '#f87171';
                    icon.style.fontVariationSettings = "'FILL' 1";
                    icon.style.transition = 'transform .12s ease';
                    icon.style.transform = 'scale(1.6)';
                    setTimeout(() => { icon.style.transform = 'scale(0.9)'; }, 140);
                    setTimeout(() => { icon.style.transform = 'scale(1.25)'; }, 250);
                    setTimeout(() => { icon.style.transform = 'scale(1)'; }, 360);
                }
            } else {
                btn.style.background = 'rgba(0,0,0,.45)';
                if (icon) {
                    icon.style.color = 'rgba(255,255,255,.6)';
                    icon.style.fontVariationSettings = "'FILL' 0";
                }
            }
            try {
                if (isFav) {
                    await API.favorites.remove(spotId);
                    favIds = favIds.filter(id => id !== spotId);
                } else {
                    await API.favorites.add(spotId);
                    favIds.push(spotId);
                }
                render();
            } catch { render(); }
        }

        function favBtn(spotId, small = false) {
            const isFav = favIds.includes(spotId);
            const sz = small ? 'text-[14px] w-6 h-6' : 'text-[18px] w-8 h-8';
            return `<button type="button" onclick="toggleFav(event,${spotId})" class="${sz} rounded-full flex items-center justify-center transition-all active:scale-90"
                style="background:${isFav ? 'rgba(239,68,68,.25)' : 'rgba(0,0,0,.45)'}">
                <span class="material-symbols-outlined ${small ? 'text-[14px]' : 'text-[18px]'} ${isFav ? 'text-red-400' : 'text-white/60'}"
                style="font-variation-settings:'FILL' ${isFav ? 1 : 0}">favorite</span>
            </button>`;
        }

        function render() {
            const filtered = getFiltered();
            const el = document.getElementById('list');
            document.getElementById('spotCount').textContent = filtered.length + ' spots';
            if (!filtered.length) {
                el.innerHTML = `<div class="flex flex-col items-center gap-3 py-16 text-slate-500">
                    <span class="material-symbols-outlined text-5xl">search_off</span>
                    <p class="text-sm text-center">Aucun spot trouv√©<br/><span class="text-xs">Essaie de changer les filtres</span></p>
                </div>`;
                return;
            }

            // Regrouper par r√©gion
            const groups = {};
            filtered.forEach(s => {
                const r = getRegion(s);
                if (!groups[r]) groups[r] = [];
                groups[r].push(s);
            });

            let html = '';

            // Card Hero (premier spot)
            const hero = filtered[0];
            const heroH = (1.2 + Math.abs(Math.sin(hero.id * 7)) * 2).toFixed(1);
            const herbCond = COND[hero.id % COND.length];
            html += `<a href="spot_detail.html?id=${hero.id}" class="card rounded-3xl overflow-hidden block active:scale-[.99] transition-transform relative">
              <div class="relative w-full" style="height:180px">
                <img loading="lazy" src="${getSpotImg(hero)}" class="w-full h-full object-cover"/>
                <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/30 to-transparent"></div>
                <div class="absolute top-3 right-3">${favBtn(hero.id)}</div>
                <div class="absolute bottom-3 left-4 right-14">
                  <span class="text-[9px] ${condColor(herbCond)} font-black uppercase tracking-wide">${herbCond}</span>
                  <h2 class="text-white font-black text-lg leading-tight mt-0.5">${hero.name}</h2>
                  <p class="text-white/60 text-xs">${hero.location}</p>
                </div>
              </div>
              <div class="px-4 py-3 flex items-center gap-3">
                <span class="text-xs font-bold px-2 py-1 rounded-full ${diffColor(hero.difficulty)}">${diffLabel(hero.difficulty)}</span>
                <span class="text-white/40 text-xs">¬∑</span>
                <span class="text-[#00bad6] text-xs font-bold">${heroH}m</span>
              </div>
            </a>`;

            // Rendu par r√©gion
            const restSpots = filtered.slice(1);
            REGION_ORDER.forEach(region => {
                const spotsInRegion = restSpots.filter(s => getRegion(s) === region);
                if (!spotsInRegion.length) return;
                html += `<div class="mt-4">
                    <div class="flex items-center gap-2 mb-2 px-1">
                        <span class="text-sm">${REGION_EMOJIS[region] || 'üèñÔ∏è'}</span>
                        <h3 class="font-black text-sm">${region}</h3>
                        <span class="text-[10px] text-slate-500 ml-1">${spotsInRegion.length} spots</span>
                    </div>
                    <div class="grid grid-cols-2 gap-2">`;
                spotsInRegion.forEach(s => {
                    const h = (1.2 + Math.abs(Math.sin(s.id * 7)) * 2).toFixed(1);
                    html += `
                    <a href="spot_detail.html?id=${s.id}" class="card rounded-2xl overflow-hidden active:scale-[.98] transition-transform">
                      <div class="relative w-full" style="height:100px">
                        <img src="${getSpotImg(s)}" class="w-full h-full object-cover" loading="lazy"/>
                        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                        <div class="absolute bottom-1.5 left-2 right-2">
                          <p class="text-white font-bold text-sm leading-tight truncate">${s.name}</p>
                          <p class="text-white/60 text-[9px] truncate">${s.location}</p>
                        </div>
                        <div class="absolute top-1.5 right-1.5">${favBtn(s.id, true)}</div>
                      </div>
                      <div class="p-2 flex items-center justify-between gap-1">
                        <span class="text-[9px] font-bold px-1.5 py-0.5 rounded-full ${diffColor(s.difficulty)} truncate max-w-[70%]">${diffLabel(s.difficulty)}</span>
                        <span class="text-[#00bad6] text-xs font-bold shrink-0">${h}m</span>
                      </div>
                    </a>`;
                });
                html += `</div></div>`;
            });

            // Mention limite favoris
            if (!isPro) {
                html += `<p class="text-center text-[10px] text-slate-600 mt-2">‚ù§Ô∏è ${favIds.length}/${MAX_FAVS_FREE} favoris utilis√©s${favIds.length >= MAX_FAVS_FREE ? ' ‚Äî <a href="community.html" class="text-amber-400 font-bold">Pro pour illimit√©s ‚Üí</a>' : ''}</p>`;
            }

            el.innerHTML = html;
        }


        function onSearch(v) { query = v.trim(); render(); }

        function setChip(val, el) {
            currentFilter = val;
            document.querySelectorAll('.chip').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            render();
        }

        init();
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(() => { });
        }
    </script>
    <script src="js/adsense.js"></script>
    <script src="js/share-social.js"></script>
    <script src="js/ui-components.js"></script>
    <script src="js/notif-badge.js"></script>
    <script src="/js/i18n.js"></script>
    <script src="/js/push_notifs.js" defer></script>
    <script src="/js/cookie-consent.js"></script>
    <script src="/js/monitoring.js"></script>
    <!-- Footer l√©gal requis RGPD -->
    <div style="text-align:center;padding:8px 16px 100px;font-size:10px;color:#334155">
        <a href="/legal.html" style="color:#334155;text-decoration:none;margin:0 6px">Mentions l√©gales</a>¬∑
        <a href="/privacy.html" style="color:#334155;text-decoration:none;margin:0 6px">Confidentialit√©</a>¬∑
        <a href="/cgv.html" style="color:#334155;text-decoration:none;margin:0 6px">CGU</a>¬∑
        <a href="/cookies.html" style="color:#334155;text-decoration:none;margin:0 6px">Cookies</a>
    </div>
    <script src="/pages/js/auth-state.js"></script>
    <script src="/js/offline-banner.js"></script>
  <script src="/js/error-handler.js" defer></script>

<script>
// Auto aria-current="page" sur nav
(function() {
  const path = window.location.pathname.split('/').pop();
  document.querySelectorAll('nav a, .bottom-nav a, .navbar a').forEach(link => {
    const href = link.getAttribute('href') || '';
    if (href === path || href.endsWith('/' + path)) {
      link.setAttribute('aria-current', 'page');
    }
  });
})();
</script>
</body>

</html>
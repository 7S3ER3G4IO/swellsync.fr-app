<!DOCTYPE html>
<html class="dark" lang="fr">

<head>
    <script src="js/app-guard.js"></script>
    <meta charset="utf-8" />
    <meta content="width=device-width,initial-scale=1.0" name="viewport" />
    <title>Mes alertes houle â€” SwellSync</title>
    <meta property="og:type" content="website">
    <meta property="og:title" content="SwellSync â€” Alertes Houle">
    <meta property="og:description" content="Alertes personnalisÃ©es de conditions de surf.">
    <meta property="og:image" content="https://swellsync.fr/assets/images/swellsync_logo.png?v=3">
    <meta property="og:site_name" content="SwellSync">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://bxudysseskfpmlpagoid.supabase.co">
    <link rel="apple-touch-icon" href="/assets/images/swellsync_logo.png?v=3">
    <meta name="description"
        content="SwellSync Alertes â€” Recevez des notifications quand vos spots prÃ©fÃ©rÃ©s atteignent vos critÃ¨res de houle.">
    <script src="js/theme.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script>tailwind.config = { darkMode: "class", theme: { extend: { colors: { "primary": "#00bad6", "background-dark": "#000", "card-dark": "#111" }, fontFamily: { "display": ["Space Grotesk", "sans-serif"] } } } }</script>
    <style>
        .glass {
            background: rgba(15, 36, 56, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1)
        }

        .glow-primary {
            box-shadow: 0 0 15px rgba(0, 186, 214, 0.4)
        }

        body {
            min-height: max(884px, 100dvh)
        }

        /* Modal */
        #modal {
            display: none
        }

        #modal.open {
            display: flex
        }

        /* â”€â”€ Light Mode â”€â”€ */
        html.light body {
            background: linear-gradient(160deg, #f0f9ff, #e0f2fe);
            color: #1e293b;
        }

        html.light .glass {
            background: rgba(255, 255, 255, .8);
            border-color: rgba(0, 186, 214, .15);
            box-shadow: 0 4px 24px rgba(0, 0, 0, .07);
        }

        html.light header.glass {
            background: rgba(240, 249, 255, .9) !important;
        }

        html.light nav.glass {
            background: rgba(255, 255, 255, .92) !important;
            border-top-color: rgba(0, 186, 214, .15) !important;
        }

        html.light .bg-\[\#000\] {
            background: transparent;
        }

        html.light .bg-\[\#111\] {
            background: #fff !important;
            border-color: #e2eaf4 !important;
        }

        html.light .text-slate-100 {
            color: #1e293b;
        }

        html.light .text-slate-400,
        html.light .text-slate-500 {
            color: #64748b;
        }
    </style>

    <style>
        :root {
            --bg-primary: #000;
            --bg-card: #111;
            --bg-nav: rgba(8, 15, 26, 0.95);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: rgba(0, 186, 214, 0.2);
        }

        .light {
            --bg-primary: #f0f4f8;
            --bg-card: #ffffff;
            --bg-nav: rgba(255, 255, 255, 0.95);
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --border-color: rgba(0, 186, 214, 0.15);
        }

        .light body {
            background: var(--bg-primary) !important;
            color: var(--text-primary) !important;
        }

        .light .card,
        .light [class*="bg-[#111]"] {
            background: var(--bg-card) !important;
        }

        .light [class*="bg-[#000]"] {
            background: var(--bg-primary) !important;
        }

        .light [class*="bg-[#111]"] {
            background: #f8fafc !important;
        }

        .light [class*="text-white"] {
            color: #0f172a !important;
        }

        .light [class*="text-slate-400"],
        .light [class*="text-slate-500"] {
            color: #64748b !important;
        }

        .light [class*="border-[#00bad6]"] {
            border-color: rgba(0, 186, 214, 0.25) !important;
        }

        .light nav[style*="--nav-bg"] {
            --nav-bg: rgba(255, 255, 255, 0.95) !important;
            border-color: rgba(0, 186, 214, 0.15) !important;
        }

        .light .section-label {
            color: #334155 !important;
        }

        .light .setting-row:hover {
            background: #e2e8f0 !important;
        }
    </style>

    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#00bad6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="/assets/images/swellsync_logo.png?v=3">
    <!-- Splash screens iOS -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3)" href="/assets/splash/splash-1290x2796.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3)" href="/assets/splash/splash-1179x2556.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)" href="/assets/splash/splash-1170x2532.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)" href="/assets/splash/splash-1125x2436.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" href="/assets/splash/splash-750x1334.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 360px) and (device-height: 780px) and (-webkit-device-pixel-ratio: 3)" href="/assets/splash/splash-1080x2340.png">
  <link rel="canonical" href="https://swellsync.fr/pages/alerts.html">
</head>

<body class="bg-[#000] font-display text-slate-100 flex flex-col">
  <a href="#main-content" class="skip-link" style="position:absolute;top:-40px;left:0;background:#0ea5e9;color:#fff;padding:8px 16px;z-index:9999;border-radius:0 0 8px 0;font-weight:600;text-decoration:none;transition:top .2s" onfocus="this.style.top='0'" onblur="this.style.top='-40px'">Aller au contenu principal</a>

    <header class="sticky top-0 z-20 glass px-4 py-4 flex items-center justify-between border-b border-[#00bad6]/10">
        <div class="flex items-center gap-3">
            <a href="home.html" class="material-symbols-outlined text-[#00bad6] cursor-pointer">arrow_back</a>
            <h1 class="text-xl font-bold tracking-tight">Mes Alertes</h1>
        </div>
        <div class="flex items-center gap-2">
            <span id="countBadge"
                class="px-2 py-0.5 bg-[#00bad6]/20 text-[#00bad6] text-xs font-bold rounded-full active:scale-95 transition-transform">0</span>
        </div>
    </header>



    <main class="flex-1 p-4 space-y-4 pb-36" id="alertsList">
        <div class="flex items-center justify-center py-20">
            <div class="w-6 h-6 rounded-full border-2 border-[#00bad6] border-t-transparent animate-spin"></div>
        </div>
    </main>

    <!-- FAB Ajouter -->
    <div class="fixed bottom-24 right-6 z-30" id="alertsFab">
        <button type="button" onclick="openModal()"
            class="bg-[#00bad6] glow-primary text-[#000] w-14 h-14 rounded-full flex items-center justify-center shadow-lg hover:scale-105 active:scale-95 transition-all font-bold">
            <span class="material-symbols-outlined">add</span>
        </button>
    </div>

    <!-- Modal Nouvelle Alerte -->
    <div id="modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-end justify-center">
        <div class="glass w-full max-w-md rounded-t-3xl p-6 space-y-5 border-t border-[#00bad6]/20">
            <div class="w-12 h-1.5 bg-slate-700 rounded-full mx-auto"></div>
            <h2 class="text-xl font-bold text-center">Nouvelle Alerte</h2>

            <div>
                <label class="text-xs text-slate-400 uppercase tracking-widest mb-2 block">Spot</label>
                <select id="newSpotSel"
                    class="w-full bg-[#111] border border-[#00bad6]/20 rounded-xl p-3 text-white text-sm focus:outline-none focus:border-[#00bad6]">
                    <option value="">Chargementâ€¦</option>
                </select>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-xs text-slate-400 uppercase tracking-widest mb-2 block">Hauteur min (m)</label>
                    <input id="newHeight" type="number" value="1.5" step="0.5" min="0.5" max="10"
                        class="w-full bg-[#111] border border-[#00bad6]/20 rounded-xl p-3 text-white text-sm focus:outline-none focus:border-[#00bad6]" />
                </div>
                <div>
                    <label class="text-xs text-slate-400 uppercase tracking-widest mb-2 block">PÃ©riode min (s)</label>
                    <input id="newPeriod" type="number" value="10" step="1" min="5" max="25"
                        class="w-full bg-[#111] border border-[#00bad6]/20 rounded-xl p-3 text-white text-sm focus:outline-none focus:border-[#00bad6]" />
                </div>
            </div>

            <div class="flex gap-3 pt-2">
                <button type="button" onclick="closeModal()"
                    class="flex-1 py-3 rounded-xl border border-slate-700 text-slate-400 font-semibold hover:bg-slate-800 transition-colors">Annuler</button>
                <button type="button" onclick="createAlert()"
                    class="flex-1 py-3 rounded-xl bg-[#00bad6] text-[#000] font-bold hover:opacity-90 transition-opacity active:scale-95 transition-transform">CrÃ©er</button>
            </div>
        </div>
    </div>

    <!-- Bottom Nav -->
    <nav class="fixed bottom-0 left-0 right-0 border-t border-[#00bad6]/20 pb-6 pt-2 px-2 flex justify-between items-center z-50 backdrop-blur-lg transition-colors duration-300"
        style="background: var(--nav-bg, rgba(8,15,26,0.95))">
        <a class="flex flex-col items-center gap-1 text-slate-500 flex-1" href="home.html"><span
                class="material-symbols-outlined">home</span><span class="text-[10px]">Home</span>

        </a>
        <a class="flex flex-col items-center gap-1 text-slate-500 flex-1" href="map.html"><span
                class="material-symbols-outlined">travel_explore</span><span class="text-[10px]">Spots</span></a>
        <a class="flex flex-col items-center gap-1 text-[#00bad6] flex-1" href="alerts.html">
            <span class="material-symbols-outlined" style="font-variation-settings:'FILL' 1">notifications</span>
            <span class="text-[10px] font-bold">Alertes</span>
            <div class="w-1 h-1 bg-[#00bad6] rounded-full mt-0.5"></div>
        </a>
        <a class="flex flex-col items-center gap-1 text-slate-500 flex-1" href="community.html"><span
                class="material-symbols-outlined">groups</span><span class="text-[10px]">CommunautÃ©</span></a>
        <a class="flex flex-col items-center gap-1 text-slate-500 flex-1" href="profile.html"><span
                class="material-symbols-outlined">person</span><span class="text-[10px]">Profil</span></a>
    </nav>


    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <script src="js/api.js"></script>
    <script>
        let alerts = [];
        const ICONS = { tsunami: 'tsunami', air: 'air', sunny: 'sunny', waves: 'waves' };

        async function loadAlerts() {
            try {
                await API.auth.me();
            } catch {
                // Non connectÃ©
                document.getElementById('alertsList').innerHTML = `
      <div class="flex flex-col items-center justify-center py-16 gap-3 text-slate-500">
        <span class="material-symbols-outlined text-5xl">notifications_off</span>
        <p class="text-sm text-center">Connecte-toi pour voir tes alertes</p>
        <a href="home.html" class="mt-2 px-6 py-3 bg-[#00bad6] text-[#000] font-bold rounded-xl text-sm active:scale-95 transition-transform">Se connecter</a>
      </div>`;
                return;
            }
            try {
                alerts = await API.alerts.list();
                renderAlerts();
            } catch {
                document.getElementById('alertsList').innerHTML = `<p class="text-slate-500 text-sm text-center py-10">Erreur de chargement</p>`;
            }
        }

        function renderAlerts() {
            const el = document.getElementById('alertsList');
            document.getElementById('countBadge').textContent = alerts.length;
            if (!alerts.length) {
                el.innerHTML = `
      <div class="flex flex-col items-center justify-center py-16 gap-3 text-slate-500">
        <span class="material-symbols-outlined text-5xl">notifications_active</span>
        <p class="text-sm">Aucune alerte â€” crÃ©e-en une avec le bouton +</p>
      </div>`;
                return;
            }
            el.innerHTML = alerts.map((a, i) => `
    <div class="glass p-5 rounded-xl flex items-center justify-between group transition-all duration-300 ${a.active ? '' : 'opacity-50 grayscale'}">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 rounded-lg bg-[#00bad6]/10 flex items-center justify-center text-[#00bad6] active:scale-95 transition-transform">
          <span class="material-symbols-outlined text-2xl">waves</span>
        </div>
        <div>
          <h3 class="text-lg font-semibold">${a.spot_name}</h3>
          <p class="text-sm text-[#00bad6] font-medium">&gt; ${a.min_height}m Â· ${a.min_period}s</p>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <label class="relative inline-flex items-center cursor-pointer">
          <input type="checkbox" class="sr-only peer" ${a.active ? 'checked' : ''} onchange="toggleAlert(${a.id}, this.checked)"/>
          <div class="w-11 h-6 bg-slate-700 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#00bad6] active:scale-95 transition-transform"></div>
        </label>
        <button type="button" onclick="deleteAlert(${a.id})" class="text-red-400/60 hover:text-red-400 transition-colors">
          <span class="material-symbols-outlined text-sm">delete</span>
        </button>
      </div>
    </div>`).join('');
        }

        async function toggleAlert(id, active) {
            try {
                await API.alerts.toggle(id, active ? 1 : 0);
                const a = alerts.find(x => x.id === id);
                if (a) a.active = active ? 1 : 0;
                toast(active ? 'ðŸ”” Alerte activÃ©e' : 'Alerte dÃ©sactivÃ©e');
                renderAlerts();
            } catch { toast('Erreur', 'err'); }
        }

        async function deleteAlert(id) {
            showConfirmModal('Supprimer cette alerte ?', 'Cette action est irrÃ©versible. L\'alerte sera dÃ©finitivement supprimÃ©e.', async () => {
                try {
                    await API.alerts.delete(id);
                    alerts = alerts.filter(a => a.id !== id);
                    renderAlerts();
                    toast('Alerte supprimÃ©e');
                } catch { toast('Erreur', 'err'); }
            }, { danger: true, confirmText: 'Supprimer' });
        }

        // Modal
        async function openModal() {
            document.getElementById('modal').classList.add('open');
            // Charger les spots dans le select
            try {
                const spots = await API.spots.list();
                const sel = document.getElementById('newSpotSel');
                sel.innerHTML = spots.map(s => `<option value="${s.id}" data-name="${s.name}">${s.name} â€” ${s.location}</option>`).join('');
            } catch { }
        }
        function closeModal() { document.getElementById('modal').classList.remove('open'); }

        async function createAlert() {
            const sel = document.getElementById('newSpotSel');
            const spotId = sel.value;
            const spotName = sel.options[sel.selectedIndex]?.dataset.name || sel.options[sel.selectedIndex]?.text;
            const minH = parseFloat(document.getElementById('newHeight').value) || 1.5;
            const minP = parseInt(document.getElementById('newPeriod').value) || 10;
            if (!spotId) { toast('Choisis un spot', 'err'); return; }
            try {
                const r = await API.alerts.add({ spot_id: spotId, spot_name: spotName, min_height: minH, min_period: minP });
                alerts.unshift({ id: r.id, spot_id: spotId, spot_name: spotName, min_height: minH, min_period: minP, active: 1 });
                renderAlerts();
                closeModal();
                toast('ðŸ”” Alerte crÃ©Ã©e !');
            } catch { toast('Connecte-toi pour crÃ©er une alerte', 'err'); }
        }

        // Fermer modal en cliquant Ã  l'extÃ©rieur
        document.getElementById('modal').addEventListener('click', e => {
            if (e.target === document.getElementById('modal')) closeModal();
        });

        loadAlerts();
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(() => { });
        }
    </script>
    <script src="js/adsense.js"></script>
    <script src="js/share-social.js"></script>
    <script src="js/ui-components.js"></script>
    <script src="js/notif-badge.js"></script>
    <script src="/js/i18n.js"></script>
    <script src="/js/push_notifs.js" defer></script>
    <script src="/js/cookie-consent.js"></script>
    <script src="/js/monitoring.js"></script>
    <!-- Footer lÃ©gal requis RGPD -->
    <div style="text-align:center;padding:8px 16px 100px;font-size:10px;color:#334155">
        <a href="/legal.html" style="color:#334155;text-decoration:none;margin:0 6px">Mentions lÃ©gales</a>Â·
        <a href="/privacy.html" style="color:#334155;text-decoration:none;margin:0 6px">ConfidentialitÃ©</a>Â·
        <a href="/cgv.html" style="color:#334155;text-decoration:none;margin:0 6px">CGU</a>Â·
        <a href="/cookies.html" style="color:#334155;text-decoration:none;margin:0 6px">Cookies</a>
    </div>
    <script src="/pages/js/auth-state.js"></script>
    <script src="/js/offline-banner.js"></script>
  <script src="/js/error-handler.js" defer></script>

<script>
// Auto aria-current="page" sur nav
(function() {
  const path = window.location.pathname.split('/').pop();
  document.querySelectorAll('nav a, .bottom-nav a, .navbar a').forEach(link => {
    const href = link.getAttribute('href') || '';
    if (href === path || href.endsWith('/' + path)) {
      link.setAttribute('aria-current', 'page');
    }
  });
})();
</script>
</body>

</html>
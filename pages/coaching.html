<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Coaching Surf â€” SwellSync</title>
  <meta name="description" content="Conseils personnalisÃ©s par niveau, programmes d'entraÃ®nement et analyse de tes sessions surf.">
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#0ea5e9">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/js/supabase-client.js" defer></script>
  <script src="/js/coaching.js" defer></script>
  <script src="/js/stats.js" defer></script>
  <script src="/js/toast.js" defer></script>
</head>
<body>
  <a href="#main-content" class="skip-link">Aller au contenu</a>

  <!-- Header -->
  <header style="padding:16px 20px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(255,255,255,.06);position:sticky;top:0;background:rgba(8,15,26,.95);backdrop-filter:blur(16px);z-index:100">
    <button type="button" onclick="history.back()" aria-label="Retour" style="background:none;border:none;color:#94a3b8;font-size:20px;cursor:pointer;padding:4px">â†</button>
    <h1 style="font-size:17px;font-weight:700;color:#f1f5f9;margin:0">ğŸ“ Coaching Surf</h1>
    <div style="width:32px"></div>
  </header>

  <main id="main-content">

    <!-- Niveau actuel -->
    <section style="padding:24px 20px 0">
      <div id="level-banner" style="background:linear-gradient(135deg,rgba(14,165,233,.15),rgba(139,92,246,.1));border:1px solid rgba(14,165,233,.2);border-radius:20px;padding:20px;text-align:center">
        <div id="level-icon" style="font-size:48px;margin-bottom:8px">ğŸ¤™</div>
        <div id="level-title" style="font-size:22px;font-weight:800;color:#f1f5f9;margin-bottom:4px">Rookie</div>
        <div id="level-sub" style="font-size:13px;color:#64748b;margin-bottom:16px">0 sessions enregistrÃ©es</div>
        <!-- Progress bar vers le niveau suivant -->
        <div style="background:rgba(255,255,255,.08);border-radius:4px;height:6px;overflow:hidden">
          <div id="level-progress" style="height:100%;background:linear-gradient(90deg,#0ea5e9,#38bdf8);border-radius:4px;width:0%;transition:width 1s ease"></div>
        </div>
        <div id="level-next" style="font-size:11px;color:#64748b;margin-top:6px">Prochain niveau : DÃ©butant (5 sessions)</div>
      </div>
    </section>

    <!-- Tabs coaching -->
    <div style="display:flex;gap:0;padding:20px 20px 0;border-bottom:1px solid rgba(255,255,255,.06)">
      <button type="button" class="coaching-tab active-tab" data-tab="tips" style="flex:1;padding:10px;background:none;border:none;color:#0ea5e9;font-weight:600;font-size:14px;cursor:pointer;border-bottom:2px solid #0ea5e9">ğŸ’¡ Conseils</button>
      <button type="button" class="coaching-tab" data-tab="program" style="flex:1;padding:10px;background:none;border:none;color:#64748b;font-size:14px;cursor:pointer;border-bottom:2px solid transparent">ğŸ“‹ Programme</button>
      <button type="button" class="coaching-tab" data-tab="analysis" style="flex:1;padding:10px;background:none;border:none;color:#64748b;font-size:14px;cursor:pointer;border-bottom:2px solid transparent">ğŸ“Š Analyse</button>
    </div>

    <!-- Panel Conseils -->
    <section id="tab-tips" class="tab-panel" style="padding:20px">
      <div id="tips-container">
        <div class="skeleton" style="height:120px;border-radius:16px;margin-bottom:12px"></div>
        <div class="skeleton" style="height:120px;border-radius:16px;margin-bottom:12px"></div>
        <div class="skeleton" style="height:120px;border-radius:16px"></div>
      </div>
    </section>

    <!-- Panel Programme -->
    <section id="tab-program" class="tab-panel" style="padding:20px;display:none">
      <h2 style="font-size:18px;font-weight:700;color:#f1f5f9;margin:0 0 16px">ğŸ“‹ Programmes d'entraÃ®nement</h2>
      <div id="programs-container"></div>
    </section>

    <!-- Panel Analyse -->
    <section id="tab-analysis" class="tab-panel" style="padding:20px;display:none">
      <h2 style="font-size:18px;font-weight:700;color:#f1f5f9;margin:0 0 16px">ğŸ“Š Analyse de tes sessions</h2>
      <div id="analysis-container">
        <div style="background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:20px;text-align:center;color:#64748b">
          <div style="font-size:40px;margin-bottom:12px">ğŸ”</div>
          <p>Charge tes sessions pour voir l'analyse.</p>
        </div>
      </div>
    </section>
  </main>

  <!-- Bottom Nav -->
  <nav aria-label="Navigation principale" style="position:fixed;bottom:0;left:0;right:0;background:rgba(8,15,26,.97);backdrop-filter:blur(16px);border-top:1px solid rgba(255,255,255,.08);display:flex;padding:8px 0 max(8px,env(safe-area-inset-bottom));z-index:200">
    <a href="/pages/home.html" style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;color:#64748b;text-decoration:none;font-size:10px;padding:4px">ğŸŒŠ<span>Accueil</span></a>
    <a href="/pages/forecast.html" style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;color:#64748b;text-decoration:none;font-size:10px;padding:4px">ğŸ“¡<span>PrÃ©visions</span></a>
    <a href="/pages/community.html" style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;color:#64748b;text-decoration:none;font-size:10px;padding:4px">ğŸ‘¥<span>CommunautÃ©</span></a>
    <a href="/pages/coaching.html" style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;color:#0ea5e9;text-decoration:none;font-size:10px;padding:4px">ğŸ“<span>Coaching</span></a>
    <a href="/pages/profile.html" style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;color:#64748b;text-decoration:none;font-size:10px;padding:4px">ğŸ‘¤<span>Profil</span></a>
  </nav>
  <div style="height:80px"></div>

  <script>
  // --- Tabs ---
  document.querySelectorAll('.coaching-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.coaching-tab').forEach(t => {
        t.style.color = '#64748b'; t.style.borderBottomColor = 'transparent'; t.style.fontWeight = '400';
      });
      document.querySelectorAll('.tab-panel').forEach(p => p.style.display = 'none');
      tab.style.color = '#0ea5e9'; tab.style.borderBottomColor = '#0ea5e9'; tab.style.fontWeight = '600';
      document.getElementById('tab-' + tab.dataset.tab).style.display = 'block';
    });
  });

  // --- Charger niveau et conseils ---
  async function init() {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return;
      const { data: member } = await supabase.from('members').select('id').eq('auth_id', user.id).single();
      if (!member) return;

      const { data: sessions } = await supabase.from('surf_sessions').select('id,score,duration,wave_count,created_at').eq('member_id', member.id);
      const totalSessions = sessions?.length || 0;

      // Mise Ã  jour du banner niveau
      const titleData = typeof getSurfTitle !== 'undefined' ? getSurfTitle(totalSessions) : { title: 'Rookie', icon: 'ğŸ¤™', progress: 0, nextAt: 5, nextTitle: 'DÃ©butant' };
      document.getElementById('level-icon').textContent = titleData.icon;
      document.getElementById('level-title').textContent = titleData.title;
      document.getElementById('level-sub').textContent = `${totalSessions} session${totalSessions > 1 ? 's' : ''} enregistrÃ©e${totalSessions > 1 ? 's' : ''}`;
      document.getElementById('level-progress').style.width = Math.min(titleData.progress, 100) + '%';
      if (titleData.nextTitle) {
        document.getElementById('level-next').textContent = `Prochain niveau : ${titleData.nextTitle} (${titleData.nextAt} sessions)`;
      } else {
        document.getElementById('level-next').textContent = 'Niveau maximum atteint ! ğŸŒŸ';
      }

      // DÃ©terminer le niveau pour les conseils
      const level = totalSessions < 5 ? 'rookie' : totalSessions < 20 ? 'debutant' : 'intermediaire';
      const tips = typeof getCoachingTips !== 'undefined' ? getCoachingTips(level) : [];

      // Afficher les conseils
      const container = document.getElementById('tips-container');
      if (container && tips.length) {
        container.innerHTML = tips.map(tip => `
          <div style="background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:20px;margin-bottom:12px">
            <div style="font-size:32px;margin-bottom:10px">${tip.icon}</div>
            <h3 style="font-size:16px;font-weight:700;color:#f1f5f9;margin:0 0 8px">${tip.title}</h3>
            <p style="color:#94a3b8;font-size:14px;line-height:1.7;margin:0">${tip.text}</p>
          </div>`).join('');
      }

      // Afficher les programmes
      const progContainer = document.getElementById('programs-container');
      if (progContainer && typeof TRAINING_PROGRAMS !== 'undefined') {
        progContainer.innerHTML = TRAINING_PROGRAMS.map(p => `
          <div style="background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:20px;margin-bottom:16px">
            <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
              <span style="font-size:32px">${p.icon}</span>
              <div>
                <div style="font-weight:700;color:#f1f5f9;font-size:16px">${p.title}</div>
                <div style="color:#64748b;font-size:12px">${p.days.length} Ã©tapes Â· Niveau ${p.level}</div>
              </div>
            </div>
            ${p.days.map(d => `
              <div style="display:flex;gap:12px;padding:10px 0;border-top:1px solid rgba(255,255,255,.05)">
                <div style="background:rgba(14,165,233,.15);color:#0ea5e9;border-radius:8px;padding:4px 10px;font-size:12px;font-weight:700;flex-shrink:0">J${d.day}</div>
                <div style="color:#94a3b8;font-size:14px;line-height:1.5">${d.task}</div>
              </div>`).join('')}
          </div>`).join('');
      }

      // Analyse de la derniÃ¨re session
      if (sessions?.length > 0) {
        const last = sessions[0];
        const analysisContainer = document.getElementById('analysis-container');
        const analysis = typeof analyzeSession !== 'undefined' ? analyzeSession(last) : [];
        if (analysisContainer && analysis.length) {
          analysisContainer.innerHTML = `
            <div style="background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:20px">
              <div style="font-size:13px;color:#64748b;margin-bottom:16px">Analyse de ta derniÃ¨re session (${new Date(last.created_at).toLocaleDateString('fr-FR')})</div>
              ${analysis.map(a => `<div style="display:flex;align-items:flex-start;gap:10px;padding:10px 0;border-top:1px solid rgba(255,255,255,.05);color:#cbd5e1;font-size:14px;line-height:1.6">${a}</div>`).join('')}
            </div>`;
        }
      }
    } catch(e) {}
  }

  document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
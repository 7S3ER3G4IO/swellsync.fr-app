<!DOCTYPE html>
<html class="dark" lang="fr">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <!-- SEO primaire ‚Äì mis √† jour dynamiquement par JS -->
    <title>SwellSync | Conditions du Spot</title>
    <meta name="description"
        content="Consultez les conditions de surf en temps r√©el : houle, vent, p√©riode, mar√©e, pr√©visions 7 jours, √©quipement recommand√© et affluence sur ce spot." />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://swellsync.fr/spot_detail.html" id="canonical-link" />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="SwellSync" />
    <meta property="og:title" content="SwellSync | Conditions du Spot" id="og-title" />
    <meta property="og:description"
        content="Conditions de surf en temps r√©el, pr√©visions 7 jours, √©quipement recommand√© et affluence."
        id="og-desc" />
    <meta property="og:image" content="https://swellsync.fr/assets/images/og-cover.jpg" />
    <meta property="og:url" content="https://swellsync.fr/spot_detail.html" id="og-url" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="SwellSync | Conditions du Spot" id="tw-title" />
    <meta name="twitter:description" content="Houle, vent, pr√©visions 7j, √©quipement et affluence ‚Äî en temps r√©el." />
    <meta name="twitter:image" content="https://swellsync.fr/assets/images/og-cover.jpg" />

    <!-- Favicons -->
    <link rel="icon" href="/assets/images/swellsync_icon.svg" type="image/svg+xml" />
    <link rel="icon" href="/favicon.ico" sizes="any" />
    <link rel="apple-touch-icon" href="/assets/images/swellsync_icon.svg" />

    <!-- Preconnect performances -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://unpkg.com" />

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#00bad6",
                        "background-light": "#f5f8f8",
                        "background-dark": "#0f2123",
                    },
                    fontFamily: { "display": ["Lexend", "sans-serif"] },
                }
            }
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        crossorigin="anonymous" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f2123">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/light-mode.css">
    <link rel="stylesheet" href="css/mobile.css">

    <style>
        body {
            font-family: 'Lexend', sans-serif;
            margin: 0;
            overflow-x: hidden;
            background-color: #0f2123;
        }

        .glass {
            background: rgba(15, 33, 35, 0.45);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .glow {
            box-shadow: 0 0 30px rgba(0, 186, 214, 0.25);
        }

        .glow-gold {
            box-shadow: 0 0 30px rgba(250, 204, 21, 0.2);
        }

        .hero-overlay {
            background: linear-gradient(to right, rgba(15, 33, 35, 0.92) 0%, rgba(15, 33, 35, 0.55) 60%, rgba(15, 33, 35, 0.2) 100%), linear-gradient(to top, rgba(15, 33, 35, 0.95) 0%, transparent 50%);
        }

        .stat-card {
            transition: transform 0.25s ease, box-shadow 0.25s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 0 30px rgba(0, 186, 214, 0.3);
        }

        .premium-blur {
            position: relative;
        }

        .premium-blur::after {
            content: '';
            position: absolute;
            inset: 0;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            background: rgba(15, 33, 35, 0.6);
            border-radius: inherit;
            z-index: 10;
        }

        .premium-badge {
            position: relative;
            z-index: 20;
        }

        .day-tab {
            cursor: pointer;
            transition: all 0.2s;
        }

        .day-tab.active {
            background: rgba(0, 186, 214, 0.15);
            border-color: rgba(0, 186, 214, 0.4);
            color: #00bad6;
        }

        .leaflet-popup-content-wrapper,
        .leaflet-popup-tip {
            background: rgba(15, 33, 35, 0.97) !important;
            color: #fff !important;
            border: 1px solid rgba(0, 186, 214, 0.3);
            border-radius: 1rem;
        }

        /* Forecast grid */
        .forecast-table td {
            vertical-align: middle;
        }

        .forecast-table tr:hover td {
            background: rgba(0, 186, 214, 0.04);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(12px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes pulse-ring {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(0, 186, 214, 0.5);
            }

            50% {
                box-shadow: 0 0 0 10px rgba(0, 186, 214, 0);
            }
        }

        .live-dot {
            animation: pulse-ring 2s infinite;
        }

        /* Custom scrollbar for forecast */
        .forecast-scroll::-webkit-scrollbar {
            height: 4px;
        }

        .forecast-scroll::-webkit-scrollbar-track {
            background: transparent;
        }

        .forecast-scroll::-webkit-scrollbar-thumb {
            background: rgba(0, 186, 214, 0.3);
            border-radius: 2px;
        }
    </style>
</head>

<body class="bg-background-dark text-slate-100 min-h-screen">
    <!-- NAVBAR -->
    <header class="fixed top-0 left-0 right-0 z-50 transition-all duration-300" id="main-nav">
            <nav class="max-w-7xl mx-auto flex items-center justify-between px-6 lg:px-8 py-3 my-3 mx-4 lg:mx-auto rounded-full" style="background: rgba(7,15,16,0.4); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.06);">
                <!-- Left: Logo -->
                <a href="index.html" class="flex items-center gap-2.5 hover:opacity-80 transition-opacity shrink-0">
                    <div class="w-9 h-9 rounded-lg bg-primary/15 flex items-center justify-center border border-primary/25">
                        <img src="assets/images/swellsync_icon.svg" alt="SwellSync" class="w-5 h-5 object-contain" style="filter: brightness(0) saturate(100%) invert(56%) sepia(87%) saturate(2222%) hue-rotate(152deg) brightness(101%) contrast(106%);">
                    </div>
                    <span class="text-lg font-black text-white hidden sm:block tracking-tight">SwellSync</span>
                </a>

                <!-- Center: Nav Links -->
                <div class="hidden md:flex items-center gap-1" id="nav-center-links">
                    <a class="nav-link px-4 py-2 rounded-lg text-[13px] font-semibold text-slate-300 hover:text-white hover:bg-white/5 transition-all" href="cotes.html">C√¥tes</a>
                    <a class="nav-link px-4 py-2 rounded-lg text-[13px] font-semibold text-slate-300 hover:text-white hover:bg-white/5 transition-all" href="spot_detail.html">Conditions</a>
                    <a class="nav-link px-4 py-2 rounded-lg text-[13px] font-semibold text-slate-300 hover:text-white hover:bg-white/5 transition-all" href="actu.html">Actualit√©s</a>
                    <div class="relative" id="nav-plus-wrapper">
                        <button class="px-4 py-2 rounded-lg text-[13px] font-semibold text-primary hover:bg-primary/10 transition-all flex items-center gap-1" id="nav-plus-btn">
                            Plus
                            <svg class="w-3.5 h-3.5 transition-transform duration-200" id="nav-plus-chevron" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg>
                        </button>
                    </div>
                </div>

                <!-- Right: Auth -->
                <div class="flex items-center gap-3 shrink-0">
                    <button
                        class="hidden md:flex items-center gap-2 px-4 py-2 rounded-lg text-[13px] font-semibold text-slate-300 hover:text-white hover:bg-white/5 transition-all"
                        id="btn-login" onclick="typeof openAuthOrProfileModal!=='undefined'&&openAuthOrProfileModal()">
                        <span class="material-symbols-outlined text-[18px]" id="btn-login-avatar">person</span>
                        <span id="nav-login-text">Connexion</span>
                        <div class="w-2 h-2 rounded-full bg-red-500 shrink-0" id="login-status-icon"></div>
                    </button>
                    <button
                        class="hidden md:flex bg-primary text-[#0a1516] font-bold text-[13px] px-5 py-2.5 rounded-full hover:brightness-110 hover:scale-[1.03] active:scale-[0.97] transition-all"
                        onclick="typeof openAuthOrProfileModal!=='undefined'&&openAuthOrProfileModal()">
                        S'inscrire
                    </button>
                    <button
                        class="w-10 h-10 flex items-center justify-center rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition-all text-white md:hidden"
                        id="mobile-menu-btn">
                        <span class="material-symbols-outlined text-[20px]">menu</span>
                    </button>
                </div>
            </nav>
        </header>



    <!-- HERO -->
    <!-- LOADING OVERLAY -->
    <div id="loading-overlay" class="fixed inset-0 z-[9999] flex flex-col items-center justify-center"
        style="background:linear-gradient(135deg,#0f2123 0%,#0a1a1c 100%)">
        <div class="flex flex-col items-center gap-5">
            <img src="assets/images/swellsync_icon.svg" alt="SwellSync"
                class="w-16 h-16 animate-pulse drop-shadow-[0_0_20px_rgba(0,186,214,0.6)]" />
            <div class="flex items-center gap-2">
                <div class="w-2 h-2 rounded-full bg-primary animate-bounce" style="animation-delay:0ms"></div>
                <div class="w-2 h-2 rounded-full bg-primary animate-bounce" style="animation-delay:150ms"></div>
                <div class="w-2 h-2 rounded-full bg-primary animate-bounce" style="animation-delay:300ms"></div>
            </div>
            <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Chargement des conditions...</p>
        </div>
    </div>

    <section class="relative min-h-[65vh] flex flex-col justify-end overflow-hidden" id="hero-spot">
        <div class="absolute inset-0 z-0">
            <img id="hero-bg" src="assets/images/hero-home-new.jpg" alt="Spot"
                class="w-full h-full object-cover scale-105 transition-transform duration-[8s] hover:scale-100" /
                loading="lazy" decoding="async">
            <div class="absolute inset-0 hero-overlay z-10"></div>
        </div>
        <!-- Badge EN DIRECT (ancre haute droite) -->
        <div class="absolute right-6 z-30" style="top: 88px">
            <div
                class="flex items-center gap-2 glass px-4 py-2 rounded-full text-xs font-bold text-white live-dot border border-primary/20">
                <span class="w-2 h-2 rounded-full bg-green-400 animate-pulse"></span>
                EN DIRECT
            </div>
        </div>
        <div class="relative z-20 max-w-7xl mx-auto px-6 pb-16 pt-32 w-full fade-in">
            <div
                class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-primary/30 bg-primary/5 text-[10px] font-bold tracking-widest text-primary mb-4 uppercase">
                <span class="material-symbols-outlined text-[12px]">waves</span>
                <span id="hero-wave-type-text">Beach Break</span>
            </div>
            <h1 id="hero-spot-name"
                class="text-5xl md:text-7xl font-black text-white mb-3 leading-none tracking-tighter drop-shadow-[0_2px_20px_rgba(0,0,0,0.8)]" data-i18n="common.loading">Chargement...</h1>
            <div class="flex flex-wrap items-center gap-4 mb-6">
                <span class="flex items-center gap-1.5 text-slate-300 text-sm font-medium">
                    <span class="material-symbols-outlined text-[16px] text-primary">location_on</span>
                    <span id="hero-location">‚Äî</span>
                </span>
                <span class="flex items-center gap-1.5 text-slate-300 text-sm font-medium">
                    <span class="material-symbols-outlined text-[16px] text-yellow-400">grade</span>
                    <span id="hero-difficulty">‚Äî</span>
                </span>
            </div>
            <p id="hero-description" class="text-slate-400 max-w-xl text-base leading-relaxed font-light"></p>

            <!-- BOUTON FAVORI HERO -->
            <div class="flex flex-wrap items-center gap-3 mt-4">
                <button id="btn-favorite-hero" onclick="handleSpotDetailFavorite()"
                    class="btn-favorite-spot flex items-center gap-2.5 px-5 py-2.5 rounded-full glass border border-white/15 hover:border-red-400/50 hover:bg-red-500/10 transition-all group"
                    title="Ajouter aux favoris" data-spotid="">
                    <i class="fa-regular fa-heart text-white/50 group-hover:text-red-400 transition-colors text-lg"
                        id="fav-hero-icon"></i>
                    <span
                        class="text-sm font-black text-white/60 group-hover:text-white transition-colors uppercase tracking-widest"
                        id="fav-hero-label">Favori</span>
                    <span
                        class="hidden text-[9px] font-black text-yellow-400 border border-yellow-400/30 bg-yellow-400/10 px-1.5 py-0.5 rounded-full uppercase tracking-wider"
                        id="fav-limit-badge">3/3 ¬∑ PRO</span>
                </button>

                <!-- üé• Bouton GoSurf Webcam Live -->
                <a id="btn-gosurf-cam" href="https://gosurf.fr/list" target="_blank" rel="noopener"
                    class="flex items-center gap-2.5 px-5 py-2.5 rounded-full border transition-all group"
                    style="background:linear-gradient(135deg,rgba(0,186,214,0.15),rgba(0,100,200,0.1));border-color:rgba(0,186,214,0.45);animation:pulse-cam 2.5s ease-in-out infinite;"
                    title="Voir la webcam live de ce spot sur GoSurf.fr">
                    <span style="font-size:17px">üé•</span>
                    <span class="text-sm font-black uppercase tracking-widest" style="color:#00bad6">Voir la Cam
                        Live</span>
                    <span class="material-symbols-outlined"
                        style="font-size:14px;color:#00bad6;margin-left:2px">open_in_new</span>
                </a>

                <div class="text-[10px] text-slate-500 font-bold" id="fav-count-label"></div>
            </div>

        </div>
    </section>

    <!-- CONDITIONS LIVE -->
    <section class="max-w-7xl mx-auto px-6 -mt-8 relative z-30 mb-12">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div
                class="glass stat-card glow p-6 rounded-[2rem] border border-primary/20 flex flex-col items-center text-center">
                <span class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-3">Houle</span>
                <span id="stat-swell" class="text-5xl font-black text-white leading-none mb-1">‚Äî</span>
                <span class="text-slate-500 text-xs font-bold">m√®tres</span>
                <span id="stat-swell-dir"
                    class="mt-3 text-[10px] font-black text-primary uppercase tracking-widest bg-primary/10 border border-primary/20 px-3 py-1 rounded-full">WSW</span>
            </div>
            <div
                class="glass stat-card p-6 rounded-[2rem] border border-white/10 flex flex-col items-center text-center">
                <span class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-3">Vent</span>
                <span id="stat-wind" class="text-5xl font-black text-white leading-none mb-1">‚Äî</span>
                <span class="text-slate-500 text-xs font-bold">noeuds</span>
                <span id="stat-wind-label"
                    class="mt-3 text-[10px] font-black text-green-400 uppercase tracking-widest bg-green-500/10 border border-green-500/20 px-3 py-1 rounded-full">Offshore</span>
            </div>
            <div
                class="glass stat-card p-6 rounded-[2rem] border border-white/10 flex flex-col items-center text-center">
                <span class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-3">P√©riode</span>
                <span id="stat-period" class="text-5xl font-black text-white leading-none mb-1">‚Äî</span>
                <span class="text-slate-500 text-xs font-bold">secondes</span>
                <span
                    class="mt-3 text-[10px] font-black text-slate-400 uppercase tracking-widest bg-white/5 border border-white/10 px-3 py-1 rounded-full">Houle
                    de fond</span>
            </div>
            <div
                class="glass stat-card p-6 rounded-[2rem] border border-white/10 flex flex-col items-center text-center">
                <span class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-3">Mar√©e</span>
                <span id="stat-tide" class="text-3xl font-black text-white leading-none mb-1">‚Äî</span>
                <span class="text-slate-500 text-xs font-bold">tendance</span>
                <div class="mt-3 flex gap-2 text-[10px] font-black text-slate-400">
                    <span>&#8593; <span id="stat-tide-high">14:24</span></span>
                    <span class="text-white/10">|</span>
                    <span>&#8595; <span id="stat-tide-low">20:45</span></span>
                </div>
            </div>
        </div>
    </section>

    <!-- SESSION RAPIDE CONTEXTUELLE -->
    <section class="max-w-7xl mx-auto px-6 mb-10" id="quick-session-widget">
        <div
            style="background:rgba(0,186,214,0.04);border:1px solid rgba(0,186,214,0.12);border-radius:24px;padding:20px 24px;display:flex;align-items:center;gap:16px;flex-wrap:wrap;">
            <div class="text-3xl">üìì</div>
            <div class="flex-1 min-w-0">
                <div style="font-size:13px;font-weight:900;color:#fff;margin-bottom:2px;">Vous surfez ici aujourd'hui ?
                </div>
                <div style="font-size:11px;color:#64748b;">Enregistrez cette session dans votre journal ‚Äî score calcul√©
                    automatiquement.</div>
            </div>
            <div class="flex items-center gap-3 flex-wrap">
                <div style="display:flex;align-items:center;gap:8px;">
                    <label
                        style="font-size:10px;font-weight:800;color:#64748b;text-transform:uppercase;letter-spacing:0.06em;">Dur√©e
                        (min)</label>
                    <input type="number" id="qs-duration" value="90" min="15" max="480"
                        style="width:72px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:10px;padding:7px 10px;color:#fff;font-family:Lexend,sans-serif;font-weight:900;font-size:13px;text-align:center;outline:none;">
                </div>
                <button onclick="quickLogSession()"
                    style="padding:10px 20px;border-radius:12px;background:linear-gradient(135deg,#00bad6,#0090a8);color:#fff;font-family:Lexend,sans-serif;font-weight:900;font-size:12px;border:none;cursor:pointer;box-shadow:0 4px 14px rgba(0,186,214,0.3);white-space:nowrap;">
                    ‚úÖ Enregistrer la session
                </button>
                <a href="journal.html"
                    style="padding:10px 16px;border-radius:12px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);color:#64748b;font-family:Lexend,sans-serif;font-weight:700;font-size:11px;text-decoration:none;white-space:nowrap;">
                    Voir mon journal ‚Üí
                </a>
            </div>
        </div>
    </section>
    <script>
        function quickLogSession() {
            const urlParams = new URLSearchParams(window.location.search);
            const spotName = urlParams.get('name') || document.getElementById('hero-spot-name')?.textContent?.trim() || 'Spot SwellSync';
            const duration = parseInt(document.getElementById('qs-duration')?.value) || 90;
            // R√©cup√©rer les conditions actuelles du spot
            const swellEl = document.getElementById('stat-swell');
            const windLabel = document.getElementById('stat-wind-label');
            const waveheight = swellEl ? parseFloat(swellEl.textContent) || 0 : 0;
            const windMap = { 'Offshore': 'offshore', 'L√©ger': 'light', 'offshore': 'offshore', 'light': 'light' };
            const wind = windMap[windLabel?.textContent?.trim()] || '';
            // Calculer le score
            let score = 5.0;
            if (waveheight >= 0.8 && waveheight <= 2.5) score += 2 + Math.min(1, (waveheight - 0.8));
            else if (waveheight > 2.5) score += 1.5;
            else if (waveheight > 0) score += 0.5;
            if (wind === 'offshore') score += 2;
            else if (wind === 'light') score += 1;
            if (duration >= 120) score += 0.5;
            else if (duration >= 90) score += 0.3;
            score = Math.min(10, Math.max(1, Math.round(score * 10) / 10));
            const session = {
                id: Date.now(),
                spot: spotName,
                date: new Date().toISOString().split('T')[0],
                duration,
                waveheight,
                wind,
                crowd: '',
                board: '',
                notes: `Session enregistr√©e depuis la fiche spot SwellSync`,
                score,
                createdAt: new Date().toISOString()
            };
            const sessions = JSON.parse(localStorage.getItem('swellsync_sessions') || '[]');
            sessions.unshift(session);
            localStorage.setItem('swellsync_sessions', JSON.stringify(sessions));
            // Feedback
            const btn = event.target;
            const col = score >= 8.5 ? '#4ade80' : score >= 7 ? '#fbbf24' : '#00bad6';
            btn.textContent = `‚úÖ Session ${score.toFixed(1)}/10 enregistr√©e !`;
            btn.style.background = col;
            setTimeout(() => {
                btn.textContent = '‚úÖ Enregistrer la session';
                btn.style.background = 'linear-gradient(135deg,#00bad6,#0090a8)';
            }, 3000);
        }
    </script>

    <!-- PREVISIONS -->
    <section class="max-w-7xl mx-auto px-6 mb-16">

        <!-- Tabs -->
        <div class="flex items-center justify-between mb-6">
            <div>
                <h2 class="text-2xl font-black text-white">Pr√©visions</h2>
                <p class="text-xs text-slate-500 font-bold uppercase tracking-widest mt-1">Donn√©es Open-Meteo Marine</p>
            </div>
            <div class="flex items-center gap-3">
                <button id="tab-24h" onclick="switchForecast('24h')"
                    class="day-tab active text-[11px] font-black uppercase tracking-widest px-4 py-2 rounded-full border border-primary/30 text-primary">
                    24 Heures
                </button>
                <button id="tab-7d" onclick="switchForecast('7d')"
                    class="day-tab text-[11px] font-black uppercase tracking-widest px-4 py-2 rounded-full border border-white/10 text-slate-400">
                    7 Jours
                </button>
                <button id="tab-16d" onclick="switchForecast('16d')"
                    class="day-tab text-[11px] font-black uppercase tracking-widest px-4 py-2 rounded-full border border-white/10 text-slate-400 flex items-center gap-1.5">
                    <span>16 Jours</span>
                    <span class="text-yellow-400">&#128081;</span>
                </button>
            </div>
        </div>

        <!-- Bloc 24H ‚Äî Grille style surf magazine -->
        <div id="forecast-24h" class="glass rounded-[2rem] border border-primary/15 overflow-hidden">

            <!-- Header d'info -->
            <div class="px-6 pt-5 pb-3 flex items-center justify-between border-b border-white/5">
                <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Pr√©visions heure par heure ‚Äî
                    <span class="text-primary">Aujourd'hui</span>
                </p>
                <p class="text-[10px] text-slate-600 font-bold">Tranches de 3h &#8226; 8 p√©riodes</p>
            </div>

            <!-- Grille scrollable -->
            <div class="overflow-x-auto forecast-scroll">
                <table id="forecast-table-24h" class="forecast-table w-full border-collapse" style="min-width:820px">
                    <!-- Rempli par JS -->
                </table>
            </div>

            <!-- L√©gende qualit√© -->
            <div class="flex flex-wrap items-center gap-4 px-6 py-4 border-t border-white/5">
                <span class="text-[9px] font-black text-slate-600 uppercase tracking-widest mr-2">Qualit√© :</span>
                <span class="flex items-center gap-1.5 text-[10px] font-bold text-purple-400"><span
                        class="w-2.5 h-2.5 rounded-full bg-purple-500 inline-block"></span> √âpique (&gt;3m)</span>
                <span class="flex items-center gap-1.5 text-[10px] font-bold text-primary"><span
                        class="w-2.5 h-2.5 rounded-full bg-primary inline-block"></span> Excellent (2-3m)</span>
                <span class="flex items-center gap-1.5 text-[10px] font-bold text-green-400"><span
                        class="w-2.5 h-2.5 rounded-full bg-green-400 inline-block"></span> Bon (1-2m)</span>
                <span class="flex items-center gap-1.5 text-[10px] font-bold text-yellow-400"><span
                        class="w-2.5 h-2.5 rounded-full bg-yellow-400 inline-block"></span> Moyen (0.5-1m)</span>
                <span class="flex items-center gap-1.5 text-[10px] font-bold text-red-400"><span
                        class="w-2.5 h-2.5 rounded-full bg-red-500 inline-block"></span> Plat (&lt;0.5m)</span>
            </div>
        </div>

        <!-- Bloc 7J ‚Äî Grille 7 jours x 3 cr√©neaux -->
        <div id="forecast-7d" class="hidden glass rounded-[2rem] border border-primary/15 overflow-hidden">
            <div class="px-6 pt-5 pb-3 flex items-center justify-between border-b border-white/5">
                <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Pr√©visions ‚Äî <span
                        class="text-primary">7 prochains jours</span></p>
                <p class="text-[10px] text-slate-600 font-bold">3 cr√©neaux / jour &#8226; Matin &#8226; Apr√®s-midi
                    &#8226; Soir</p>
            </div>
            <div class="overflow-x-auto forecast-scroll">
                <table id="forecast-table-7d" class="forecast-table w-full border-collapse" style="min-width:900px">
                    <!-- Rempli par JS -->
                </table>
            </div>
            <div class="flex flex-wrap items-center gap-4 px-6 py-4 border-t border-white/5">
                <span class="text-[9px] font-black text-slate-600 uppercase tracking-widest mr-2">Qualit√© :</span>
                <span class="flex items-center gap-1.5 text-[10px] font-bold text-purple-400"><span
                        class="w-2.5 h-2.5 rounded-full bg-purple-500 inline-block"></span> √âpique (&gt;3m)</span>
                <span class="flex items-center gap-1.5 text-[10px] font-bold text-primary"><span
                        class="w-2.5 h-2.5 rounded-full bg-primary inline-block"></span> Excellent (2-3m)</span>
                <span class="flex items-center gap-1.5 text-[10px] font-bold text-green-400"><span
                        class="w-2.5 h-2.5 rounded-full bg-green-400 inline-block"></span> Bon (1-2m)</span>
                <span class="flex items-center gap-1.5 text-[10px] font-bold text-yellow-400"><span
                        class="w-2.5 h-2.5 rounded-full bg-yellow-400 inline-block"></span> Moyen (0.5-1m)</span>
                <span class="flex items-center gap-1.5 text-[10px] font-bold text-red-400"><span
                        class="w-2.5 h-2.5 rounded-full bg-red-500 inline-block"></span> Plat (&lt;0.5m)</span>
            </div>
        </div>

        <div id="forecast-16d" class="hidden">
            <div id="forecast-16d-locked" class="relative rounded-[2rem] overflow-hidden">
                <div class="glass border border-yellow-400/15 p-8 premium-blur rounded-[2rem]">
                    <div class="grid grid-cols-7 gap-3">
                        <div class="flex flex-col items-center gap-2 p-3 rounded-xl bg-white/5 border border-white/10">
                            <div class="w-full h-24 bg-white/5 rounded-lg"></div>
                            <div class="h-2 w-12 bg-white/10 rounded"></div>
                        </div>
                        <div class="flex flex-col items-center gap-2 p-3 rounded-xl bg-white/5 border border-white/10">
                            <div class="w-full h-24 bg-white/5 rounded-lg"></div>
                            <div class="h-2 w-12 bg-white/10 rounded"></div>
                        </div>
                        <div class="flex flex-col items-center gap-2 p-3 rounded-xl bg-white/5 border border-white/10">
                            <div class="w-full h-24 bg-white/5 rounded-lg"></div>
                            <div class="h-2 w-12 bg-white/10 rounded"></div>
                        </div>
                        <div class="flex flex-col items-center gap-2 p-3 rounded-xl bg-white/5 border border-white/10">
                            <div class="w-full h-24 bg-white/5 rounded-lg"></div>
                            <div class="h-2 w-12 bg-white/10 rounded"></div>
                        </div>
                        <div class="flex flex-col items-center gap-2 p-3 rounded-xl bg-white/5 border border-white/10">
                            <div class="w-full h-24 bg-white/5 rounded-lg"></div>
                            <div class="h-2 w-12 bg-white/10 rounded"></div>
                        </div>
                        <div class="flex flex-col items-center gap-2 p-3 rounded-xl bg-white/5 border border-white/10">
                            <div class="w-full h-24 bg-white/5 rounded-lg"></div>
                            <div class="h-2 w-12 bg-white/10 rounded"></div>
                        </div>
                        <div class="flex flex-col items-center gap-2 p-3 rounded-xl bg-white/5 border border-white/10">
                            <div class="w-full h-24 bg-white/5 rounded-lg"></div>
                            <div class="h-2 w-12 bg-white/10 rounded"></div>
                        </div>
                    </div>
                </div>
                <div class="absolute inset-0 flex flex-col items-center justify-center gap-5 z-20 premium-badge">
                    <div
                        class="w-16 h-16 rounded-full bg-yellow-400/10 border border-yellow-400/30 flex items-center justify-center text-3xl glow-gold">
                        &#128081;</div>
                    <div class="text-center">
                        <p class="font-black text-white text-xl mb-1">Pr√©visions 16 Jours</p>
                        <p class="text-slate-400 text-sm">Acc√®s r√©serv√© aux abonn√©s <span
                                class="text-yellow-400 font-black">SwellSync PRO</span></p>
                    </div>
                    <button onclick="openFeaturePopup && openFeaturePopup('pro')"
                        class="px-8 py-3 rounded-full bg-yellow-400/10 hover:bg-yellow-400/20 border border-yellow-400/30 text-yellow-400 font-black text-sm uppercase tracking-widest transition-all glow-gold">
                        D√©bloquer PRO
                    </button>
                </div>
            </div>
            <div id="forecast-16d-unlocked" class="hidden glass rounded-[2rem] border border-yellow-400/15 p-8">
                <div class="flex items-center gap-2 mb-6">
                    <span class="text-yellow-400">&#128081;</span>
                    <p class="text-[10px] font-black text-yellow-400 uppercase tracking-widest">Pr√©visions PRO ‚Äî 16
                        Jours</p>
                </div>
                <div id="grid-16d" class="grid grid-cols-4 md:grid-cols-8 gap-3"></div>
            </div>
        </div>
    </section>

    <!-- ANALYSE CONDITIONS + MINI CARTE -->
    <section class="max-w-7xl mx-auto px-6 mb-12">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass p-8 rounded-[2rem] border border-primary/20 glow fade-in">
                <!-- En-t√™te widget -->
                <div class="flex items-center gap-3 mb-6">
                    <div
                        class="w-10 h-10 rounded-xl bg-primary/10 border border-primary/20 flex items-center justify-center text-xl">
                        üåä</div>
                    <div>
                        <h3 class="font-black text-white text-sm uppercase tracking-widest">Analyse des Conditions</h3>
                        <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Houle ¬∑ Vent ¬∑ P√©riode
                            ¬∑ Spot</p>
                    </div>
                    <div
                        class="ml-auto flex items-center gap-1.5 px-3 py-1 rounded-full bg-primary/5 border border-primary/20">
                        <span class="w-1.5 h-1.5 bg-primary rounded-full animate-pulse"></span>
                        <span class="text-[10px] font-black text-primary tracking-widest">EN DIRECT</span>
                    </div>
                </div>

                <!-- Score global + label -->
                <div class="mb-5">
                    <div class="flex justify-between items-end mb-2">
                        <span class="text-[10px] text-slate-500 uppercase font-black tracking-widest">Score
                            conditions</span>
                        <span id="ai-score-label"
                            class="text-xs font-black text-primary uppercase tracking-widest">‚Äî</span>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="flex-1 h-3 bg-background-dark rounded-full overflow-hidden">
                            <div id="ai-score-bar"
                                class="h-full bg-primary rounded-full shadow-[0_0_12px_rgba(0,186,214,0.8)] transition-all duration-1000"
                                style="width: 0%"></div>
                        </div>
                        <span id="ai-score-pct" class="text-3xl font-black text-white">‚Äî</span>
                    </div>
                </div>

                <!-- Taux de confiance -->
                <div id="ai-confidence" class="mb-5 p-3 rounded-xl bg-white/3 border border-white/6">
                    <div
                        style="font-size:10px;font-weight:900;letter-spacing:.12em;color:#64748b;text-transform:uppercase;margin-bottom:6px">
                        Taux de confiance</div>
                    <div class="flex items-center gap-1">
                        <span
                            style="width:8px;height:8px;border-radius:50%;display:inline-block;background:rgba(255,255,255,0.08)"></span>
                        <span
                            style="width:8px;height:8px;border-radius:50%;display:inline-block;background:rgba(255,255,255,0.08)"></span>
                        <span
                            style="width:8px;height:8px;border-radius:50%;display:inline-block;background:rgba(255,255,255,0.08)"></span>
                        <span
                            style="width:8px;height:8px;border-radius:50%;display:inline-block;background:rgba(255,255,255,0.08)"></span>
                        <span
                            style="width:8px;height:8px;border-radius:50%;display:inline-block;background:rgba(255,255,255,0.08)"></span>
                        <span
                            style="width:8px;height:8px;border-radius:50%;display:inline-block;background:rgba(255,255,255,0.08)"></span>
                        <span
                            style="width:8px;height:8px;border-radius:50%;display:inline-block;background:rgba(255,255,255,0.08)"></span>
                        <span
                            style="width:8px;height:8px;border-radius:50%;display:inline-block;background:rgba(255,255,255,0.08)"></span>
                        <span
                            style="width:8px;height:8px;border-radius:50%;display:inline-block;background:rgba(255,255,255,0.08)"></span>
                        <span
                            style="width:8px;height:8px;border-radius:50%;display:inline-block;background:rgba(255,255,255,0.08)"></span>
                        <span class="ml-2 text-xs font-black text-slate-500">‚Äî/10</span>
                    </div>
                </div>

                <!-- Facteurs d√©taill√©s -->
                <div id="ai-details" class="space-y-2 mb-5">
                    <div class="flex items-start gap-3 p-3 rounded-xl bg-white/5 border border-white/5">
                        <span class="text-green-400 mt-0.5">‚úÖ</span>
                        <span class="text-sm text-slate-300">Vent offshore parfait pour la session</span>
                    </div>
                    <div class="flex items-start gap-3 p-3 rounded-xl bg-white/5 border border-white/5">
                        <span class="text-green-400 mt-0.5">‚úÖ</span>
                        <span class="text-sm text-slate-300">Houle r√©guli√®re ‚Äî R√©gularit√© 74%</span>
                    </div>
                    <div class="flex items-start gap-3 p-3 rounded-xl bg-white/5 border border-white/5">
                        <span class="text-yellow-400 mt-0.5">‚ö†Ô∏è</span>
                        <span class="text-sm text-slate-300">Mar√©e basse dans 2h ‚Äî attention au banc de sable</span>
                    </div>
                </div>

                <!-- Recommandation verdict -->
                <div class="mt-auto p-4 rounded-xl bg-primary/5 border border-primary/15 flex gap-3">
                    <span class="text-2xl">üí¨</span>
                    <p id="ai-recommendation" class="text-sm text-slate-300 leading-relaxed italic">
                        ¬´ Chargement de l'√©valuation... ¬ª
                    </p>
                </div>
            </div>
            <!-- Mini Carte -->
            <div class="glass p-4 rounded-[2rem] border border-white/10 flex flex-col gap-4">
                <div class="flex items-center justify-between px-2">
                    <h3 class="font-black text-white text-sm uppercase tracking-widest flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary text-[18px]">map</span>
                        Localisation
                    </h3>
                    <span id="mini-map-name"
                        class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">‚Äî</span>
                </div>
                <div id="spot-mini-map" class="flex-1 rounded-[1.5rem] overflow-hidden border border-white/5"
                    style="height:320px;"></div>
            </div>
        </div>
    </section>

    <!-- WIDGETS SMART -->
    <section class="max-w-7xl mx-auto px-6 mb-12">
        <div class="flex items-center gap-3 mb-6">
            <h2 class="text-2xl font-black text-white">Tableau de Bord du Surfeur</h2>
            <div class="flex items-center gap-1.5 px-3 py-1 rounded-full bg-primary/5 border border-primary/20">
                <span class="w-1.5 h-1.5 bg-primary rounded-full animate-pulse"></span>
                <span class="text-[10px] font-black text-primary tracking-widest">‚Ä¢ EN DIRECT</span>
            </div>
        </div>

        <!-- Ligne 1 : M√©t√©o + Affluence + Niveau -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-5 mb-5">

            <!-- Widget M√©t√©o -->
            <div class="glass p-6 rounded-[2rem] border border-white/10 flex flex-col gap-4" id="widget-meteo">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-yellow-400/10 border border-yellow-400/20 flex items-center justify-center text-xl"
                        id="meteo-icon-box">&#9728;&#65039;</div>
                    <div>
                        <h3 class="font-black text-white text-sm uppercase tracking-widest">M√©t√©o</h3>
                        <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Conditions actuelles
                        </p>
                    </div>
                </div>
                <div class="text-center py-2">
                    <div id="meteo-emoji" class="text-6xl mb-2">&#9728;&#65039;</div>
                    <p id="meteo-label" class="text-white font-black text-lg">Ensoleill√©</p>
                    <p id="meteo-sub" class="text-slate-400 text-xs mt-1">Temp√©rature : 14¬∞C ‚Ä¢ UV : Mod√©r√©</p>
                </div>
                <div class="grid grid-cols-3 gap-2 pt-2 border-t border-white/5">
                    <div class="flex flex-col items-center gap-1">
                        <span class="text-base" id="meteo-temp-icon">&#127777;&#65039;</span>
                        <span id="meteo-temp" class="text-xs font-black text-white">14¬∞C</span>
                        <span class="text-[9px] text-slate-500 uppercase font-bold">Air</span>
                    </div>
                    <div class="flex flex-col items-center gap-1">
                        <span class="text-base">&#128167;</span>
                        <span id="meteo-water" class="text-xs font-black text-white">13¬∞C</span>
                        <span class="text-[9px] text-slate-500 uppercase font-bold">Eau</span>
                    </div>
                    <div class="flex flex-col items-center gap-1">
                        <span class="text-base">&#128065;&#65039;</span>
                        <span id="meteo-visi" class="text-xs font-black text-white">&gt;10km</span>
                        <span class="text-[9px] text-slate-500 uppercase font-bold">Visib.</span>
                    </div>
                </div>
            </div>

            <!-- Widget Affluence -->
            <div class="glass p-6 rounded-[2rem] border border-white/10 flex flex-col gap-4" id="widget-crowd">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 rounded-xl bg-orange-400/10 border border-orange-400/20 flex items-center justify-center text-xl">
                        &#128101;</div>
                    <div>
                        <h3 class="font-black text-white text-sm uppercase tracking-widest">Affluence</h3>
                        <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Monde sur le spot</p>
                    </div>
                </div>
                <div class="flex flex-col gap-3">
                    <div class="flex justify-between items-center">
                        <span id="crowd-label" class="text-white font-black text-lg">Calme</span>
                        <span id="crowd-count" class="text-slate-400 text-xs font-bold">~5 surfeurs</span>
                    </div>
                    <!-- Jauge surfeurs -->
                    <div class="flex gap-1.5">
                        <span id="crowd-dot-1" class="text-2xl">&#127940;&#65039;</span>
                        <span id="crowd-dot-2" class="text-2xl opacity-20">&#127940;&#65039;</span>
                        <span id="crowd-dot-3" class="text-2xl opacity-20">&#127940;&#65039;</span>
                        <span id="crowd-dot-4" class="text-2xl opacity-20">&#127940;&#65039;</span>
                        <span id="crowd-dot-5" class="text-2xl opacity-20">&#127940;&#65039;</span>
                    </div>
                    <div class="h-2 bg-background-dark rounded-full overflow-hidden">
                        <div id="crowd-bar" class="h-full rounded-full transition-all duration-700"
                            style="width:15%;background:#4ade80"></div>
                    </div>
                    <div class="flex items-center gap-2 mt-1 p-3 rounded-xl bg-white/5 border border-white/5">
                        <span class="text-green-400 text-sm">&#128337;</span>
                        <p id="crowd-tip" class="text-xs text-slate-300 font-medium">Meilleur cr√©neau : <strong
                                class="text-white">7h‚Äì9h</strong> ou <strong class="text-white">18h‚Äì20h</strong></p>
                    </div>
                </div>
            </div>

            <!-- Widget Niveau Requis -->
            <div class="glass p-6 rounded-[2rem] border border-white/10 flex flex-col gap-4" id="widget-level">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 rounded-xl bg-primary/10 border border-primary/20 flex items-center justify-center text-xl">
                        &#127940;&#65039;</div>
                    <div>
                        <h3 class="font-black text-white text-sm uppercase tracking-widest">Niveau Requis</h3>
                        <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Pour surfer
                            aujourd'hui</p>
                    </div>
                </div>
                <div class="flex flex-col gap-3">
                    <div id="level-badge" class="flex items-center justify-center gap-2 py-3 rounded-xl border"
                        style="background:rgba(74,222,128,0.1);border-color:rgba(74,222,128,0.3)">
                        <span id="level-emoji" class="text-2xl">&#128118;</span>
                        <span id="level-label"
                            class="font-black text-green-400 text-lg uppercase tracking-wide" data-i18n="coaching.intermediate">Interm√©diaire</span>
                    </div>
                    <!-- Scale visuelle -->
                    <div class="grid grid-cols-4 gap-1.5 mt-1">
                        <div id="lvl-1" class="flex flex-col items-center gap-1.5">
                            <div class="w-full h-1.5 rounded-full bg-green-400 shadow-[0_0_6px_rgba(74,222,128,0.6)]">
                            </div>
                            <span class="text-[8px] font-black text-green-400 uppercase tracking-wider" data-i18n="coaching.beginner">D√©butant</span>
                        </div>
                        <div id="lvl-2" class="flex flex-col items-center gap-1.5">
                            <div class="w-full h-1.5 rounded-full bg-primary shadow-[0_0_6px_rgba(0,186,214,0.6)]">
                            </div>
                            <span class="text-[8px] font-black text-primary uppercase tracking-wider">Interm√©.</span>
                        </div>
                        <div id="lvl-3" class="flex flex-col items-center gap-1.5">
                            <div class="w-full h-1.5 rounded-full bg-white/10"></div>
                            <span class="text-[8px] font-bold text-slate-600 uppercase tracking-wider" data-i18n="coaching.advanced">Avanc√©</span>
                        </div>
                        <div id="lvl-4" class="flex flex-col items-center gap-1.5">
                            <div class="w-full h-1.5 rounded-full bg-white/10"></div>
                            <span class="text-[8px] font-bold text-slate-600 uppercase tracking-wider">Expert</span>
                        </div>
                    </div>
                    <p id="level-desc" class="text-xs text-slate-400 mt-1 leading-relaxed">Houle r√©guli√®re, vagues
                        propres. Ma√Ætrise du d√©part et des virages requise.</p>
                </div>
            </div>
        </div>

        <!-- Ligne 2 : √âquipement IA + Check-list -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-5">

            <!-- Widget √âquipement IA -->
            <div class="glass p-6 rounded-[2rem] border border-primary/20 glow flex flex-col gap-4">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 rounded-xl bg-primary/10 border border-primary/20 flex items-center justify-center text-xl">
                        &#129302;</div>
                    <div>
                        <h3 class="font-black text-white text-sm uppercase tracking-widest">√âquipement Recommand√©</h3>
                        <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">SwellSync ¬∑ Analyse
                            des conditions</p>
                    </div>
                </div>
                <div id="gear-grid" class="grid grid-cols-2 gap-3">
                    <!-- Rempli par JS -->
                </div>
                <div class="flex items-start gap-3 p-3 rounded-xl bg-primary/5 border border-primary/15">
                    <span class="text-lg mt-0.5">üèÑ</span>
                    <p id="gear-tip" class="text-xs text-slate-300 leading-relaxed italic">"Avec 1.5m de houle et 13¬∞C
                        d'eau, une combinaison 4/3 et un shortboard 6'2 sont id√©aux pour cette session."</p>
                </div>
            </div>

            <!-- Widget Outils Essentiels -->
            <div class="glass p-6 rounded-[2rem] border border-white/10 flex flex-col gap-4">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 rounded-xl bg-purple-500/10 border border-purple-500/20 flex items-center justify-center text-xl">
                        &#9989;</div>
                    <div>
                        <h3 class="font-black text-white text-sm uppercase tracking-widest">Check-list Avant de Surfer
                        </h3>
                        <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Essentiels pour la
                            session</p>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-2.5" id="checklist-grid">
                    <!-- Rempli par JS -->
                </div>
                <div class="flex items-center gap-2 p-3 rounded-xl bg-green-400/5 border border-green-400/15 mt-1">
                    <span class="text-green-400">&#9989;</span>
                    <p class="text-xs text-green-400 font-black">Session parfaite sous r√©serve d'un bon √©chauffement !
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- WEBCAM GOSURF -->
    <section class="max-w-7xl mx-auto px-6 mb-12">
        <div class="rounded-[2rem] overflow-hidden border border-primary/20"
            style="background:linear-gradient(135deg,#050e10 60%,#071318);">
            <!-- Fond visuel anim√© -->
            <div class="relative w-full" style="aspect-ratio:16/9;min-height:260px;">
                <!-- Image du spot en fond flout√© -->
                <img id="cam-bg-img" src="assets/images/hero-home-new.jpg" alt="Spot cam"
                    class="absolute inset-0 w-full h-full object-cover"
                    style="filter:brightness(0.22) saturate(0.5) blur(2px);transform:scale(1.04);" / loading="lazy"
                    decoding="async">

                <!-- Overlay gradient -->
                <div class="absolute inset-0"
                    style="background:linear-gradient(135deg,rgba(0,186,214,0.07),rgba(0,0,0,0.6));"></div>

                <!-- Contenu centr√© -->
                <div class="absolute inset-0 flex flex-col items-center justify-center gap-6 p-8 text-center"
                    style="z-index:2;">
                    <!-- Ic√¥ne -->
                    <div
                        style="width:72px;height:72px;border-radius:50%;background:rgba(0,186,214,0.1);border:1px solid rgba(0,186,214,0.3);display:flex;align-items:center;justify-content:center;">
                        <span class="material-symbols-outlined" style="font-size:34px;color:#00bad6;">videocam</span>
                    </div>

                    <!-- Texte -->
                    <div>
                        <p class="font-black text-white text-lg uppercase tracking-widest mb-1">Webcam Live</p>
                        <p id="cam-spot-label" class="text-slate-400 text-sm font-medium">Flux en direct disponible sur
                            GoSurf.fr</p>
                    </div>

                    <!-- BOUTON PRINCIPAL -->
                    <a id="btn-gosurf-section" href="https://gosurf.fr/list" target="_blank" rel="noopener"
                        class="flex items-center gap-3 px-8 py-4 rounded-2xl font-black text-sm uppercase tracking-widest transition-all"
                        style="background:linear-gradient(135deg,rgba(0,186,214,0.2),rgba(0,100,200,0.15));border:1.5px solid rgba(0,186,214,0.55);color:#00bad6;text-decoration:none;box-shadow:0 0 24px rgba(0,186,214,0.2);"
                        onmouseover="this.style.boxShadow='0 0 40px rgba(0,186,214,0.45)';this.style.background='linear-gradient(135deg,rgba(0,186,214,0.3),rgba(0,100,200,0.25))';"
                        onmouseout="this.style.boxShadow='0 0 24px rgba(0,186,214,0.2)';this.style.background='linear-gradient(135deg,rgba(0,186,214,0.2),rgba(0,100,200,0.15))';">
                        <span style="font-size:20px;">üé•</span>
                        <span>Voir sur GoSurf</span>
                        <span class="material-symbols-outlined" style="font-size:16px;">open_in_new</span>
                    </a>

                    <p class="text-slate-600 text-xs font-bold uppercase tracking-widest">Flux live via GoSurf.fr ¬∑ Hors
                        site</p>
                </div>
            </div>
        </div>
    </section>


    <!-- FOOTER -->
    <footer class="border-t border-white/5 py-10 px-6">
        <div
            class="max-w-7xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4 text-slate-600 text-xs font-bold">
            <div class="flex items-center gap-2">
                <img src="assets/images/swellsync_icon.svg" alt="SwellSync" class="w-6 h-6 opacity-40">
                <span>&#169; 2026 SwellSync. Tous droits r√©serv√©s.</span>
            </div>
            <div class="flex items-center gap-6">
                <a href="legal.html" class="hover:text-slate-400 transition-colors" data-i18n="legal.title">Mentions l√©gales</a>
                <a href="privacy.html" class="hover:text-slate-400 transition-colors">Confidentialit√©</a>
                <a href="cgv.html" class="hover:text-slate-400 transition-colors">CGV</a>
            </div>
        </div>
    </footer>

    <script>
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // UTILITAIRES
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function getParam(k) { return new URLSearchParams(window.location.search).get(k); }

        const waveTypeImages = {
            'BEACH BREAK': 'https://images.unsplash.com/photo-1502680390469-be75c86b636f?auto=format&fit=crop&q=80&w=1600',
            'REEF BREAK': 'https://images.unsplash.com/photo-1505459668311-8dfac7952bf0?auto=format&fit=crop&q=80&w=1600',
            'POINT BREAK': 'https://images.unsplash.com/photo-1516802273409-68526ee1bdd6?auto=format&fit=crop&q=80&w=1600',
            'MIXTE': 'https://images.unsplash.com/photo-1476673160081-cf065607f449?auto=format&fit=crop&q=80&w=1600',
            'default': 'assets/images/hero-home-new.jpg'
        };

        // Images sp√©cifiques par spot ID (priorit√© sur le type de vague)
        const spotSpecificImages = {
            // Bretagne
            '1': 'assets/images/spot_1.jpg',   // Blanc Sablons
            '2': 'assets/images/spot_2.jpg',   // La Palue
            '3': 'assets/images/spot_3.jpg',   // Goulien
            '4': 'assets/images/spot_4.jpg',   // Baie des Tr√©pass√©s
            '5': 'assets/images/spot_5.jpg',   // Pors Ar Vag
            '6': 'assets/images/spot_6.jpg',   // La Torche
            '7': 'assets/images/spot_7.jpg',   // Trono√´n
            '8': 'assets/images/spot_8.jpg',   // Pors Carn
            '9': 'assets/images/spot_9.jpg',   // Guidel Plages
            '10': 'assets/images/spot_10.jpg',  // Plouharnel
            '11': 'assets/images/spot_11.jpg',  // Port Blanc
            // Vend√©e
            '12': 'assets/images/spot_12.jpg',  // Les Sables d'Olonne
            '13': 'assets/images/spot_13.jpg',  // Sauveterre
            '14': 'assets/images/spot_14.jpg',  // La Sauzaie
            '15': 'assets/images/spot_15.jpg',  // Bud Bud
            '16': 'assets/images/spot_16.jpg',  // La Tranche-sur-Mer
            // Iles
            '17': 'assets/images/spot_17.jpg',  // Les Grenettes (R√©)
            '18': 'assets/images/spot_18.jpg',  // Le Petit Bec (R√©)
            '19': 'assets/images/spot_19.jpg',  // Vert-Bois (Ol√©ron)
            '20': 'assets/images/spot_20.jpg',  // Grand-Village (Ol√©ron)
            // Charente / Gironde Nord
            '21': 'assets/images/spot_21.jpg',  // Pontaillac Royan
            '22': 'assets/images/spot_22.jpg',  // La C√¥te Sauvage
            '23': 'assets/images/spot_23.jpg',  // Soulac-sur-Mer
            '24': 'assets/images/spot_24.jpg',  // Montalivet
            '25': 'assets/images/spot_25.jpg',  // Hourtin Plage
            '26': 'assets/images/spot_26.jpg',  // Carcans Plage
            // Gironde / Cap Ferret
            '27': 'assets/images/spot_27.jpg',  // Lacanau Nord
            '28': 'assets/images/spot_28.jpg',  // Lacanau Centrale
            '29': 'assets/images/spot_29.jpg',  // Lacanau Sud
            '30': 'assets/images/spot_30.jpg',  // Le Porge
            '31': 'assets/images/spot_31.jpg',  // Le Truc Vert
            '32': 'assets/images/spot_32.jpg',  // Grand Crohot
            // Landes
            '33': 'assets/images/spot_33.jpg',  // Biscarrosse
            '34': 'assets/images/spot_34.jpg',  // Mimizan
            '35': 'assets/images/spot_35.jpg',  // Contis Plage
            '36': 'assets/images/spot_36.jpg',  // Cap de l'Homy
            '37': 'assets/images/spot_37.jpg',  // Saint-Girons
            '38': 'assets/images/spot_38.jpg',  // Moliets Plage
            '39': 'assets/images/spot_39.jpg',  // Messanges
            '40': 'assets/images/spot_40.jpg',  // Vieux-Boucau
            '41': 'assets/images/spot_41.jpg',  // Seignosse Le Penon
            '42': 'assets/images/spot_42.jpg',  // Seignosse Les Bourdaines
            '43': 'assets/images/spot_43.jpg',  // Seignosse Les Estagnots
            '44': 'assets/images/spot_44.jpg',  // Hossegor La Gravi√®re
            '45': 'assets/images/spot_45.jpg',  // La Nord Hossegor
            '46': 'assets/images/spot_46.jpg',  // La Sud Hossegor
            '47': 'assets/images/spot_47.jpg',  // Capbreton Le Santocha
            '48': 'assets/images/spot_48.jpg',  // Capbreton La Piste
            '49': 'assets/images/spot_49.jpg',  // Labenne Oc√©an
            '50': 'assets/images/spot_50.jpg',  // Ondres Plage
            '51': 'assets/images/spot_51.jpg',  // Tarnos La Digue
            // C√¥te Basque
            '52': 'assets/images/spot_52.jpg',  // Les Cavaliers Anglet
            '53': 'assets/images/spot_53.jpg',  // Marinella Anglet
            '54': 'assets/images/spot_54.jpg',  // Biarritz Grande Plage
            '55': 'assets/images/spot_55.jpg',  // C√¥te des Basques
            '56': 'assets/images/spot_56.jpg',  // Ilbarritz Bidart
            '57': 'assets/images/spot_57.jpg',  // Parlementia
            '58': 'assets/images/spot_58.jpg',  // Lafitenia
            '59': 'assets/images/spot_59.jpg',  // Erromardie
            '60': 'assets/images/spot_60.jpg',  // Hendaye
        };


        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // MOTEUR D'√âVALUATION SURF ‚Äî SwellSync Engine
        // Analyse des conditions : houle, p√©riode, vent, type de spot
        // √† partir de : hauteur swell, p√©riode, vent, type de spot
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

        // Les VRAIES donn√©es API remplaceront les param√®tres quand en ligne
        function computeSurfScore(swell, period = 10, windKts = 8, windDir = 'E', waveType = 'BEACH BREAK') {
            // ‚îÄ‚îÄ 1. Score brut houle (0-35 pts)
            let swellScore = 0;
            if (swell < 0.3) swellScore = 0;
            else if (swell < 0.5) swellScore = 6;
            else if (swell < 1.0) swellScore = 13;
            else if (swell < 1.5) swellScore = 20;
            else if (swell < 2.0) swellScore = 27;
            else if (swell < 3.0) swellScore = 31;
            else if (swell < 4.5) swellScore = 34;
            else swellScore = 35; // extr√™me

            // ‚îÄ‚îÄ 2. Bonus p√©riode (0-25 pts) ‚Äî longue p√©riode = vagues propres
            let periodScore = 0;
            if (period >= 16) periodScore = 25;
            else if (period >= 14) periodScore = 22;
            else if (period >= 12) periodScore = 18;
            else if (period >= 10) periodScore = 14;
            else if (period >= 8) periodScore = 8;
            else if (period >= 6) periodScore = 3;

            // ‚îÄ‚îÄ 3. Score vent (0-25 pts) ‚Äî offshore = meilleur
            const OFF = ['E', 'ENE', 'NE', 'ESE', 'SE', 'SSE'];
            const ON = ['W', 'WNW', 'NW', 'WSW', 'SW', 'SSW'];
            let windScore = 0;
            const isOffshore = OFF.includes(windDir);
            const isOnshore = ON.includes(windDir);
            if (isOffshore) {
                windScore = windKts <= 5 ? 25 : windKts <= 10 ? 22 : windKts <= 15 ? 18 : windKts <= 20 ? 12 : 5;
            } else if (isOnshore) {
                windScore = windKts <= 3 ? 18 : windKts <= 8 ? 12 : windKts <= 15 ? 6 : windKts <= 25 ? 2 : 0;
            } else {
                // Cross-shore
                windScore = windKts <= 5 ? 20 : windKts <= 12 ? 14 : windKts <= 20 ? 8 : 3;
            }

            // ‚îÄ‚îÄ 4. Bonus type de spot (0-15 pts)
            const spotBonus = {
                'REEF BREAK': 15,   // Les meilleures vagues
                'POINT BREAK': 13,  // Vagues longues et r√©guli√®res
                'BEACH BREAK': 10,  // Standard
                'MIXTE': 11,
            };
            const typeScore = spotBonus[waveType] || 10;

            // ‚îÄ‚îÄ Total sur 100
            const total = swellScore + periodScore + windScore + typeScore;

            // ‚îÄ‚îÄ 5. Taux de confiance /10 (bas√© sur p√©riode + coh√©rence donn√©es)
            // Plus la p√©riode est √©lev√©e & donn√©es API r√©elles ‚Üí plus confiant
            let confidence = 0;
            if (period >= 14) confidence = 9;
            else if (period >= 12) confidence = 8;
            else if (period >= 10) confidence = 7;
            else if (period >= 8) confidence = 6;
            else confidence = 5;
            // Bonus offshore stable
            if (isOffshore && windKts <= 10) confidence = Math.min(10, confidence + 1);
            // Fluctuation al√©atoire l√©g√®re (sera fixe avec vraies donn√©es API)
            confidence = Math.max(3, Math.min(10, confidence));

            return { total, confidence };
        }

        function getQuality(swell, period, windKts, windDir, waveType) {
            // Valeurs par d√©faut si appel√© sans params (grille pr√©visions)
            period = period ?? 10;
            windKts = windKts ?? 8;
            windDir = windDir ?? 'E';
            waveType = waveType ?? 'BEACH BREAK';

            const { total, confidence } = computeSurfScore(swell, period, windKts, windDir, waveType);
            // Expose pour usage externe (check-list verdict, etc.)
            getQuality._lastTotal = total;

            const OFF = ['E', 'ENE', 'NE', 'ESE', 'SE', 'SSE'];
            const ON = ['W', 'WNW', 'NW', 'WSW', 'SW', 'SSW'];
            const isOffshore = OFF.includes(windDir);
            const isOnshore = ON.includes(windDir);
            const windStrong = windKts > 20;
            const windLight = windKts <= 8;

            // ‚îÄ‚îÄ Classification principale bas√©e sur la HAUTEUR DE HOULE r√©elle
            // Seuils : Plat <0.5m ¬∑ Moyen 0.5-1m ¬∑ Bon 1-2m ¬∑ Excellent 2-3m ¬∑ √âpique >3m
            let label, tagline, col, icon;

            if (swell < 0.5) {
                // ‚îÄ‚îÄ PLAT
                label = 'Plat';
                tagline = 'Mer calme ‚Äî pas de surf possible';
                col = '#64748b';
                icon = 'üí§';

            } else if (swell < 1.0) {
                // ‚îÄ‚îÄ MOYEN (0.5 ‚Äì 1m)
                label = 'Moyen';
                col = '#f97316';
                icon = '„Ä∞Ô∏è';
                if (isOffshore && windLight)
                    tagline = 'Petites vagues propres ‚Äî id√©al d√©butants';
                else if (windStrong && isOnshore)
                    tagline = 'Trop venteux ‚Äî conditions d√©grad√©es';
                else
                    tagline = 'Session possible, conditions moyennes';

            } else if (swell < 2.0) {
                // ‚îÄ‚îÄ BON (1 ‚Äì 2m)
                label = 'Bon';
                col = '#4ade80';
                icon = '‚úÖ';
                if (isOffshore && windLight)
                    tagline = 'Belles vagues propres ‚Äî √† saisir !';
                else if (isOffshore)
                    tagline = 'Vagues de taille ‚Äî conditions agr√©ables';
                else if (windStrong && isOnshore)
                    tagline = 'Houle correcte mais vent d√©favorable';
                else
                    tagline = 'Bonnes conditions ‚Äî session conseill√©e';

            } else if (swell < 3.0) {
                // ‚îÄ‚îÄ EXCELLENT (2 ‚Äì 3m)
                label = 'Excellent';
                col = '#00bad6';
                icon = '‚≠ê';
                if (isOffshore)
                    tagline = 'Session de r√™ve ‚Äî ne ratez pas √ßa !';
                else if (isOnshore && windStrong)
                    tagline = 'Grosse houle mais vent onshore fort';
                else
                    tagline = 'Tr√®s belle houle ‚Äî conditions solides';

            } else if (swell < 5.0) {
                // ‚îÄ‚îÄ √âPIQUE (3 ‚Äì 5m)
                label = '√âpique';
                col = '#a855f7';
                icon = 'üèÜ';
                if (isOffshore)
                    tagline = 'Conditions exceptionnelles ‚Äî √† ne pas rater !';
                else if (isOnshore)
                    tagline = 'Houle massive, vent perturb√© ‚Äî exp√©riment√©s';
                else
                    tagline = 'Grosse mer ‚Äî r√©serv√© aux surfeurs confirm√©s';

            } else {
                // ‚îÄ‚îÄ TEMP√äTE (>5m)
                label = 'Temp√™te';
                tagline = 'Conditions extr√™mes ‚Äî danger, surfers experts uniquement';
                col = '#dc2626';
                icon = 'üåä';
            }

            const badge = `background:${col}18;color:${col};border:1px solid ${col}44`;
            return { label, tagline, confidence, col, icon, badge, total };
        }



        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // CHARGEMENT DU SPOT
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        let spotData = null;
        let miniMap = null;

        async function loadSpot() {
            const id = getParam('id');
            if (!id) {
                window.location.href = 'cotes.html';
                return;
            }

            // ‚îÄ‚îÄ Skeleton loader imm√©diat ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            const skeletonTarget = document.querySelector('#spot-hero-section, .hero-section, main > section:first-child, main > div:first-child');
            let skeletonEl = null;
            if (skeletonTarget) {
                skeletonEl = document.createElement('div');
                skeletonEl.id = 'spot-skeleton-loader';
                skeletonEl.style.cssText = 'position:absolute;top:0;left:0;right:0;bottom:0;z-index:5;padding:140px 48px 48px;pointer-events:none;';
                skeletonEl.innerHTML = `
                    <div class="skeleton skeleton-badge" style="width:100px;margin-bottom:16px;"></div>
                    <div class="skeleton skeleton-title" style="width:60%;max-width:400px;"></div>
                    <div class="skeleton skeleton-title" style="width:40%;max-width:260px;height:20px;"></div>
                    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:32px;max-width:600px;">
                        <div class="skeleton skeleton-stat"></div>
                        <div class="skeleton skeleton-stat"></div>
                        <div class="skeleton skeleton-stat"></div>
                    </div>
                `;
                skeletonTarget.style.position = 'relative';
                skeletonTarget.appendChild(skeletonEl);
            }

            try {
                const res = await fetch('/api/spots/' + id);
                if (!res.ok) throw new Error('Spot introuvable');
                spotData = await res.json();
                window.currentSpotId = id;

                // Supprimer le skeleton loader
                if (skeletonEl) {
                    skeletonEl.style.transition = 'opacity 0.3s';
                    skeletonEl.style.opacity = '0';
                    setTimeout(() => skeletonEl.remove(), 300);
                }

                renderSpot(spotData);
                loadCam(id, spotData);
                buildForecasts(spotData);
                buildSmartWidgets(spotData);

                // Mise √† jour bouton favori (charger depuis API si connect√©)
                if (typeof loadServerFavorites === 'function') {
                    loadServerFavorites().then(() => {
                        if (typeof updateFavoriteHeroButton === 'function') {
                            updateFavoriteHeroButton(String(id));
                        }
                    });
                } else if (typeof updateFavoriteHeroButton === 'function') {
                    updateFavoriteHeroButton(String(id));
                }
                // Initialiser alerte cam√©ra
                setTimeout(initCamAlertBtn, 100);

                // Mise √† jour profil navbar si d√©j√† connect√©
                if (typeof updateProfileUI === 'function') {
                    const su = localStorage.getItem('swellsync_user');
                    if (su) { try { updateProfileUI(JSON.parse(su)); } catch (e) { } }
                }
            } catch (e) {
                console.error(e);
                showError('Impossible de charger ce spot.');
            }
        }

        function showError(msg) {
            // Cacher l'overlay de chargement
            const overlay = document.getElementById('loading-overlay');
            if (overlay) overlay.remove();
            document.getElementById('hero-spot-name').textContent = 'Spot introuvable';
            document.getElementById('hero-description').textContent = msg;
            document.getElementById('hero-wave-type-text').textContent = 'Erreur';
        }

        function renderSpot(spot) {
            // 1. Retirer l'overlay de chargement
            const overlay = document.getElementById('loading-overlay');
            if (overlay) { overlay.style.opacity = '0'; overlay.style.transition = 'opacity 0.4s ease'; setTimeout(() => overlay.remove(), 450); }

            const waveType = (spot.wave_type || 'MIXTE').toUpperCase();
            const spotName = (spot.name || '').split(',')[0].trim() || spot.name || 'Spot';

            // 2. SEO dynamique
            document.title = 'SwellSync | ' + spotName + ' ‚Äî Conditions Live';
            const metaDesc = `Conditions surf ${spotName} en temps r√©el : houle, vent, pr√©visions 7 jours, √©quipement et affluence.`;
            const descMeta = document.querySelector('meta[name="description"]');
            if (descMeta) descMeta.setAttribute('content', metaDesc);
            const setOG = (id, val) => { const el = document.getElementById(id); if (el) el.setAttribute('content', val); };
            setOG('og-title', `SwellSync | ${spotName}`);
            setOG('og-desc', metaDesc);
            setOG('tw-title', `SwellSync | ${spotName}`);
            const ogUrl = document.getElementById('og-url');
            if (ogUrl) ogUrl.setAttribute('content', window.location.href);

            // 3. JSON-LD structur√©
            const schema = document.getElementById('schema-spot');
            if (schema) {
                const lat = spot.lat || spot.latitude;
                const lng = spot.lng || spot.longitude;
                schema.textContent = JSON.stringify({
                    '@context': 'https://schema.org',
                    '@type': 'TouristAttraction',
                    'name': spotName + ' ‚Äî Spot de Surf',
                    'description': metaDesc,
                    'url': window.location.href,
                    ...(lat ? { 'geo': { '@type': 'GeoCoordinates', 'latitude': lat, 'longitude': lng } } : {}),
                    'provider': { '@type': 'Organization', 'name': 'SwellSync', 'url': 'https://swellsync.fr' }
                });
            }

            // 4. Hero DOM
            document.getElementById('hero-spot-name').textContent = spotName;
            document.getElementById('hero-location').textContent = spot.location || spot.region || spotName;
            document.getElementById('hero-difficulty').textContent = spot.difficulty || 'Interm√©diaire';
            document.getElementById('hero-wave-type-text').textContent = waveType;
            document.getElementById('hero-description').textContent = spot.description || 'Spot embl√©matique avec des vagues de qualit√©.';
            document.getElementById('hero-bg').src = spotSpecificImages[String(spot.id)] || waveTypeImages[waveType] || waveTypeImages['default'];

            // üé• Bouton GoSurf : URL selon l'ID du spot
            const gosurfBtn = document.getElementById('btn-gosurf-cam');
            if (gosurfBtn) {
                const gsMap = {
                    12: 'https://gosurf.fr/webcam/fr/192/Saint-Gilles-Croix-de-Vie-Grande-Plage',
                    13: 'https://gosurf.fr/webcam/fr/146/Bretignolles-Sur-Mer-Plage-de-La-Sauzaie',
                    14: 'https://gosurf.fr/webcam/fr/27/Les-Sables-d-Olonne-Spot-de-la-Baie',
                    22: 'https://gosurf.fr/webcam/fr/57/Montalivet-Plage-Centrale',
                    26: 'https://gosurf.fr/webcam/fr/9/Lacanau-Plage-de-Lacanau-Ocean',
                    27: 'https://gosurf.fr/webcam/fr/9/Lacanau-Plage-de-Lacanau-Ocean',
                    28: 'https://gosurf.fr/webcam/fr/9/Lacanau-Plage-de-Lacanau-Ocean',
                    29: 'https://gosurf.fr/webcam/fr/9/Lacanau-Plage-de-Lacanau-Ocean',
                    32: 'https://gosurf.fr/webcam/fr/56/Biscarrosse-Plage-de-la-Centrale',
                    33: 'https://gosurf.fr/webcam/fr/56/Biscarrosse-Plage-de-la-Centrale',
                    34: 'https://gosurf.fr/webcam/fr/184/Mimizan-Plage-Centrale',
                    35: 'https://gosurf.fr/webcam/fr/185/Mimizan-Plage-Sud',
                    36: 'https://gosurf.fr/webcam/fr/163/Contis-Plage-de-Contis',
                    39: 'https://gosurf.fr/webcam/fr/85/Vieux-Boucau-Plage-de-Vieux-Boucau',
                    40: 'https://gosurf.fr/webcam/fr/187/Moliets-Plage-Centrale',
                    42: 'https://gosurf.fr/webcam/fr/79/Seignosse-Plage-des-Bourdaines-Plage-des-Estagnots',
                    43: 'https://gosurf.fr/webcam/fr/49/Seignosse-Plage-du-Penon',
                    44: 'https://gosurf.fr/webcam/fr/21/Hossegor-La-Centrale',
                    45: 'https://gosurf.fr/webcam/fr/170/Hossegor-Plage-de-la-Nord',
                    46: 'https://gosurf.fr/webcam/fr/21/Hossegor-La-Centrale',
                    47: 'https://gosurf.fr/webcam/fr/83/Capbreton-Plage-du-Santosha-de-La-Piste',
                    48: 'https://gosurf.fr/webcam/fr/19/Capbreton-Plage-du-Prevent',
                    52: 'https://gosurf.fr/webcam/fr/150/Anglet-Plage-de-la-Barre',
                    53: 'https://gosurf.fr/webcam/fr/40/Anglet-Plage-des-Cavaliers',
                    54: 'https://gosurf.fr/webcam/fr/84/Biarritz-La-Grande-Plage',
                    55: 'https://gosurf.fr/webcam/fr/7/Biarritz-La-Cote-des-Basques',
                    56: 'https://gosurf.fr/webcam/fr/147/Bidart-Plage-du-Centre',
                    57: 'https://gosurf.fr/webcam/fr/13/Bidart-Guethary-Parlementia',
                    58: 'https://gosurf.fr/webcam/fr/11/Saint-Jean-de-Luz-Sainte-Barbe-et-la-Baie',
                    59: 'https://gosurf.fr/webcam/fr/69/Ciboure-Plage-de-la-Bougie',
                    60: 'https://gosurf.fr/webcam/fr/8/Hendaye-Plage-du-Casino-et-des-Jumeaux',
                };
                gosurfBtn.href = gsMap[spot.id] || 'https://gosurf.fr/list';
                // Cacher le bouton si pas de cam connue pour ce spot
                gosurfBtn.style.display = gsMap[spot.id] ? 'flex' : 'none';
            }


            // Conditions live
            const cc = spot.current_conditions || {};
            let swellM = cc.wave_height ?? spot.current_swell_m ?? +(Math.random() * 2 + 0.5).toFixed(1);
            let periodS = cc.wave_period ?? spot.current_period_s ?? Math.floor(Math.random() * 8 + 6);
            let windKts = cc.wind_speed ?? spot.wind_speed_kts ?? Math.floor(Math.random() * 15 + 2);
            let windDir = cc.wind_dir_abbr ?? spot.wind_direction ?? ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'][Math.floor(Math.random() * 8)];

            // Tracker analytics admin
            if (typeof trackSpotConditionsAdmin === 'function') {
                trackSpotConditionsAdmin(spot, swellM, windKts, windDir, periodS);
            }

            document.getElementById('stat-swell').textContent = swellM;
            // Direction houle propre (compass + direction en FR)
            const swellDirEl = document.getElementById('stat-swell-dir');
            if (swellDirEl) {
                const swellDirFR = DIR_FR_GLOBAL[windDir] || windDir || '‚Äî';
                swellDirEl.textContent = (windDir || '‚Äî') + ' ¬∑ ' + swellDirFR;
            }
            document.getElementById('stat-wind').textContent = windKts;
            document.getElementById('stat-period').textContent = periodS;

            const offshore = windDir && (windDir.includes('E') || windDir.includes('W'));
            const windEl = document.getElementById('stat-wind-label');
            if (offshore) {
                windEl.textContent = 'Offshore';
                windEl.className = 'mt-3 text-[10px] font-black text-green-400 uppercase tracking-widest bg-green-500/10 border border-green-500/20 px-3 py-1 rounded-full';
            } else {
                windEl.textContent = 'Onshore';
                windEl.className = 'mt-3 text-[10px] font-black text-red-400 uppercase tracking-widest bg-red-500/10 border border-red-500/20 px-3 py-1 rounded-full';
            }

            // ‚îÄ‚îÄ MAR√âES DYNAMIQUES ‚Äî cycle r√©aliste bas√© sur l'heure
            const tideNow = computeTides();
            const statTideEl = document.getElementById('stat-tide');
            if (statTideEl) statTideEl.textContent = tideNow.label;
            const tideLowEl = document.getElementById('stat-tide-low');
            const tideHighEl = document.getElementById('stat-tide-high');
            if (tideHighEl) tideHighEl.textContent = tideNow.nextHigh;
            if (tideLowEl) tideLowEl.textContent = tideNow.nextLow;

            // ‚îÄ‚îÄ √âVALUATION SWELLSYNC ‚Äî moteur multi-facteurs
            const qual = getQuality(swellM, periodS, windKts, windDir, waveType);
            const scorePct = Math.round((qual.total / 100) * 100);

            // Barre de score
            setTimeout(() => { document.getElementById('ai-score-bar').style.width = scorePct + '%'; }, 300);
            document.getElementById('ai-score-bar').style.background = `linear-gradient(90deg, ${qual.col}88, ${qual.col})`;
            document.getElementById('ai-score-pct').textContent = scorePct + '%';
            document.getElementById('ai-score-label').textContent = qual.label;
            document.getElementById('ai-score-label').style.color = qual.col;

            // Taux de confiance
            const confEl = document.getElementById('ai-confidence');
            if (confEl) {
                const dots = Array.from({ length: 10 }, (_, i) =>
                    `<span style="width:8px;height:8px;border-radius:50%;display:inline-block;margin:0 2px;background:${i < qual.confidence ? qual.col : 'rgba(255,255,255,0.12)'}"></span>`
                ).join('');
                confEl.innerHTML = `
                    <div style="font-size:10px;font-weight:900;letter-spacing:.12em;color:#64748b;text-transform:uppercase;margin-bottom:6px">Taux de confiance</div>
                    <div style="display:flex;align-items:center;gap:4px">
                        ${dots}
                        <span style="margin-left:8px;font-size:13px;font-weight:900;color:${qual.col}">${qual.confidence}/10</span>
                    </div>`;
            }

            // Verdict narratif
            const ai_details_el = document.getElementById('ai-details');
            if (ai_details_el) {
                const factors = [
                    { ok: swellM >= 1.0 && swellM <= 3.5, text: `Houle ${swellM}m ‚Äî ${swellM < 0.5 ? 'Trop faible' : swellM > 3.5 ? 'Dangereusement forte' : 'Id√©ale pour surfer'}` },
                    { ok: periodS >= 10, text: `P√©riode ${periodS}s ‚Äî ${periodS >= 12 ? 'Longue, vagues propres' : periodS >= 8 ? 'Correcte' : 'Courte, vagues molles'}` },
                    { ok: offshore, text: `Vent ${windDir} ${windKts}kts ‚Äî ${offshore ? 'Offshore ‚ú® parfait' : 'Onshore, vagues perturb√©es'}` },
                    { ok: ['REEF BREAK', 'POINT BREAK'].includes(waveType), text: `Type : ${waveType} ‚Äî ${waveType === 'REEF BREAK' ? 'Vagues creuses et puissantes' : waveType === 'POINT BREAK' ? 'Vagues longues et r√©guli√®res' : 'Polyvalent'}` },
                ];
                if (spot.ai_analysis_details && spot.ai_analysis_details.length) {
                    ai_details_el.innerHTML = spot.ai_analysis_details.slice(0, 4).map(d => {
                        const icon = d.score > 70 ? '‚úÖ' : d.score > 40 ? '‚ö†Ô∏è' : '‚ùå';
                        return `<div class="flex items-start gap-3 p-3 rounded-xl bg-white/5 border border-white/5"><span>${icon}</span><span class="text-sm text-slate-300">${d.label || d.message || JSON.stringify(d)}</span></div>`;
                    }).join('');
                } else {
                    ai_details_el.innerHTML = factors.map(f =>
                        `<div style="display:flex;align-items:flex-start;gap:10px;padding:10px 14px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);margin-bottom:6px">
                            <span style="font-size:15px;line-height:1.4">${f.ok ? '‚úÖ' : '‚ö†Ô∏è'}</span>
                            <span style="font-size:13px;color:#cbd5e1;line-height:1.5">${f.text}</span>
                        </div>`
                    ).join('');
                }
            }

            // Recommandation contextuelle
            const recoMap = {
                // Labels bas√©s sur la hauteur r√©elle de la houle
                'Temp√™te': `üåä ¬´ Conditions de temp√™te ‚Äî houle >5m. Seulement pour les experts confirm√©s, prudence absolue. ¬ª`,
                '√âpique': `üèÜ ¬´ ${qual.tagline} Prenez votre gun ou votre board de grosse houle. ¬ª`,
                'Excellent': `‚≠ê ¬´ ${qual.tagline} Shortboard ou fish selon la prise d'eau. ¬ª`,
                'Bon': `‚úÖ ¬´ ${qual.tagline} Session recommand√©e pour tous les niveaux. ¬ª`,
                'Moyen': `„Ä∞Ô∏è ¬´ ${qual.tagline} Longboard ou bodyboard conseill√©. ¬ª`,
                'Plat': `üí§ ¬´ La mer est plate. Journ√©e repos ou bodyboard dans le shore break. ¬ª`,
            };

            const recoEl = document.getElementById('ai-recommendation');
            if (recoEl) recoEl.textContent = recoMap[qual.label] || `¬´ ${qual.tagline} ¬ª`;

            // Badge condition principal (si pr√©sent dans le DOM)
            const condBadgeEl = document.getElementById('condition-badge');
            if (condBadgeEl) {
                condBadgeEl.innerHTML = `<span style="${qual.badge};padding:6px 18px;border-radius:999px;font-size:11px;font-weight:900;letter-spacing:.12em;text-transform:uppercase">${qual.icon} ${qual.label} ¬∑ ${qual.tagline}</span>`;
            }

            // Mini carte
            document.getElementById('mini-map-name').textContent = (spot.name || '').split(',')[0];
            const lat = spot.lat ?? spot.latitude;
            const lng = spot.lng ?? spot.longitude;
            if (lat && lng && !miniMap) {
                miniMap = L.map('spot-mini-map', { attributionControl: false }).setView([lat, lng], 13);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { subdomains: 'abcd', maxZoom: 19 }).addTo(miniMap);
                const icon = L.divIcon({
                    className: '',
                    html: `<div style="width:16px;height:16px;border-radius:50%;background:#00bad6;box-shadow:0 0 15px #00bad6;border:3px solid #fff"></div>`,
                    iconSize: [16, 16], iconAnchor: [8, 8]
                });
                L.marker([lat, lng], { icon }).addTo(miniMap);
            }
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // WEBCAM ‚Äî GoSurf redirect (plus d'iframe)
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const GOSURF_MAP = {
            12: 'https://gosurf.fr/webcam/fr/192/Saint-Gilles-Croix-de-Vie-Grande-Plage',
            13: 'https://gosurf.fr/webcam/fr/146/Bretignolles-Sur-Mer-Plage-de-La-Sauzaie',
            14: 'https://gosurf.fr/webcam/fr/27/Les-Sables-d-Olonne-Spot-de-la-Baie',
            22: 'https://gosurf.fr/webcam/fr/57/Montalivet-Plage-Centrale',
            26: 'https://gosurf.fr/webcam/fr/9/Lacanau-Plage-de-Lacanau-Ocean',
            27: 'https://gosurf.fr/webcam/fr/9/Lacanau-Plage-de-Lacanau-Ocean',
            28: 'https://gosurf.fr/webcam/fr/9/Lacanau-Plage-de-Lacanau-Ocean',
            29: 'https://gosurf.fr/webcam/fr/9/Lacanau-Plage-de-Lacanau-Ocean',
            32: 'https://gosurf.fr/webcam/fr/56/Biscarrosse-Plage-de-la-Centrale',
            33: 'https://gosurf.fr/webcam/fr/56/Biscarrosse-Plage-de-la-Centrale',
            34: 'https://gosurf.fr/webcam/fr/184/Mimizan-Plage-Centrale',
            35: 'https://gosurf.fr/webcam/fr/185/Mimizan-Plage-Sud',
            36: 'https://gosurf.fr/webcam/fr/163/Contis-Plage-de-Contis',
            39: 'https://gosurf.fr/webcam/fr/85/Vieux-Boucau-Plage-de-Vieux-Boucau',
            40: 'https://gosurf.fr/webcam/fr/187/Moliets-Plage-Centrale',
            42: 'https://gosurf.fr/webcam/fr/79/Seignosse-Plage-des-Bourdaines-Plage-des-Estagnots',
            43: 'https://gosurf.fr/webcam/fr/49/Seignosse-Plage-du-Penon',
            44: 'https://gosurf.fr/webcam/fr/21/Hossegor-La-Centrale',
            45: 'https://gosurf.fr/webcam/fr/170/Hossegor-Plage-de-la-Nord',
            46: 'https://gosurf.fr/webcam/fr/21/Hossegor-La-Centrale',
            47: 'https://gosurf.fr/webcam/fr/83/Capbreton-Plage-du-Santosha-de-La-Piste',
            48: 'https://gosurf.fr/webcam/fr/19/Capbreton-Plage-du-Prevent',
            52: 'https://gosurf.fr/webcam/fr/150/Anglet-Plage-de-la-Barre',
            53: 'https://gosurf.fr/webcam/fr/40/Anglet-Plage-des-Cavaliers',
            54: 'https://gosurf.fr/webcam/fr/84/Biarritz-La-Grande-Plage',
            55: 'https://gosurf.fr/webcam/fr/7/Biarritz-La-Cote-des-Basques',
            56: 'https://gosurf.fr/webcam/fr/147/Bidart-Plage-du-Centre',
            57: 'https://gosurf.fr/webcam/fr/13/Bidart-Guethary-Parlementia',
            58: 'https://gosurf.fr/webcam/fr/11/Saint-Jean-de-Luz-Sainte-Barbe-et-la-Baie',
            59: 'https://gosurf.fr/webcam/fr/69/Ciboure-Plage-de-la-Bougie',
            60: 'https://gosurf.fr/webcam/fr/8/Hendaye-Plage-du-Casino-et-des-Jumeaux',
        };

        function loadCam(spotId, spot) {
            const spotName = spot ? (spot.name || '').split(',')[0].trim() : 'ce spot';
            const gsUrl = GOSURF_MAP[spotId] || 'https://gosurf.fr/list';
            const hasCam = !!GOSURF_MAP[spotId];

            // Mettre √† jour le label
            const label = document.getElementById('cam-spot-label');
            if (label) label.textContent = hasCam
                ? 'Cam live de ' + spotName + ' ¬∑ Vue depuis GoSurf.fr'
                : 'Flux en direct disponible sur GoSurf.fr';

            // Mettre √† jour les deux boutons GoSurf (hero + section)
            ['btn-gosurf-cam', 'btn-gosurf-section'].forEach(id => {
                const btn = document.getElementById(id);
                if (btn) btn.href = gsUrl;
            });

            // Mettre √† jour l'image de fond flout√© avec l'image du spot
            const bgImg = document.getElementById('cam-bg-img');
            if (bgImg && spot && spot.id) {
                bgImg.src = 'assets/images/spot_' + spot.id + '.jpg';
                bgImg.onerror = () => { bgImg.src = 'assets/images/hero-home-new.jpg'; };
            }
        }


        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // PREVISIONS ‚Äî GRILLE SURF-FORECAST
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const SWELL_DIRS = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'];

        function dirDeg(dir) { const i = SWELL_DIRS.indexOf(dir); return i >= 0 ? i * 22.5 : 0; }
        function periodLabel(s) { return s >= 12 ? 'Longue' : s >= 9 ? 'Moyenne' : 'Courte'; }

        // Direction vent en fran√ßais
        const DIR_FR = {
            'N': 'Nord', 'NNE': 'Nord-Nord-Est', 'NE': 'Nord-Est', 'ENE': 'Est-Nord-Est',
            'E': 'Est', 'ESE': 'Est-Sud-Est', 'SE': 'Sud-Est', 'SSE': 'Sud-Sud-Est',
            'S': 'Sud', 'SSW': 'Sud-Sud-Ouest', 'SW': 'Sud-Ouest', 'WSW': 'Ouest-Sud-Ouest',
            'W': 'Ouest', 'WNW': 'Ouest-Nord-Ouest', 'NW': 'Nord-Ouest', 'NNW': 'Nord-Nord-Ouest'
        };
        // Offshore = vent de terre (E,NE,SE sector pour facade Atlantique)
        // Onshore  = vent de mer  (W,NW,SW sector)
        // Cross    = N ou S pur
        function windQuality(dir) {
            if (!dir) return { label: '‚Äî', col: '#94a3b8', badge: 'color:#94a3b8' };
            const offshore = ['E', 'ENE', 'NE', 'ESE', 'SE', 'SSE'].includes(dir);
            const onshore = ['W', 'WNW', 'NW', 'WSW', 'SW', 'SSW'].includes(dir);
            if (offshore) return { label: 'Offshore &#127795;', col: '#4ade80', badge: 'background:rgba(74,222,128,.15);color:#4ade80;border:1px solid rgba(74,222,128,.3)' };
            if (onshore) return { label: 'Onshore &#127757;', col: '#f87171', badge: 'background:rgba(248,113,113,.15);color:#f87171;border:1px solid rgba(248,113,113,.3)' };
            return { label: 'Cross-shore', col: '#facc15', badge: 'background:rgba(250,204,21,.15);color:#facc15;border:1px solid rgba(250,204,21,.3)' };
        }

        // Fl√®che directionnelle SVG rot√©e
        function arrowSVG(deg, color) {
            return `<svg width="20" height="20" viewBox="0 0 20 20" style="transform:rotate(${deg}deg);display:inline-block">
            <polygon points="10,2 16,16 10,12 4,16" fill="${color}" opacity="0.9"/>
        </svg>`;
        }

        function buildForecasts(spot) {
            // 8 tranches de 3h sur 24h
            const slots = [];
            const now = new Date();
            now.setMinutes(0, 0, 0);
            const baseSwell = parseFloat(spot.current_swell_m) || 1.5;
            const baseWind = parseFloat(spot.wind_speed_kts) || 8;
            const basePeriod = parseFloat(spot.current_period_s) || 10;

            for (let i = 0; i < 8; i++) {
                const t = new Date(now.getTime() + i * 3 * 3600000);
                const hh = t.getHours().toString().padStart(2, '0');
                const swell = Math.max(0.3, +(baseSwell + Math.sin(i / 2.5) * 0.5 + (Math.random() * 0.3 - 0.15)).toFixed(1));
                const period = Math.max(5, Math.round(basePeriod + Math.sin(i / 3) * 1.5));
                const wind = Math.max(1, Math.round(baseWind + Math.cos(i / 2) * 3 + (Math.random() * 2 - 1)));
                const swellDir = SWELL_DIRS[Math.floor(Math.random() * 16)];
                const windDir = SWELL_DIRS[Math.floor(Math.random() * 16)];
                slots.push({ hh, swell, period, wind, swellDir, windDir });
            }

            // D√©finition des lignes
            const rows = [
                {
                    key: 'heure', label: 'Heure', icon: '&#9200;',
                    cell: s => `<div style="display:flex;flex-direction:column;align-items:center;gap:2px">
                    <span style="font-weight:900;color:#fff;font-size:1.05rem;letter-spacing:-.02em">${s.hh}h</span>
                </div>`
                },
                {
                    key: 'taille', label: 'Taille vague', icon: '&#127754;',
                    cell: s => {
                        const q = getQuality(s.swell, s.period, s.wind, s.windDir, spot.wave_type);
                        return `<div style="display:flex;flex-direction:column;align-items:center;gap:4px">
                        <span style="font-weight:900;font-size:1.6rem;color:${q.col};text-shadow:0 0 12px ${q.col}66;line-height:1">${s.swell}m</span>
                    </div>`;
                    }
                },
                {
                    key: 'qualite', label: 'Conditions', icon: '&#11088;',
                    cell: s => {
                        const q = getQuality(s.swell, s.period, s.wind, s.windDir, spot.wave_type);
                        return `<div style="display:flex;flex-direction:column;align-items:center;gap:4px">
                            <span style="display:inline-block;padding:3px 10px;border-radius:999px;font-size:9px;font-weight:900;letter-spacing:.08em;text-transform:uppercase;white-space:nowrap;${q.badge}">${q.icon} ${q.label}</span>
                            <span style="font-size:9px;color:#64748b;font-weight:700;max-width:100px;text-align:center;line-height:1.3">${q.tagline}</span>
                        </div>`;
                    }
                },
                {
                    key: 'confiance', label: 'Confiance', icon: 'üéØ',
                    cell: s => {
                        const q = getQuality(s.swell, s.period, s.wind, s.windDir, spot.wave_type);
                        const dots = Array.from({ length: 10 }, (_, i) =>
                            `<span style="width:6px;height:6px;border-radius:50%;display:inline-block;margin:0 1px;background:${i < q.confidence ? q.col : 'rgba(255,255,255,0.1)'}" title="${q.confidence}/10"></span>`
                        ).join('');
                        return `<div style="display:flex;flex-direction:column;align-items:center;gap:4px">
                            <span style="font-size:12px;font-weight:900;color:${q.col}">${q.confidence}/10</span>
                            <div style="display:flex">${dots}</div>
                        </div>`;
                    }
                },
                {
                    key: 'dir-houle', label: 'Dir. Houle', icon: '&#127757;',
                    cell: s => `<div style="display:flex;flex-direction:column;align-items:center;gap:3px">
                    ${arrowSVG(dirDeg(s.swellDir), '#00bad6')}
                    <span style="font-size:10px;font-weight:900;color:#94a3b8;letter-spacing:.1em">${s.swellDir}</span>
                </div>`
                },
                {
                    key: 'periode', label: 'Periode', icon: '&#9203;',
                    cell: s => `<div style="display:flex;flex-direction:column;align-items:center;gap:2px">
                    <span style="font-weight:900;font-size:1.1rem;color:#fff">${s.period}s</span>
                    <span style="font-size:9px;font-weight:700;color:#64748b;letter-spacing:.08em;text-transform:uppercase">${periodLabel(s.period)}</span>
                </div>`
                },
                {
                    key: 'vent', label: 'Vent', icon: '&#128168;',
                    cell: s => {
                        const wq = windQuality(s.windDir);
                        const dirLabel = DIR_FR[s.windDir] || s.windDir || '‚Äî';
                        return `<div style="display:flex;flex-direction:column;align-items:center;gap:4px">
                            ${arrowSVG(dirDeg(s.windDir), wq.col)}
                            <span style="font-size:10px;font-weight:900;color:#fff;letter-spacing:.02em">${dirLabel}</span>
                            <span style="display:inline-block;padding:2px 8px;border-radius:999px;font-size:8px;font-weight:900;letter-spacing:.08em;text-transform:uppercase;white-space:nowrap;${wq.badge}">${wq.label}</span>
                        </div>`;
                    }
                }
            ];

            const BG_DARK = 'rgba(15,33,35,0.97)';
            const BG_MID = 'rgba(15,33,35,0.92)';

            // Ligne d'en-t√™te des heures (sticky top serait id√©al mais on fixe juste le label col sticky left)
            let html = '';

            rows.forEach((row, ri) => {
                const rowBg = ri % 2 === 0 ? 'rgba(255,255,255,0.025)' : 'transparent';
                const labelBg = ri % 2 === 0 ? BG_DARK : BG_MID;
                html += `<tr style="border-bottom:1px solid rgba(255,255,255,0.05);background:${rowBg}">`;

                // Cellule label (sticky left)
                html += `<td style="position:sticky;left:0;z-index:10;background:${labelBg};padding:14px 20px;border-right:1px solid rgba(255,255,255,0.07);min-width:140px;white-space:nowrap;vertical-align:middle">
                <div style="display:flex;align-items:center;gap:8px">
                    <span style="font-size:16px;line-height:1">${row.icon}</span>
                    <span style="font-size:9px;font-weight:900;letter-spacing:.12em;color:#64748b;text-transform:uppercase">${row.label}</span>
                </div>
            </td>`;

                // Cellules donn√©es
                slots.forEach((s, si) => {
                    const isNow = si === 0;
                    const bL = isNow ? '2px solid rgba(0,186,214,0.4)' : '1px solid rgba(255,255,255,0.04)';
                    const bgC = isNow ? 'rgba(0,186,214,0.06)' : 'transparent';
                    html += `<td style="padding:14px 10px;text-align:center;border-right:1px solid rgba(255,255,255,0.04);min-width:110px;border-left:${bL};background:${bgC};vertical-align:middle">${row.cell(s)}</td>`;
                });

                html += '</tr>';
            });

            document.getElementById('forecast-table-24h').innerHTML = html;

            // Grille 7J et 16J
            build7DayForecast(spot);
            build16DayForecast(spot);
        }

        function build7DayForecast(spot) {
            // 7 jours x 3 cr√©neaux = 21 colonnes
            const DAY_NAMES = ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'];
            const MONTH_NAMES = ['Jan', 'F√©v', 'Mar', 'Avr', 'Mai', 'Jun', 'Jul', 'Ao√ª', 'Sep', 'Oct', 'Nov', 'D√©c'];
            const SLOTS_LABELS = ['Matin', 'Apr√®s-midi', 'Soir'];
            const SLOTS_HOURS = ['09h', '14h', '19h'];

            const baseSwell = parseFloat(spot.current_swell_m) || 1.5;
            const baseWind = parseFloat(spot.wind_speed_kts) || 8;
            const basePeriod = parseFloat(spot.current_period_s) || 10;

            // Construire les cellules : 7 jours x 3 slots = 21
            const cols = [];
            for (let day = 0; day < 7; day++) {
                const d = new Date();
                d.setDate(d.getDate() + day);
                for (let slot = 0; slot < 3; slot++) {
                    const phase = day * 3 + slot;
                    const swell = Math.max(0.3, +(baseSwell + Math.sin(phase / 2.8) * 0.7 + (Math.random() * 0.4 - 0.2)).toFixed(1));
                    const period = Math.max(5, Math.round(basePeriod + Math.sin(phase / 4) * 2));
                    const wind = Math.max(1, Math.round(baseWind + Math.cos(phase / 3) * 4 + (Math.random() * 2 - 1)));
                    const swellDir = SWELL_DIRS[Math.floor(Math.random() * 16)];
                    const windDir = SWELL_DIRS[Math.floor(Math.random() * 16)];
                    cols.push({ day, slot, d, swell, period, wind, swellDir, windDir });
                }
            }

            // M√™me logique de rendu que 24h
            const rows = [
                {
                    key: 'jour', label: 'Jour', icon: '&#128197;',
                    cell: c => {
                        const isFirstSlot = c.slot === 0;
                        const dayStr = `${DAY_NAMES[c.d.getDay()]} ${c.d.getDate()} ${MONTH_NAMES[c.d.getMonth()]}`;
                        return `<div style="display:flex;flex-direction:column;align-items:center;gap:2px">
                            <span style="font-weight:900;color:${isFirstSlot ? '#00bad6' : '#94a3b8'};font-size:10px;letter-spacing:.05em">${isFirstSlot ? dayStr : ''}</span>
                            <span style="font-size:11px;font-weight:900;color:#fff">${SLOTS_HOURS[c.slot]}</span>
                            <span style="font-size:8px;color:#475569;font-weight:700;text-transform:uppercase;letter-spacing:.08em">${SLOTS_LABELS[c.slot]}</span>
                        </div>`;
                    }
                },
                {
                    key: 'taille', label: 'Taille vague', icon: '&#127754;',
                    cell: c => {
                        const q = getQuality(c.swell, c.period, c.wind, c.windDir, spot.wave_type);
                        return `<span style="font-weight:900;font-size:1.4rem;color:${q.col};text-shadow:0 0 10px ${q.col}55;line-height:1">${c.swell}m</span>`;
                    }
                },
                {
                    key: 'qualite', label: 'Conditions', icon: '&#11088;',
                    cell: c => {
                        const q = getQuality(c.swell, c.period, c.wind, c.windDir, spot.wave_type);
                        return `<div style="display:flex;flex-direction:column;align-items:center;gap:3px">
                            <span style="display:inline-block;padding:2px 8px;border-radius:999px;font-size:8px;font-weight:900;letter-spacing:.08em;text-transform:uppercase;white-space:nowrap;${q.badge}">${q.icon} ${q.label}</span>
                            <span style="font-size:8px;color:#475569;font-weight:700;text-align:center;line-height:1.2;max-width:80px">${q.tagline}</span>
                        </div>`;
                    }
                },
                {
                    key: 'confiance', label: 'Confiance', icon: '&#127919;',
                    cell: c => {
                        const q = getQuality(c.swell, c.period, c.wind, c.windDir, spot.wave_type);
                        const dots = Array.from({ length: 10 }, (_, i) => `<span style="width:5px;height:5px;border-radius:50%;display:inline-block;margin:0 1px;background:${i < q.confidence ? q.col : 'rgba(255,255,255,0.1)'}"></span>`).join('');
                        return `<div style="display:flex;flex-direction:column;align-items:center;gap:3px">
                            <span style="font-size:11px;font-weight:900;color:${q.col}">${q.confidence}/10</span>
                            <div style="display:flex">${dots}</div>
                        </div>`;
                    }
                },
                {
                    key: 'dir-houle', label: 'Dir. Houle', icon: '&#127757;',
                    cell: c => `<div style="display:flex;flex-direction:column;align-items:center;gap:2px">
                        ${arrowSVG(dirDeg(c.swellDir), '#00bad6')}
                        <span style="font-size:9px;font-weight:900;color:#94a3b8;letter-spacing:.08em">${c.swellDir}</span>
                    </div>`
                },
                {
                    key: 'periode', label: 'P√©riode', icon: '&#9203;',
                    cell: c => `<div style="display:flex;flex-direction:column;align-items:center;gap:1px">
                        <span style="font-weight:900;font-size:1rem;color:#fff">${c.period}s</span>
                        <span style="font-size:8px;font-weight:700;color:#64748b;text-transform:uppercase;letter-spacing:.08em">${periodLabel(c.period)}</span>
                    </div>`
                },
                {
                    key: 'vent', label: 'Vent', icon: '&#128168;',
                    cell: c => {
                        const wq = windQuality(c.windDir);
                        const dirLabel = DIR_FR[c.windDir] || c.windDir || '‚Äî';
                        return `<div style="display:flex;flex-direction:column;align-items:center;gap:3px">
                            ${arrowSVG(dirDeg(c.windDir), wq.col)}
                            <span style="font-size:10px;font-weight:900;color:#fff;letter-spacing:.02em">${dirLabel}</span>
                            <span style="display:inline-block;padding:2px 7px;border-radius:999px;font-size:7px;font-weight:900;letter-spacing:.08em;text-transform:uppercase;white-space:nowrap;${wq.badge}">${wq.label}</span>
                        </div>`;
                    }
                }
            ];

            const BG_DARK = 'rgba(15,33,35,0.97)';
            const BG_MID = 'rgba(15,33,35,0.92)';
            let html = '';

            rows.forEach((row, ri) => {
                const rowBg = ri % 2 === 0 ? 'rgba(255,255,255,0.025)' : 'transparent';
                const labelBg = ri % 2 === 0 ? BG_DARK : BG_MID;
                html += `<tr style="border-bottom:1px solid rgba(255,255,255,0.05);background:${rowBg}">`;
                html += `<td style="position:sticky;left:0;z-index:10;background:${labelBg};padding:12px 16px;border-right:1px solid rgba(255,255,255,0.07);min-width:130px;white-space:nowrap;vertical-align:middle">
                    <div style="display:flex;align-items:center;gap:8px">
                        <span style="font-size:14px;line-height:1">${row.icon}</span>
                        <span style="font-size:9px;font-weight:900;letter-spacing:.12em;color:#64748b;text-transform:uppercase">${row.label}</span>
                    </div>
                </td>`;
                cols.forEach((c, ci) => {
                    // S√©parateur de jour (chaque 3e colonne)
                    const isNewDay = c.slot === 0 && ci > 0;
                    const isToday = c.day === 0 && c.slot === 0;
                    const bL = isNewDay ? '2px solid rgba(255,255,255,0.08)' : (isToday ? '2px solid rgba(0,186,214,0.35)' : '1px solid rgba(255,255,255,0.04)');
                    const bgC = c.day % 2 === 0 ? 'rgba(255,255,255,0.01)' : 'transparent';
                    html += `<td style="padding:12px 8px;text-align:center;border-right:1px solid rgba(255,255,255,0.03);min-width:90px;border-left:${bL};background:${bgC};vertical-align:middle">${row.cell(c)}</td>`;
                });
                html += '</tr>';
            });

            document.getElementById('forecast-table-7d').innerHTML = html;
        }

        function build16DayForecast(spot) {
            const grid = document.getElementById('grid-16d');
            if (!grid) return;
            const days = ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'];
            const months = ['Jan', 'Fev', 'Mar', 'Avr', 'Mai', 'Jun', 'Jul', 'Aou', 'Sep', 'Oct', 'Nov', 'Dec'];
            const base = parseFloat(spot.current_swell_m) || 1.5;
            const cards = [];
            for (let i = 0; i < 16; i++) {
                const d = new Date(); d.setDate(d.getDate() + i);
                const swellD = Math.max(0.3, +(base + Math.sin(i / 3) * 0.8 + Math.random() * 0.6 - 0.3).toFixed(1));
                const windD = Math.max(1, Math.round(8 + Math.cos(i / 4) * 5 + Math.random() * 3));
                const periodD = Math.max(5, Math.round(10 + Math.sin(i / 4) * 2));
                const wDirD = SWELL_DIRS[Math.floor(Math.random() * 16)];
                const q = getQuality(swellD, periodD, windD, wDirD, spot.wave_type);
                const isToday = i === 0;
                cards.push(`<div style="display:flex;flex-direction:column;align-items:center;gap:5px;padding:12px 8px;border-radius:12px;background:${isToday ? 'rgba(0,186,214,0.08)' : 'rgba(255,255,255,0.04)'};border:1px solid ${isToday ? 'rgba(0,186,214,0.3)' : 'rgba(255,255,255,0.06)'};cursor:default">
                    <span style="font-size:9px;font-weight:900;color:${isToday ? '#00bad6' : '#64748b'};text-transform:uppercase;letter-spacing:.1em">${isToday ? 'Auj.' : days[d.getDay()]}</span>
                    <span style="font-size:8px;color:#475569">${d.getDate()} ${months[d.getMonth()]}</span>
                    <div style="width:8px;height:8px;border-radius:50%;background:${q.col};box-shadow:0 0 6px ${q.col}55;margin:1px 0"></div>
                    <span style="font-weight:900;font-size:1.1rem;color:#fff">${swellD}m</span>
                    <span style="font-size:8px;font-weight:900;color:${q.col};text-transform:uppercase">${q.icon} ${q.label}</span>
                    <span style="font-size:7px;color:#475569">${windD}kt ¬∑ ${q.confidence}/10</span>
                </div>`);
            }
            grid.innerHTML = cards.join('');
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // TABS
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function isPremium() {
            try { const u = JSON.parse(localStorage.getItem('swellsync_user') || '{}'); return u.role === 'premium' || u.role === 'admin'; }
            catch { return false; }
        }

        function switchForecast(tab) {
            const ALL_TABS = ['24h', '7d', '16d'];
            const ALL_BLOCKS = ['forecast-24h', 'forecast-7d', 'forecast-16d'];

            // D√©sactiver tous
            ALL_TABS.forEach(t => {
                const el = document.getElementById('tab-' + t);
                if (el) { el.classList.remove('active'); el.style.borderColor = ''; el.style.color = ''; }
            });
            ALL_BLOCKS.forEach(b => {
                const el = document.getElementById(b);
                if (el) el.classList.add('hidden');
            });

            // Activer le bon
            const activeTab = document.getElementById('tab-' + tab);
            const activeBlock = document.getElementById('forecast-' + tab);
            if (activeTab) activeTab.classList.add('active');
            if (activeBlock) activeBlock.classList.remove('hidden');

            // Logique premium pour 16d
            if (tab === '16d') {
                const lk = document.getElementById('forecast-16d-locked');
                const ul = document.getElementById('forecast-16d-unlocked');
                if (isPremium()) { lk.classList.add('hidden'); ul.classList.remove('hidden'); }
                else { lk.classList.remove('hidden'); ul.classList.add('hidden'); }
            }
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // UTILITAIRES GLOBAUX
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

        // Table directions FR (accessible partout dans le script)
        const DIR_FR_GLOBAL = {
            'N': 'Nord', 'NNE': 'Nord-Nord-Est', 'NE': 'Nord-Est', 'ENE': 'Est-Nord-Est',
            'E': 'Est', 'ESE': 'Est-Sud-Est', 'SE': 'Sud-Est', 'SSE': 'Sud-Sud-Est',
            'S': 'Sud', 'SSW': 'Sud-Sud-Ouest', 'SW': 'Sud-Ouest', 'WSW': 'Ouest-Sud-Ouest',
            'W': 'Ouest', 'WNW': 'Ouest-Nord-Ouest', 'NW': 'Nord-Ouest', 'NNW': 'Nord-Nord-Ouest'
        };

        // Mar√©es dynamiques ‚Äî cycle semi-diurne ~6h14min
        function computeTides() {
            const now = new Date();
            const h = now.getHours();
            const m = now.getMinutes();
            const totalMin = h * 60 + m;
            const cycleMin = 374; // ~6h14min demi-cycle
            const phaseMin = totalMin % (cycleMin * 2);
            const isMontante = phaseMin < cycleMin;

            // Prochain haut et bas
            const minutesToNextHigh = isMontante ? (cycleMin - phaseMin) : (cycleMin * 2 - phaseMin);
            const minutesToNextLow = isMontante ? (cycleMin * 2 - phaseMin) : (cycleMin - phaseMin);

            const fmt = (min) => {
                const t = new Date(now.getTime() + min * 60000);
                return t.getHours().toString().padStart(2, '0') + 'h' + t.getMinutes().toString().padStart(2, '0');
            };

            // Etale = dans les 20 min du sommet/creux
            const isEtale = (phaseMin < 20 || Math.abs(phaseMin - cycleMin) < 20);
            let label;
            if (isEtale) label = phaseMin < cycleMin ? '√âtale Haute' : '√âtale Basse';
            else label = isMontante ? 'Montante ‚Üë' : 'Descendante ‚Üì';

            return { label, nextHigh: fmt(minutesToNextHigh), nextLow: fmt(minutesToNextLow) };
        }

        // Temp√©ratures r√©alistes par r√©gion
        function getRegionTemps(spot) {
            const loc = (spot.location || spot.region || spot.name || '').toLowerCase();
            const month = new Date().getMonth(); // 0-11
            const isSummer = month >= 5 && month <= 8;
            const isWinter = month <= 1 || month >= 10;

            if (loc.includes('bretagne') || loc.includes('finist√®re') || loc.includes('morbihan') || loc.includes('torche') || loc.includes('palue')) {
                return { air: isSummer ? 19 : isWinter ? 8 : 13, water: isSummer ? 17 : isWinter ? 10 : 13 };
            } else if (loc.includes('basque') || loc.includes('biarritz') || loc.includes('hossegor') || loc.includes('capbreton') || loc.includes('anglet') || loc.includes('hendaye') || loc.includes('bidart')) {
                return { air: isSummer ? 26 : isWinter ? 12 : 17, water: isSummer ? 21 : isWinter ? 13 : 16 };
            } else if (loc.includes('landes') || loc.includes('biscarrosse') || loc.includes('mimizan') || loc.includes('lacanau') || loc.includes('seignosse')) {
                return { air: isSummer ? 28 : isWinter ? 10 : 16, water: isSummer ? 20 : isWinter ? 12 : 15 };
            } else if (loc.includes('vend√©e') || loc.includes('sables') || loc.includes('sauzaie')) {
                return { air: isSummer ? 22 : isWinter ? 9 : 14, water: isSummer ? 18 : isWinter ? 11 : 14 };
            } else if (loc.includes('√Æle') || loc.includes('r√©') || loc.includes('ol√©ron')) {
                return { air: isSummer ? 24 : isWinter ? 9 : 15, water: isSummer ? 19 : isWinter ? 11 : 14 };
            }
            // D√©faut Atlantique France
            return { air: isSummer ? 22 : isWinter ? 10 : 14, water: isSummer ? 19 : isWinter ? 12 : 14 };
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // WIDGET M√âT√âO
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function buildMeteoWidget(spot) {
            const temps = getRegionTemps(spot);
            // Conditions m√©t√©o bas√©es sur l'heure + swell (grosse houle = souvent nuageux)
            const swell = parseFloat(spot.current_swell_m) || 1.5;
            const hour = new Date().getHours();
            const month = new Date().getMonth();
            const isRainyMonth = [10, 11, 0, 1].includes(month); // Oct‚ÜíF√©v = plus pluvieux

            // S√©lection bas√©e sur swell strength et saison
            let cond;
            if (swell > 3.0 || isRainyMonth) {
                cond = { emoji: 'üåßÔ∏è', label: 'Perturb√©', sub: 'Front pluvieux ¬∑ Vagues de temp√™te', visi: '3‚Äì5km' };
            } else if (swell > 2.0) {
                cond = { emoji: '‚õÖ', label: 'Partiellement nuageux', sub: 'Vent fort ¬∑ Vagues puissantes', visi: '8km' };
            } else if (hour < 9) {
                cond = { emoji: 'üå´Ô∏è', label: 'Brume matinale', sub: 'L√©g√®re brume ¬∑ Am√©lioration attendue', visi: '2‚Äì4km' };
            } else if (month >= 5 && month <= 8) {
                cond = { emoji: '‚òÄÔ∏è', label: 'Ensoleill√©', sub: 'Beau temps ¬∑ Session parfaite !', visi: '>10km' };
            } else {
                cond = { emoji: 'üå§Ô∏è', label: 'Voil√©', sub: 'Conditions correctes ¬∑ Sortez surfer !', visi: '6‚Äì8km' };
            }

            const el = id => document.getElementById(id);
            if (el('meteo-emoji')) el('meteo-emoji').innerHTML = cond.emoji;
            if (el('meteo-label')) el('meteo-label').textContent = cond.label;
            if (el('meteo-sub')) el('meteo-sub').textContent = cond.sub;
            if (el('meteo-temp')) el('meteo-temp').textContent = temps.air + '¬∞C';
            if (el('meteo-water')) el('meteo-water').textContent = temps.water + '¬∞C';
            if (el('meteo-visi')) el('meteo-visi').textContent = cond.visi;
            if (el('meteo-icon-box')) el('meteo-icon-box').innerHTML = cond.emoji;
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // WIDGET AFFLUENCE
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function buildCrowdWidget(spot) {
            const hour = new Date().getHours();
            // Rush hours : 10-13h et 14-17h weekend, moins en semaine
            const isWeekend = [0, 6].includes(new Date().getDay());
            let crowdPct, crowdLabel, crowdCount, crowdColor, tipMsg;

            if (hour < 7 || hour > 20) {
                crowdPct = 5; crowdLabel = 'D√©sert'; crowdCount = '~0-2 surfeurs'; crowdColor = '#4ade80';
                tipMsg = 'Session cr√©pusculaire ou nocturne ‚Äî vous serez seul(e) !';
            } else if (hour < 9) {
                crowdPct = 15; crowdLabel = 'Calme'; crowdCount = '~3-8 surfeurs'; crowdColor = '#4ade80';
                tipMsg = 'Meilleur moment ! Eau et vagues pour vous seul(e).';
            } else if (hour >= 10 && hour <= 13 && isWeekend) {
                crowdPct = 75; crowdLabel = 'Charg√©'; crowdCount = '~30-50 surfeurs'; crowdColor = '#f87171';
                tipMsg = 'Week-end charg√©. Pr√©f√©rez <strong class="text-white">6h‚Äì8h</strong> ou <strong class="text-white">17h‚Äì19h</strong>.';
            } else if (hour >= 10 && hour <= 16) {
                crowdPct = isWeekend ? 70 : 40;
                crowdLabel = isWeekend ? 'Charg√©' : 'Anim√©';
                crowdCount = isWeekend ? '~25-40 surfeurs' : '~10-20 surfeurs';
                crowdColor = isWeekend ? '#f87171' : '#facc15';
                tipMsg = isWeekend ? 'Allez-y t√¥t le matin !' : 'Affluence mod√©r√©e, profitez bien.';
            } else {
                crowdPct = 30; crowdLabel = 'Tranquille'; crowdCount = '~8-15 surfeurs'; crowdColor = '#facc15';
                tipMsg = 'Bon cr√©neau ‚Äî la foule se disperse le soir.';
            }

            const el = id => document.getElementById(id);
            if (el('crowd-label')) { el('crowd-label').textContent = crowdLabel; el('crowd-label').style.color = crowdColor; }
            if (el('crowd-count')) el('crowd-count').textContent = crowdCount;
            if (el('crowd-bar')) { el('crowd-bar').style.width = crowdPct + '%'; el('crowd-bar').style.background = crowdColor; }
            if (el('crowd-tip')) el('crowd-tip').innerHTML = tipMsg;

            // Ic√¥nes surfeurs
            const filled = Math.round(crowdPct / 20); // 0-5
            for (let i = 1; i <= 5; i++) {
                const dot = el('crowd-dot-' + i);
                if (dot) dot.style.opacity = i <= filled ? '1' : '0.15';
            }
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // WIDGET NIVEAU REQUIS
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function buildLevelWidget(spot) {
            const swell = parseFloat(spot.current_swell_m) || 1.5;
            let level, emoji, col, bg, border, desc;

            if (swell < 0.5) {
                level = 'D√©butant'; emoji = '&#128104;&#127995;&#8205;&#127988;'; col = '#4ade80';
                bg = 'rgba(74,222,128,0.1)'; border = 'rgba(74,222,128,0.3)';
                desc = 'Vagues tr√®s calmes, id√©al pour apprendre. Longboard recommand√©.';
            } else if (swell < 1.2) {
                level = 'D√©butant +'; emoji = '&#128104;&#127995;&#8205;&#127988;'; col = '#4ade80';
                bg = 'rgba(74,222,128,0.1)'; border = 'rgba(74,222,128,0.3)';
                desc = 'Bonnes conditions pour progresser. Ma√Ætrisez la rame et le take-off.';
            } else if (swell < 2.0) {
                level = 'Interm√©diaire'; emoji = '&#127940;&#65039;'; col = '#00bad6';
                bg = 'rgba(0,186,214,0.1)'; border = 'rgba(0,186,214,0.3)';
                desc = 'Houle r√©guli√®re, vagues propres. Ma√Ætrise du d√©part et des virages requise.';
            } else if (swell < 2.8) {
                level = 'Avanc√©'; emoji = '&#9889;'; col = '#facc15';
                bg = 'rgba(250,204,21,0.1)'; border = 'rgba(250,204,21,0.3)';
                desc = 'Vagues puissantes. Exp√©rience du tube et de la vitesse n√©cessaire.';
            } else {
                level = 'Expert'; emoji = '&#128293;'; col = '#f87171';
                bg = 'rgba(248,113,113,0.1)'; border = 'rgba(248,113,113,0.3)';
                desc = 'Conditions dangereuses pour non-initi√©s. Surfeurs aguerris uniquement.';
            }

            const el = id => document.getElementById(id);
            if (el('level-label')) { el('level-label').textContent = level; el('level-label').style.color = col; }
            if (el('level-emoji')) el('level-emoji').innerHTML = emoji;
            if (el('level-badge')) { el('level-badge').style.background = bg; el('level-badge').style.borderColor = border; }
            if (el('level-desc')) el('level-desc').textContent = desc;

            // Barre de niveaux
            const levelIdx = swell < 0.5 ? 0 : swell < 1.2 ? 1 : swell < 2.0 ? 2 : swell < 2.8 ? 3 : 4;
            const lvlCols = ['#4ade80', '#00bad6', '#facc15', '#f87171'];
            for (let i = 1; i <= 4; i++) {
                const bar = el('lvl-' + i);
                if (!bar) continue;
                const div = bar.querySelector('div');
                const span = bar.querySelector('span');
                const active = i <= Math.ceil((levelIdx + 1));
                if (div) {
                    div.style.background = active ? lvlCols[Math.min(i - 1, 3)] : 'rgba(255,255,255,0.08)';
                    div.style.boxShadow = active ? `0 0 6px ${lvlCols[Math.min(i - 1, 3)]}60` : 'none';
                }
                if (span) span.style.color = active ? lvlCols[Math.min(i - 1, 3)] : '#475569';
            }
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // WIDGET √âQUIPEMENT
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function buildGearWidget(spot) {
            const swell = parseFloat(spot.current_swell_m) || 1.5;
            const wind = parseFloat(spot.wind_speed_kts) || 8;
            // Temp√©rature eau r√©gionale (plus de valeur hardcod√©e)
            const water = getRegionTemps(spot).water;

            // Combinaison ‚Äî adapt√©e √† la temp√©rature eau r√©elle
            const combi = water < 12
                ? { icon: '&#129399;', name: 'Combi 5/4mm', desc: `Eau froide ~${water}¬∞C ¬∑ capuche & gants`, col: '#60a5fa', bg: 'rgba(96,165,250,0.1)', border: 'rgba(96,165,250,0.2)' }
                : water < 16
                    ? { icon: '&#129399;', name: 'Combi 4/3mm', desc: `Eau fra√Æche ~${water}¬∞C ¬∑ standard`, col: '#00bad6', bg: 'rgba(0,186,214,0.1)', border: 'rgba(0,186,214,0.2)' }
                    : water < 20
                        ? { icon: '&#129399;', name: 'Combi 3/2mm', desc: `Eau temp√©r√©e ~${water}¬∞C`, col: '#4ade80', bg: 'rgba(74,222,128,0.1)', border: 'rgba(74,222,128,0.2)' }
                        : { icon: '&#9961;&#65039;', name: 'Short √©lastique', desc: `Eau chaude ~${water}¬∞C ¬∑ topless ok`, col: '#facc15', bg: 'rgba(250,204,21,0.1)', border: 'rgba(250,204,21,0.2)' };

            // Planche
            const board = swell > 2.5
                ? { icon: '&#127940;&#65039;', name: 'Gun 7\'0+', desc: 'Grosses vagues', col: '#f87171', bg: 'rgba(248,113,113,0.1)', border: 'rgba(248,113,113,0.2)' }
                : swell > 1.5
                    ? { icon: '&#127940;&#65039;', name: 'Shortboard 6\'2', desc: 'Vagues propres', col: '#facc15', bg: 'rgba(250,204,21,0.1)', border: 'rgba(250,204,21,0.2)' }
                    : swell > 0.8
                        ? { icon: '&#127940;&#65039;', name: 'Funboard 7\'2', desc: 'Passe-partout', col: '#00bad6', bg: 'rgba(0,186,214,0.1)', border: 'rgba(0,186,214,0.2)' }
                        : { icon: '&#127940;&#65039;', name: 'Longboard 9\'0', desc: 'Vagues molles', col: '#4ade80', bg: 'rgba(74,222,128,0.1)', border: 'rgba(74,222,128,0.2)' };

            // Wax ‚Äî adapt√© √† la temp r√©elle
            const wax = water < 14
                ? { icon: '&#129424;', name: 'Wax Froide', desc: `Eau < 14¬∞C ¬∑ formule hiver`, col: '#60a5fa', bg: 'rgba(96,165,250,0.1)', border: 'rgba(96,165,250,0.2)' }
                : water < 20
                    ? { icon: '&#129424;', name: 'Wax Fra√Æche', desc: `Eau ${water}¬∞C ¬∑ printemps/automne`, col: '#a78bfa', bg: 'rgba(167,139,250,0.1)', border: 'rgba(167,139,250,0.2)' }
                    : { icon: '&#129424;', name: 'Wax Tropical', desc: `Eau > 20¬∞C ¬∑ formule √©t√©`, col: '#f97316', bg: 'rgba(249,115,22,0.1)', border: 'rgba(249,115,22,0.2)' };

            // Leash
            const leash = swell > 2.0
                ? { icon: '&#128279;', name: 'Leash 9mm', desc: 'Obligatoire grosses vagues', col: '#f87171', bg: 'rgba(248,113,113,0.1)', border: 'rgba(248,113,113,0.2)' }
                : { icon: '&#128279;', name: 'Leash 6mm', desc: 'Houle normale', col: '#94a3b8', bg: 'rgba(148,163,184,0.1)', border: 'rgba(148,163,184,0.2)' };

            const items = [combi, board, wax, leash];
            const grid = document.getElementById('gear-grid');
            if (!grid) return;
            grid.innerHTML = items.map(it => `
                <div class="flex items-center gap-3 p-3 rounded-xl border" style="background:${it.bg};border-color:${it.border}">
                    <span class="text-2xl">${it.icon}</span>
                    <div>
                        <p class="font-black text-white text-xs">${it.name}</p>
                        <p class="text-[10px] font-bold" style="color:${it.col}">${it.desc}</p>
                    </div>
                </div>`).join('');

            const tip = document.getElementById('gear-tip');
            if (tip) tip.innerText = `"Avec ${swell}m de houle et ${water}¬∞C d'eau, une ${combi.name} et un ${board.name} sont id√©aux pour cette session."`;
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // WIDGET CHECK-LIST
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function buildChecklistWidget(spot) {
            const swell = parseFloat(spot.current_swell_m) || 1.5;
            const wType = (spot.wave_type || '').toUpperCase();
            const isReef = wType.includes('REEF');
            const month = new Date().getMonth();
            const isSummer = month >= 5 && month <= 8;

            const baseItems = [
                { emoji: 'üßÉ', label: 'Hydratation', desc: 'Buvez avant de partir', ok: true },
                { emoji: '‚òÄÔ∏è', label: 'Cr√®me solaire', desc: 'Indice 50+ waterproof', ok: isSummer },
                { emoji: 'üîó', label: 'Leash v√©rifi√©', desc: 'V√©rifiez les attaches & Velcro', ok: true },
                { emoji: 'üß≤', label: 'Wax fra√Æche', desc: 'Planche bien wax√©e', ok: true },
                { emoji: 'üèä', label: '√âchauffement', desc: '10 min d\'√©tirements', ok: false },
                { emoji: 'üìä', label: 'Mar√©es v√©rifi√©es', desc: computeTides().label + ' actuellement', ok: true },
            ];

            if (swell > 2.0) baseItems.push(
                { emoji: 'üöó', label: 'Buddy syst√®me', desc: 'Ne surfez pas seul(e) !', ok: false }
            );
            if (isReef) baseItems.push(
                { emoji: 'ü¶∫', label: 'Reef boots', desc: 'Obligatoire sur r√©cif', ok: false }
            );
            if (swell < 12) baseItems.push(
                { emoji: 'ü¶ª', label: 'Bouchons oreilles', desc: 'Eau froide ‚Äî exostose', ok: true }
            );

            const grid = document.getElementById('checklist-grid');
            if (!grid) return;
            grid.innerHTML = baseItems.map(it => `
                <div style="display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:12px;border:1px solid ${it.ok ? 'rgba(74,222,128,.2)' : 'rgba(250,204,21,.2)'};background:${it.ok ? 'rgba(74,222,128,.04)' : 'rgba(250,204,21,.04)'};transition:transform .2s;cursor:default"
                    onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                    <span style="font-size:1.2rem;flex-shrink:0">${it.emoji}</span>
                    <div style="min-width:0;flex:1">
                        <p style="font-size:11px;font-weight:900;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${it.label}</p>
                        <p style="font-size:9px;font-weight:700;color:${it.ok ? '#4ade80' : '#facc15'};white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${it.desc}</p>
                    </div>
                    <span style="flex-shrink:0;font-size:1rem">${it.ok ? '‚úÖ' : '‚ö†Ô∏è'}</span>
                </div>`).join('');

            // Verdict dynamique check-list
            const verdicts = {
                'Temp√™te': { col: '#dc2626', msg: '‚õî Conditions de temp√™te ‚Äî Ne sortez pas sans exp√©rience extr√™me eau libre.' },
                '√âpique': { col: '#a855f7', msg: 'üèÜ Conditions exceptionnelles ‚Äî V√©rifiez tout, sortez avec un buddy.' },
                'Excellent': { col: '#00bad6', msg: '‚≠ê Session de r√™ve ‚Äî Tout est au vert, profitez !' },
                'Bon': { col: '#4ade80', msg: '‚úÖ Bonnes conditions ‚Äî Session recommand√©e pour tous niveaux.' },
                'Moyen': { col: '#f97316', msg: '„Ä∞Ô∏è Conditions moyennes ‚Äî Parfait pour progresser √† votre rythme.' },
                'Plat': { col: '#64748b', msg: 'üí§ Mer plate ‚Äî Journ√©e yoga ou bodyboard dans le shore break.' },
            };
            const qual = getQuality(swell, 10, 8, 'E', spot.wave_type || 'BEACH BREAK');
            const v = verdicts[qual.label] || { col: '#94a3b8', msg: 'üëå ' + qual.tagline };
            const verdictEl = document.querySelector('#checklist-grid + div p');
            if (verdictEl) {
                verdictEl.textContent = v.msg;
                verdictEl.style.color = v.col;
                const parentDiv = verdictEl.closest('div');
                if (parentDiv) {
                    parentDiv.style.borderColor = v.col + '30';
                    parentDiv.style.background = v.col + '08';
                }
            }
        }

        // Appel group√© depuis renderSpot
        function buildSmartWidgets(spot) {
            buildMeteoWidget(spot);
            buildCrowdWidget(spot);
            buildLevelWidget(spot);
            buildGearWidget(spot);
            buildChecklistWidget(spot);
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // FAVORI ‚Äî Bouton h√©ro spot_detail
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // ALERTE CAM√âRA
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function toggleCamAlert() {
            const spotId = window.currentSpotId ? String(window.currentSpotId) : 'unknown';
            const key = 'swellsync_cam_alerts';
            let alerts = [];
            try { alerts = JSON.parse(localStorage.getItem(key) || '[]'); } catch (e) { alerts = []; }

            const btn = document.getElementById('btn-cam-alert');
            const lbl = document.getElementById('cam-alert-label');
            const isActive = alerts.includes(spotId);

            if (isActive) {
                alerts = alerts.filter(id => id !== spotId);
                if (lbl) lbl.textContent = "M'alerter √† l'ouverture";
                if (btn) { btn.style.background = ''; btn.style.color = ''; btn.style.borderColor = ''; }
                if (typeof Toast !== 'undefined') Toast.show('Alerte cam√©ra d√©sactiv√©e.', 'info');
            } else {
                alerts.push(spotId);
                if (lbl) lbl.textContent = 'Alerte activ√©e ‚úì';
                if (btn) { btn.style.background = 'rgba(0,186,214,0.15)'; btn.style.color = '#00bad6'; btn.style.borderColor = 'rgba(0,186,214,0.4)'; }
                if (typeof Toast !== 'undefined') Toast.show('üîî Vous serez alert√© d√®s que la cam√©ra sera disponible !', 'success');
            }
            localStorage.setItem(key, JSON.stringify(alerts));
        }

        // Initialiser l'√©tat du bouton alerte cam au chargement
        function initCamAlertBtn() {
            const spotId = window.currentSpotId ? String(window.currentSpotId) : 'unknown';
            const alerts = JSON.parse(localStorage.getItem('swellsync_cam_alerts') || '[]');
            const btn = document.getElementById('btn-cam-alert');
            const lbl = document.getElementById('cam-alert-label');
            if (alerts.includes(spotId)) {
                if (lbl) lbl.textContent = 'Alerte activ√©e ‚úì';
                if (btn) { btn.style.background = 'rgba(0,186,214,0.15)'; btn.style.color = '#00bad6'; btn.style.borderColor = 'rgba(0,186,214,0.4)'; }
            }
            // Mettre √† jour le lien "Voir les 60 webcams" avec l'ID du spot
            const allCamsLink = document.getElementById('btn-all-webcams');
            if (allCamsLink && window.currentSpotId) {
                allCamsLink.href = 'https://gosurf.fr/list';
            }
        }

        function openCamFullscreen() {
            const spotId = window.currentSpotId;
            window.open('https://gosurf.fr/list', '_blank');
        }

        function handleSpotDetailFavorite() {
            const spotId = currentSpotId ? String(currentSpotId) : null;
            if (!spotId) return;
            // R√©cup√©rer les infos spot depuis le DOM
            const name = document.getElementById('hero-spot-name')?.textContent || spotId;
            const location = document.getElementById('hero-location')?.textContent || '';

            // ‚îÄ‚îÄ Tenter d'utiliser l'API si connect√©
            const saved = localStorage.getItem('swellsync_user');
            if (saved) {
                const user = JSON.parse(saved);
                // Appel API pour ajouter ou retirer le favori
                const isFavBtn = document.getElementById('fav-hero-icon')?.classList.contains('fa-solid');
                if (isFavBtn) {
                    // Retirer
                    fetch('/api/members/favorites/' + spotId, { method: 'DELETE', credentials: 'include' })
                        .then(r => { if (r.ok) updateFavoriteHeroButton(spotId, false); })
                        .catch(() => localToggleFavorite(spotId, name, location));
                } else {
                    // Ajouter
                    fetch('/api/members/favorites', {
                        method: 'POST', credentials: 'include',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ spot_id: parseInt(spotId) })
                    }).then(r => { if (r.ok) updateFavoriteHeroButton(spotId, true); })
                        .catch(() => localToggleFavorite(spotId, name, location));
                }
            } else {
                if (typeof Toast !== 'undefined') {
                    Toast.show('Connecte-toi pour sauvegarder des favoris ‚ù§Ô∏è', 'info');
                    setTimeout(() => typeof openAuthModal !== 'undefined' && openAuthModal(), 800);
                }
            }
        }

        // Fallback localStorage pour session hors-ligne
        function localToggleFavorite(spotId, name, location) {
            const savedUser = localStorage.getItem('swellsync_user');
            if (!savedUser) return;
            const user = JSON.parse(savedUser);
            let favorites = user.favorites || [];
            const idx = favorites.findIndex(f => String(f.id) === String(spotId));
            if (idx >= 0) { favorites.splice(idx, 1); updateFavoriteHeroButton(spotId, false); }
            else { favorites.push({ id: String(spotId), name, location }); updateFavoriteHeroButton(spotId, true); }
            user.favorites = favorites;
            localStorage.setItem('swellsync_user', JSON.stringify(user));
        }

        let _serverFavorites = []; // cache serveur
        async function loadServerFavorites() {
            try {
                const r = await fetch('/api/members/favorites', { credentials: 'include' });
                if (r.ok) { _serverFavorites = await r.json(); }
            } catch (e) { }
        }

        function updateFavoriteHeroButton(spotId, isFavOverride) {
            const btn = document.getElementById('btn-favorite-hero');
            const icon = document.getElementById('fav-hero-icon');
            const label = document.getElementById('fav-hero-label');
            const badge = document.getElementById('fav-limit-badge');
            const cntLbl = document.getElementById('fav-count-label');
            if (!btn || !icon) return;

            btn.dataset.spotid = spotId;

            // Utiliser la valeur forc√©e si fournie, sinon v√©rifier le cache serveur
            let isFav;
            if (typeof isFavOverride === 'boolean') {
                isFav = isFavOverride;
            } else {
                // V√©rifier dans le cache serveur d'abord
                isFav = _serverFavorites.some(f => String(f.spot_id) === String(spotId));
                if (!isFav) {
                    // Fallback localStorage
                    const savedUser = localStorage.getItem('swellsync_user');
                    if (savedUser) {
                        try { isFav = (JSON.parse(savedUser).favorites || []).some(f => String(f.id) === String(spotId)); } catch (e) { }
                    }
                }
            }

            if (isFav) {
                icon.className = 'fa-solid fa-heart text-red-500 text-lg';
                label.textContent = 'Favori ‚úì';
                label.style.color = '#f87171';
                btn.classList.add('border-red-400/40', 'bg-red-500/10');
            } else {
                icon.className = 'fa-regular fa-heart text-white/50 group-hover:text-red-400 transition-colors text-lg';
                label.textContent = 'Favori';
                label.style.color = '';
                btn.classList.remove('border-red-400/40', 'bg-red-500/10');
            }

            if (cntLbl) cntLbl.textContent = '';
            if (badge) badge.classList.add('hidden');
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // ANALYTICS ‚Äî Envoi donn√©es spot au localStorage admin
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function trackSpotConditionsAdmin(spot, swellM, windKts, windDir, periodS) {
            try {
                const now = new Date();
                const key = 'swellsync_spot_analytics';
                let logs = [];
                try { logs = JSON.parse(localStorage.getItem(key) || '[]'); } catch (e) { logs = []; }

                const entry = {
                    ts: now.toISOString(),
                    spot_id: spot.id || currentSpotId,
                    spot_name: (spot.name || '').split(',')[0].trim(),
                    location: spot.location || spot.region || '',
                    swell_m: swellM,
                    wind_kts: windKts,
                    wind_dir: windDir,
                    period_s: periodS,
                    wave_type: spot.wave_type || 'MIXTE',
                    difficulty: spot.difficulty || 'Interm√©diaire',
                    score: spot.reliability_score || null,
                    url: window.location.href,
                    user: (() => {
                        try { const u = JSON.parse(localStorage.getItem('swellsync_user') || '{}'); return u.identifier || 'Anonyme'; } catch (e) { return 'Anonyme'; }
                    })()
                };

                // Garder max 100 entr√©es
                logs.unshift(entry);
                if (logs.length > 100) logs = logs.slice(0, 100);

                localStorage.setItem(key, JSON.stringify(logs));

                // Aussi incr√©menter le compteur de vues par spot
                const viewsKey = 'swellsync_spot_views';
                let views = {};
                try { views = JSON.parse(localStorage.getItem(viewsKey) || '{}'); } catch (e) { views = {}; }
                const sid = String(entry.spot_id);
                views[sid] = (views[sid] || 0) + 1;
                localStorage.setItem(viewsKey, JSON.stringify(views));

            } catch (e) { /* Silencieux */ }
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // INIT
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        document.addEventListener('DOMContentLoaded', loadSpot);
    </script>

    <!-- Sch√©ma.org JSON-LD ‚Äî mis √† jour dynamiquement -->
    <!-- Scripts syst√®me (auth, toast, favoris) -->
    <script src="js/nav.js"></script>
    <script src="js/auth_auto.js" defer></script>
    <script src="js/i18n.js" defer></script>
    <script src="js/toast.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth_modal.js?v=1"></script>
    <script src="js/chatbot.js"></script>
    <script src="js/global_search.js"></script>

    <script type="application/ld+json" id="schema-spot">
    {
        "@context": "https://schema.org",
        "@type": "TouristAttraction",
        "name": "Spot de surf SwellSync",
        "description": "Spot de surf avec conditions en temps r√©el.",
        "url": "https://swellsync.fr/spot_detail.html",
        "provider": {
            "@type": "Organization",
            "name": "SwellSync",
            "url": "https://swellsync.fr"
        }
    }
    </script>


    <!-- User Profile Modal -->
    <div id="auth-modal-backdrop"
        class="fixed inset-0 bg-background-dark/90 backdrop-blur-md z-[110] hidden items-center justify-center p-4 md:p-8 opacity-0 transition-opacity duration-300">
        <div id="auth-modal-container"
            class="bg-background-dark border border-white/10 rounded-[2rem] w-full max-w-md relative transform scale-95 transition-transform duration-300 shadow-[0_30px_60px_rgba(0,0,0,0.5)] overflow-hidden flex flex-col items-center">

            <button onclick="closeAuthModal()"
                class="absolute top-6 right-6 w-10 h-10 bg-white/5 hover:bg-white/10 rounded-full flex items-center justify-center transition-colors text-white z-20">
                <span class="material-symbols-outlined text-lg">close</span>
            </button>

            <!-- Auth Header -->
            <div class="w-full pt-10 pb-6 px-8 flex flex-col items-center border-b border-white/5 bg-white/5">
                <div class="w-16 h-16 rounded-full bg-primary/20 flex items-center justify-center mb-4">
                    <span class="material-symbols-outlined text-primary text-3xl">lock_person</span>
                </div>
                <h3 class="text-3xl font-black text-white text-center">SwellSync<span class="text-primary">.ID</span>
                </h3>
                <p class="text-slate-400 text-sm mt-2 text-center">S√©curit√© A2F Requise (App non partag√©e)</p>
            </div>

            <!-- Auth Body -->
            <div id="auth-step-1" class="p-8 w-full flex flex-col gap-4 bg-background-dark">

                <!-- Option 1: Apple Sign In -->
                <div id="appleid-signin" onclick="triggerAppleAuth()"
                    class="w-full bg-[#111] border border-white/20 text-white font-black py-4 rounded-xl flex items-center justify-center gap-3 hover:bg-white hover:text-black transition-colors cursor-pointer">
                    <i class="fa-brands fa-apple text-xl"></i>
                    Continuer avec Apple
                </div>

                <!-- Option 2: Google Sign In -->
                <button onclick="triggerGoogleAuth()"
                    class="w-full bg-white text-black border border-white/20 font-black py-4 rounded-xl flex items-center justify-center gap-3 hover:bg-slate-200 transition-colors focus:outline-none shadow-md cursor-pointer">
                    <i class="fa-brands fa-google text-xl text-blue-500"></i>
                    Continuer avec Google
                </button>

                <div class="flex items-center gap-4 my-2 opacity-50">
                    <div class="h-px bg-white/20 flex-1"></div>
                    <span class="text-[10px] font-bold text-white uppercase tracking-widest">OU via Email</span>
                    <div class="h-px bg-white/20 flex-1"></div>
                </div>

                <form class="flex flex-col gap-3" onsubmit="handleAuthForm(event)">
                    <div class="relative">
                        <span
                            class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-[20px]">mail</span>
                        <input type="email" id="auth-identifier" placeholder="Votre Adresse Email" required
                            class="w-full bg-white/5 border border-white/10 text-white placeholder-slate-500 pl-12 pr-4 py-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all font-medium text-sm">
                    </div>
                    <button type="submit"
                        class="w-full bg-primary text-background-dark font-black py-4 rounded-xl hover:bg-white transition-colors uppercase tracking-widest mt-2 shadow-[0_10px_20px_rgba(0,186,214,0.3)]">
                        Recevoir un Code (A2F)
                    </button>
                </form>

                <p class="text-center text-[10px] text-slate-500 mt-4 px-4">
                    En vous connectant, vous acceptez que vos donn√©es de contact soient transmises s√©curitairement √†
                    notre base de donn√©es.
                </p>
            </div>

            <!-- Auth Body: Step 2 (Verification) -->
            <div id="auth-step-2" class="p-8 w-full flex-col gap-4 bg-background-dark hidden">
                <div class="text-center mb-6">
                    <h4 class="text-xl font-bold text-white mb-2">V√©rification Requise</h4>
                    <p class="text-sm text-slate-400">Un code √† 6 chiffres vient d'√™tre envoy√© au <br><strong
                            id="auth-identifier-display" class="text-white"></strong></p>
                </div>

                <form class="flex flex-col gap-3" onsubmit="verifyAuthCode(event)">
                    <div class="flex justify-between gap-2 mb-4">
                        <input type="text" maxlength="1"
                            class="code-input w-12 h-14 bg-white/5 border border-white/10 text-white text-center text-xl font-black rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                            required autofocus>
                        <input type="text" maxlength="1"
                            class="code-input w-12 h-14 bg-white/5 border border-white/10 text-white text-center text-xl font-black rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                            required>
                        <input type="text" maxlength="1"
                            class="code-input w-12 h-14 bg-white/5 border border-white/10 text-white text-center text-xl font-black rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                            required>
                        <input type="text" maxlength="1"
                            class="code-input w-12 h-14 bg-white/5 border border-white/10 text-white text-center text-xl font-black rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                            required>
                        <input type="text" maxlength="1"
                            class="code-input w-12 h-14 bg-white/5 border border-white/10 text-white text-center text-xl font-black rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                            required>
                        <input type="text" maxlength="1"
                            class="code-input w-12 h-14 bg-white/5 border border-white/10 text-white text-center text-xl font-black rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                            required>
                    </div>
                    <button type="submit"
                        class="w-full bg-primary text-background-dark font-black py-4 rounded-xl hover:bg-white transition-colors uppercase tracking-widest shadow-[0_10px_20px_rgba(0,186,214,0.3)]">
                        Valider le Code
                    </button>
                    <button type="button" onclick="resetAuthModal()"
                        class="w-full text-slate-400 text-sm font-bold mt-2 hover:text-white transition-colors">
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- User Profile Modal -->

    <div id="profile-modal-backdrop"
        class="fixed inset-0 bg-background-dark/90 backdrop-blur-md z-[115] hidden items-center justify-center p-4 md:p-8 opacity-0 transition-opacity duration-300">
        <div id="profile-modal-container"
            class="bg-background-dark border border-white/10 rounded-[2rem] w-full max-w-md relative transform scale-95 transition-transform duration-300 shadow-[0_30px_60px_rgba(0,0,0,0.5)] overflow-hidden flex flex-col">
            <button onclick="closeProfileModal()"
                class="absolute top-6 right-6 w-10 h-10 bg-white/5 hover:bg-white/10 rounded-full flex items-center justify-center transition-colors text-white z-20">
                <span class="material-symbols-outlined text-lg">close</span>
            </button>
            <div class="p-8 pb-0 flex flex-col items-center relative z-10 mt-4">
                <div id="profile-avatar-large"
                    class="w-24 h-24 rounded-full bg-primary/20 flex items-center justify-center text-4xl font-black text-primary border-4 border-background-dark shadow-[0_0_20px_rgba(0,186,214,0.4)] relative mb-4">
                    <span id="profile-avatar-letter">U</span>
                    <div
                        class="absolute bottom-0 right-0 w-6 h-6 bg-green-500 rounded-full border-2 border-background-dark flex items-center justify-center">
                        <i class="fa-solid fa-check text-[10px] text-white"></i>
                    </div>
                </div>
                <h2 id="profile-name" class="text-2xl font-black text-white">Utilisateur</h2>
                <p id="profile-email" class="text-sm text-slate-400 mt-1">email@example.com</p>
                <div
                    class="bg-primary/10 text-primary px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest mt-4">
                    Membre SWELLSYNC
                </div>
            </div>

            <div id="profile-main-menu" class="p-8 w-full flex flex-col gap-3 mt-4 border-t border-white/5">
                <button onclick="showProfileFavorites()"
                    class="w-full bg-white/5 hover:bg-white/10 text-white font-bold py-4 rounded-xl flex items-center justify-between px-6 transition-colors">
                    <div class="flex items-center gap-3">
                        <span class="material-symbols-outlined text-slate-400">favorite</span>
                        <span data-i18n="dashboard.my_spots">Mes Spots Favoris</span>
                    </div>
                    <span class="material-symbols-outlined text-slate-500">chevron_right</span>
                </button>
                <button onclick="showProfileAlerts()"
                    class="w-full bg-white/5 hover:bg-white/10 text-white font-bold py-4 rounded-xl flex items-center justify-between px-6 transition-colors group">
                    <div class="flex items-center gap-3">
                        <span
                            class="material-symbols-outlined text-yellow-400 group-hover:scale-110 transition-transform">workspace_premium</span>
                        <span class="text-yellow-400">Alertes Surf PRO</span>
                    </div>
                    <span class="material-symbols-outlined text-slate-500">chevron_right</span>
                </button>
                <button onclick="showProfileAIPrefs()"
                    class="w-full bg-white/5 hover:bg-white/10 text-white font-bold py-4 rounded-xl flex items-center justify-between px-6 transition-colors">
                    <div class="flex items-center gap-3">
                        <span class="material-symbols-outlined text-slate-400">settings</span>
                        <span>Pr√©f√©rences Syst√®me</span>
                    </div>
                    <span class="material-symbols-outlined text-slate-500">chevron_right</span>
                </button>

                <button onclick="logoutProfile()"
                    class="w-full mt-4 bg-red-500/10 hover:bg-red-500/20 text-red-500 border border-red-500/20 font-black py-4 rounded-xl transition-colors uppercase tracking-widest text-sm">
                    D√©connexion
                </button>
            </div>

            <!-- View: Favorites -->
            <div id="profile-favorites-view" class="hidden p-8 w-full flex flex-col gap-3 mt-4 border-t border-white/5">
                <div class="flex items-center mb-4">
                    <button onclick="hideProfileViews()"
                        class="text-slate-400 hover:text-white transition-colors flex items-center mr-3">
                        <span class="material-symbols-outlined">arrow_back</span>
                    </button>
                    <h3 class="text-lg font-black text-white">Spots Favoris (3 Max)</h3>
                </div>
                <div id="profile-favorites-container" class="flex flex-col gap-3">
                    <!-- Les spots favoris s'afficheront ici dynamiquement -->
                </div>

                <!-- Premium Upsell -->
                <div
                    class="mt-4 mt-2 p-1 rounded-2xl bg-gradient-to-r from-yellow-500/10 via-yellow-400/20 to-yellow-500/10">
                    <a href="abonnement.html"
                        class="flex items-center justify-between w-full p-4 bg-[#0a1516] rounded-xl border border-yellow-400/10 hover:border-yellow-400/30 transition-all group">
                        <div class="flex items-center gap-3">
                            <div
                                class="w-8 h-8 rounded-full bg-yellow-400/10 flex items-center justify-center border border-yellow-400/20 group-hover:scale-110 transition-transform">
                                <span
                                    class="material-symbols-outlined text-yellow-400 text-[16px]">workspace_premium</span>
                            </div>
                            <div class="flex flex-col text-left">
                                <span class="text-white font-bold text-sm tracking-wide">D√©bloquer la limite</span>
                                <span
                                    class="text-[9px] text-slate-400 font-medium uppercase tracking-widest mt-0.5">Spots
                                    Favoris Illimit√©s</span>
                            </div>
                        </div>
                        <span
                            class="material-symbols-outlined text-yellow-400/50 group-hover:text-yellow-400 group-hover:translate-x-1 transition-all">arrow_forward</span>
                    </a>
                </div>
            </div>

            <!-- View: AI Prefs -->
            <div id="profile-ai-view" class="hidden p-8 w-full flex flex-col gap-3 mt-4 border-t border-white/5">
                <div class="flex items-center mb-4">
                    <button onclick="hideProfileViews()"
                        class="text-slate-400 hover:text-white transition-colors flex items-center mr-3">
                        <span class="material-symbols-outlined">arrow_back</span>
                    </button>
                    <h3 class="text-lg font-black text-white">Configuration Assistant</h3>
                </div>

                <label
                    class="flex items-center justify-between bg-white/5 p-4 rounded-xl border border-white/10 cursor-pointer hover:bg-white/10 transition-colors">
                    <div>
                        <h4 class="text-white font-bold text-sm">Swell Whisperer</h4>
                        <p class="text-xs text-slate-400">Recommandations vocales</p>
                    </div>
                    <input type="checkbox" class="toggle toggle-primary" checked />
                </label>

                <label
                    class="flex items-center justify-between bg-white/5 p-4 rounded-xl border border-white/10 cursor-pointer hover:bg-white/10 transition-colors">
                    <div>
                        <h4 class="text-white font-bold text-sm">Magic Quiver</h4>
                        <p class="text-xs text-slate-400">Choix planche auto</p>
                    </div>
                    <input type="checkbox" class="toggle toggle-primary" checked />
                </label>

                <div class="mt-2 text-xs text-slate-500 leading-relaxed">
                    Notre algorithme marin analyse en continu pr√®s de 12 variables m√©t√©orologiques par spot pour
                    optimiser automatiquement votre niveau de surf.
                </div>
            </div>
        </div>
    </div>




    <!-- Global Search Modal -->
    <div id="global-search-backdrop"
        class="fixed inset-0 bg-background-dark/90 backdrop-blur-md z-[110] hidden items-start justify-center p-4 md:pt-[10vh] opacity-0 transition-opacity duration-300">
        <div id="global-search-container"
            class="bg-background-dark/70 backdrop-blur-2xl border border-white/10 rounded-[2rem] w-full max-w-2xl transform scale-95 transition-transform duration-300 shadow-[0_20px_50px_rgba(0,0,0,0.5)] flex flex-col overflow-hidden">

            <!-- Search Input Area -->
            <div class="flex items-center gap-3 p-4 md:p-6 border-b border-white/10 relative bg-transparent">
                <span class="material-symbols-outlined text-white/50 text-2xl">search</span>
                <input type="text" id="global-search-input"
                    class="w-full bg-transparent border-transparent focus:border-transparent outline-none focus:outline-none ring-0 focus:ring-0 text-white text-lg md:text-xl font-medium placeholder-white/30"
                    placeholder="Chercher un spot, une page, une info..." autocomplete="off">
                <button onclick="closeGlobalSearchModal()"
                    class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10 text-white/50 hover:text-white transition-colors">
                    <span class="material-symbols-outlined text-xl">close</span>
                </button>
            </div>

            <!-- Search Results Area -->
            <div class="max-h-[60vh] overflow-y-auto custom-scrollbar p-2" id="global-search-results">
                <div class="text-center py-10 text-slate-500 text-sm font-medium">
                    Que cherchez-vous ? üèÑ
                </div>
            </div>

            <!-- Footer Hints -->
            <div
                class="px-6 py-3 border-t border-white/5 bg-background-dark/50 flex items-center justify-between text-[10px] text-slate-500 uppercase tracking-widest font-bold hidden md:flex">
                <div class="flex items-center gap-2">
                    <span class="bg-white/10 px-2 py-1 flex items-center rounded border border-white/5 text-[9px]"><span
                            class="font-sans mr-1">&#8593;&#8595;</span> Naviguer</span>
                    <span
                        class="bg-white/10 px-2 py-1 flex items-center rounded border border-white/5 text-[9px]">Entr&#233;e
                        <span class="material-symbols-outlined text-[10px] ml-1">keyboard_return</span></span>
                </div>
                <div>SwellSync Global Search</div>
            </div>
        </div>
    </div>
</body>

</html>